<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML><HEAD><TITLE>&#31532; 18 &#31456; XML&#26144;&#23556;</TITLE>
<META content="text/html; charset=ISO-8859-1" http-equiv=Content-Type><LINK 
rel=stylesheet type=text/css href="../shared/css/html.css">
<META name=GENERATOR content="MSHTML 11.00.9431.193"><LINK 
title="HIBERNATE - &#31526;&#21512;Java&#20064;&#24815;&#30340;&#20851;&#31995;&#25968;&#25454;&#24211;&#25345;&#20037;&#21270;" rel=home href="index.html"><LINK 
title="HIBERNATE - &#31526;&#21512;Java&#20064;&#24815;&#30340;&#20851;&#31995;&#25968;&#25454;&#24211;&#25345;&#20037;&#21270;" rel=up href="index.html"><LINK 
title=&#31532;&nbsp;17&nbsp;&#31456;&nbsp;&#36807;&#28388;&#25968;&#25454; rel=previous href="filters.html"><LINK 
title="&#31532;&nbsp;19&nbsp;&#31456;&nbsp;&#25552;&#21319;&#24615;&#33021;&#10;&#9;" rel=next 
href="performance.html"></HEAD>
<BODY aLink=#0000ff link=#0000ff bgColor=white text=black vLink=#840084>
<DIV class=navheader>
<TABLE width="100%" summary="Navigation header">
  <TBODY>
  <TR>
    <TH colSpan=3 align=center>&#31532;&nbsp;18&nbsp;&#31456;&nbsp;XML&#26144;&#23556;</TH></TR>
  <TR>
    <TD width="20%" align=left><A accessKey=p 
    href="filters.html">&#19978;&#19968;&#39029;</A>&nbsp;</TD>
    <TH width="60%" align=center>&nbsp;</TH>
    <TD width="20%" align=right>&nbsp;<A accessKey=n 
      href="performance.html">&#19979;&#19968;&#39029;</A></TD></TR></TBODY></TABLE>
<HR>
</DIV>
<DIV lang=zh-cn class=chapter>
<DIV class=titlepage>
<DIV>
<DIV>
<H2 class=title><A name=xml></A>&#31532;&nbsp;18&nbsp;&#31456;&nbsp;XML&#26144;&#23556;</H2>
<P class=title>&#23398;&#20064;<FONT color=#ff0000>QQ&#32676;&#65306;</FONT><FONT color=#ff0000 
size=5>476133513&nbsp;&nbsp; &#21487;&#20197;&#21152;&#32676;&#19968;&#36215;&#35752;&#35770;&#23398;&#20064;</FONT></P></DIV></DIV>
<DIV></DIV></DIV>
<P><SPAN class=emphasis><EM>&#27880;&#24847;&#36825;&#26159;Hibernate 3.0&#30340;&#19968;&#20010;&#23454;&#39564;&#24615;&#30340;&#29305;&#24615;&#12290;&#36825;&#19968;&#29305;&#24615;&#20173;&#22312;&#31215;&#26497;&#24320;&#21457;&#20013;&#12290; 
</EM></SPAN></P>
<DIV lang=zh-cn class=sect1>
<DIV class=titlepage>
<DIV>
<DIV>
<H2 class=title style="CLEAR: both"><A 
name=xml-intro></A>18.1.&nbsp;&#29992;XML&#25968;&#25454;&#36827;&#34892;&#24037;&#20316;</H2></DIV></DIV>
<DIV></DIV></DIV>
<P>Hibernate&#20351;&#24471;&#20320;&#21487;&#20197;&#29992;XML&#25968;&#25454;&#26469;&#36827;&#34892;&#24037;&#20316;&#65292;&#24688;&#22914;&#20320;&#29992;&#25345;&#20037;&#21270;&#30340;POJO&#36827;&#34892;&#24037;&#20316;&#37027;&#26679;&#12290;&#35299;&#26512;&#36807;&#30340;XML&#26641; 
&#21487;&#20197;&#34987;&#35748;&#20026;&#26159;&#20195;&#26367;POJO&#30340;&#21478;&#22806;&#19968;&#31181;&#22312;&#23545;&#35937;&#23618;&#38754;&#19978;&#34920;&#31034;&#20851;&#31995;&#22411;&#25968;&#25454;&#30340;&#36884;&#24452;. </P>
<P>Hibernate&#25903;&#25345;&#37319;&#29992;dom4j&#20316;&#20026;&#25805;&#20316;XML&#26641;&#30340;API&#12290;&#20320;&#21487;&#20197;&#20889;&#19968;&#20123;&#26597;&#35810;&#20174;&#25968;&#25454;&#24211;&#20013;&#26816;&#32034;&#20986; 
dom4j&#26641;&#65292;&#38543;&#21518;&#20320;&#23545;&#36825;&#39063;&#26641;&#20570;&#30340;&#20219;&#20309;&#20462;&#25913;&#37117;&#23558;&#33258;&#21160;&#21516;&#27493;&#22238;&#25968;&#25454;&#24211;&#12290;&#20320;&#29978;&#33267;&#21487;&#20197;&#29992;dom4j&#35299;&#26512; 
&#19968;&#31687;XML&#25991;&#26723;&#65292;&#28982;&#21518;&#20351;&#29992;Hibernate&#30340;&#20219;&#19968;&#22522;&#26412;&#25805;&#20316;&#23558;&#23427;&#20889;&#20837;&#25968;&#25454;&#24211;&#65306; <TT class=literal>persist(), 
saveOrUpdate(), merge(), delete(), replicate()</TT> (&#21512;&#24182;&#25805;&#20316;merge()&#30446;&#21069;&#36824;&#19981;&#25903;&#25345;)&#12290; </P>
<P>&#36825;&#19968;&#29305;&#24615;&#21487;&#20197;&#24212;&#29992;&#22312;&#24456;&#22810;&#22330;&#21512;&#65292;&#21253;&#25324;&#25968;&#25454;&#23548;&#20837;&#23548;&#20986;&#65292;&#36890;&#36807;JMS&#25110;SOAP&#20855;&#20307;&#21270;&#23454;&#20307;&#25968;&#25454;&#20197;&#21450; &#22522;&#20110;XSLT&#30340;&#25253;&#34920;&#12290; </P>
<P>&#19968;&#20010;&#21333;&#19968;&#30340;&#26144;&#23556;&#23601;&#21487;&#20197;&#23558;&#31867;&#30340;&#23646;&#24615;&#21644;XML&#25991;&#26723;&#30340;&#33410;&#28857;&#21516;&#26102;&#26144;&#23556;&#21040;&#25968;&#25454;&#24211;&#12290;&#22914;&#26524;&#19981;&#38656;&#35201;&#26144;&#23556;&#31867;&#65292; &#23427;&#20063;&#21487;&#20197;&#29992;&#26469;&#21482;&#26144;&#23556;XML&#25991;&#26723;&#12290; </P>
<DIV lang=zh-cn class=sect2>
<DIV class=titlepage>
<DIV>
<DIV>
<H3 class=title><A 
name=xml-intro-mapping></A>18.1.1.&nbsp;&#25351;&#23450;&#21516;&#26102;&#26144;&#23556;XML&#21644;&#31867;</H3></DIV></DIV>
<DIV></DIV></DIV>
<P>&#36825;&#26159;&#19968;&#20010;&#21516;&#26102;&#26144;&#23556;POJO&#21644;XML&#30340;&#20363;&#23376;&#65306; </P><PRE class=programlisting>&lt;class name="Account" 
        table="ACCOUNTS" 
        node="account"&gt;
        
    &lt;id name="accountId" 
            column="ACCOUNT_ID" 
            node="@id"/&gt;
            
    &lt;many-to-one name="customer" 
            column="CUSTOMER_ID" 
            node="customer/@id" 
            embed-xml="false"/&gt;
            
    &lt;property name="balance" 
            column="BALANCE" 
            node="balance"/&gt;
            
    ...
    
&lt;/class&gt;</PRE></DIV>
<DIV lang=zh-cn class=sect2>
<DIV class=titlepage>
<DIV>
<DIV>
<H3 class=title><A name=xml-onlyxml></A>18.1.2.&nbsp;&#21482;&#23450;&#20041;XML&#26144;&#23556;</H3></DIV></DIV>
<DIV></DIV></DIV>
<P>&#36825;&#26159;&#19968;&#20010;&#19981;&#26144;&#23556;POJO&#30340;&#20363;&#23376;&#65306; </P><PRE class=programlisting>&lt;class entity-name="Account" 
        table="ACCOUNTS" 
        node="account"&gt;
        
    &lt;id name="id" 
            column="ACCOUNT_ID" 
            node="@id" 
            type="string"/&gt;
            
    &lt;many-to-one name="customerId" 
            column="CUSTOMER_ID" 
            node="customer/@id" 
            embed-xml="false" 
            entity-name="Customer"/&gt;
            
    &lt;property name="balance" 
            column="BALANCE" 
            node="balance" 
            type="big_decimal"/&gt;
            
    ...
    
&lt;/class&gt;</PRE>
<P>&#36825;&#20010;&#26144;&#23556;&#20351;&#24471;&#20320;&#26082;&#21487;&#20197;&#25226;&#25968;&#25454;&#20316;&#20026;&#19968;&#26869;dom4j&#26641;&#37027;&#26679;&#35775;&#38382;&#65292;&#21448;&#21487;&#20197;&#20316;&#20026;&#30001;&#23646;&#24615;&#38190;&#20540;&#23545;(java <TT class=literal>Map</TT>s) 
&#32452;&#25104;&#30340;&#22270;&#37027;&#26679;&#35775;&#38382;&#12290;&#23646;&#24615;&#21517;&#23383;&#32431;&#31929;&#26159;&#36923;&#36753;&#19978;&#30340;&#32467;&#26500;&#65292;&#20320;&#21487;&#20197;&#22312;HQL&#26597;&#35810;&#20013;&#24341;&#29992;&#23427;&#12290; </P></DIV></DIV>
<DIV lang=zh-cn class=sect1>
<DIV class=titlepage>
<DIV>
<DIV>
<H2 class=title style="CLEAR: both"><A 
name=xml-mapping></A>18.2.&nbsp;XML&#26144;&#23556;&#20803;&#25968;&#25454;</H2></DIV></DIV>
<DIV></DIV></DIV>
<P>&#35768;&#22810;Hibernate&#26144;&#23556;&#20803;&#32032;&#20855;&#26377;<TT class=literal>node</TT>&#23646;&#24615;&#12290;&#36825;&#20351;&#20320;&#21487;&#20197;&#25351;&#23450;&#29992;&#26469;&#20445;&#23384; 
&#23646;&#24615;&#25110;&#23454;&#20307;&#25968;&#25454;&#30340;XML&#23646;&#24615;&#25110;&#20803;&#32032;&#12290;<TT class=literal>node</TT>&#23646;&#24615;&#24517;&#39035;&#26159;&#19979;&#21015;&#26684;&#24335;&#20043;&#19968;&#65306; </P>
<DIV class=itemizedlist>
<UL type=disc compact>
  <LI>
  <P><TT class=literal>"element-name"</TT> - &#26144;&#23556;&#20026;&#25351;&#23450;&#30340;XML&#20803;&#32032;</P>
  <LI>
  <P><TT class=literal>"@attribute-name"</TT> - &#26144;&#23556;&#20026;&#25351;&#23450;&#30340;XML&#23646;&#24615;</P>
  <LI>
  <P><TT class=literal>"."</TT> - &#26144;&#23556;&#20026;&#29238;&#20803;&#32032;</P>
  <LI>
  <P><TT class=literal>"element-name/@attribute-name"</TT> - &#26144;&#23556;&#20026;&#25351;&#23450;&#20803;&#32032;&#30340;&#25351;&#23450;&#23646;&#24615; 
  </P></LI></UL></DIV>
<P>&#23545;&#20110;&#38598;&#21512;&#21644;&#21333;&#20540;&#30340;&#20851;&#32852;&#65292;&#26377;&#19968;&#20010;&#39069;&#22806;&#30340;<TT class=literal>embed-xml</TT>&#23646;&#24615;&#21487;&#29992;&#12290; &#36825;&#20010;&#23646;&#24615;&#30340;&#32570;&#30465;&#20540;&#26159;&#30495;(<TT 
class=literal>embed-xml="true"</TT>)&#12290;&#22914;&#26524;<TT class=literal>embed-xml="true"</TT>&#65292; 
&#21017;&#23545;&#24212;&#20110;&#34987;&#20851;&#32852;&#23454;&#20307;&#25110;&#20540;&#31867;&#22411;&#30340;&#38598;&#21512;&#30340;XML&#26641;&#23558;&#30452;&#25509;&#23884;&#20837;&#25317;&#26377;&#36825;&#20123;&#20851;&#32852;&#30340;&#23454;&#20307;&#30340;XML&#26641;&#20013;&#12290; &#21542;&#21017;&#65292;&#22914;&#26524;<TT 
class=literal>embed-xml="false"</TT>&#65292;&#37027;&#20040;&#23545;&#20110;&#21333;&#20540;&#30340;&#20851;&#32852;&#65292;&#20165;&#34987;&#24341;&#29992;&#30340;&#23454;&#20307;&#30340;&#26631;&#35782;&#31526;&#20986;&#29616;&#22312; 
XML&#26641;&#20013;(&#34987;&#24341;&#29992;&#23454;&#20307;&#26412;&#36523;&#19981;&#20986;&#29616;)&#65292;&#32780;&#38598;&#21512;&#21017;&#26681;&#26412;&#19981;&#20986;&#29616;&#12290; </P>
<P>&#20320;&#24212;&#35813;&#23567;&#24515;&#65292;&#19981;&#35201;&#35753;&#22826;&#22810;&#20851;&#32852;&#30340;embed-xml&#23646;&#24615;&#20026;&#30495;(<TT 
class=literal>embed-xml="true"</TT>)&#65292;&#22240;&#20026;XML&#19981;&#33021;&#24456;&#22909;&#22320;&#22788;&#29702; &#24490;&#29615;&#24341;&#29992;! </P><PRE class=programlisting>&lt;class name="Customer" 
        table="CUSTOMER" 
        node="customer"&gt;
        
    &lt;id name="id" 
            column="CUST_ID" 
            node="@id"/&gt;
            
    &lt;map name="accounts" 
            node="." 
            embed-xml="true"&gt;
        &lt;key column="CUSTOMER_ID" 
                not-null="true"/&gt;
        &lt;map-key column="SHORT_DESC" 
                node="@short-desc" 
                type="string"/&gt;
        &lt;one-to-many entity-name="Account"
                embed-xml="false" 
                node="account"/&gt;
    &lt;/map&gt;
    
    &lt;component name="name" 
            node="name"&gt;
        &lt;property name="firstName" 
                node="first-name"/&gt;
        &lt;property name="initial" 
                node="initial"/&gt;
        &lt;property name="lastName" 
                node="last-name"/&gt;
    &lt;/component&gt;
    
    ...
    
&lt;/class&gt;</PRE>
<P>&#22312;&#36825;&#20010;&#20363;&#23376;&#20013;&#65292;&#25105;&#20204;&#20915;&#23450;&#23884;&#20837;&#24080;&#30446;&#21495;&#30721;(account id)&#30340;&#38598;&#21512;&#65292;&#20294;&#19981;&#23884;&#20837;&#23454;&#38469;&#30340;&#24080;&#30446;&#25968;&#25454;&#12290;&#19979;&#38754;&#30340;HQL&#26597;&#35810;&#65306; </P><PRE class=programlisting>from Customer c left join fetch c.accounts where c.lastName like :lastName</PRE>
<P>&#36820;&#22238;&#30340;&#25968;&#25454;&#38598;&#23558;&#26159;&#36825;&#26679;&#65306; </P><PRE class=programlisting>&lt;customer id="123456789"&gt;
    &lt;account id="987632567" short-desc="Savings"/&gt;
    &lt;account id="985612323" short-desc="Credit Card"/&gt;
    &lt;name&gt;
        &lt;first-name&gt;Gavin&lt;/first-name&gt;
        &lt;initial&gt;A&lt;/initial&gt;
        &lt;last-name&gt;King&lt;/last-name&gt;
    &lt;/name&gt;
    ...
&lt;/customer&gt;</PRE>
<P>&#22914;&#26524;&#20320;&#25226;&#19968;&#23545;&#22810;&#26144;&#23556;<TT class=literal>&lt;one-to-many&gt;</TT>&#30340;embed-xml&#23646;&#24615;&#32622;&#20026;&#30495;(<TT 
class=literal>embed-xml="true"</TT>)&#65292; &#21017;&#25968;&#25454;&#30475;&#19978;&#21435;&#23601;&#20687;&#36825;&#26679;&#65306; </P><PRE class=programlisting>&lt;customer id="123456789"&gt;
    &lt;account id="987632567" short-desc="Savings"&gt;
        &lt;customer id="123456789"/&gt;
        &lt;balance&gt;100.29&lt;/balance&gt;
    &lt;/account&gt;
    &lt;account id="985612323" short-desc="Credit Card"&gt;
        &lt;customer id="123456789"/&gt;
        &lt;balance&gt;-2370.34&lt;/balance&gt;
    &lt;/account&gt;
    &lt;name&gt;
        &lt;first-name&gt;Gavin&lt;/first-name&gt;
        &lt;initial&gt;A&lt;/initial&gt;
        &lt;last-name&gt;King&lt;/last-name&gt;
    &lt;/name&gt;
    ...
&lt;/customer&gt;</PRE></DIV>
<DIV lang=zh-cn class=sect1>
<DIV class=titlepage>
<DIV>
<DIV>
<H2 class=title style="CLEAR: both"><A 
name=xml-manipulation></A>18.3.&nbsp;&#25805;&#20316;XML&#25968;&#25454;</H2></DIV></DIV>
<DIV></DIV></DIV>
<P>&#35753;&#25105;&#20204;&#26469;&#35835;&#20837;&#21644;&#26356;&#26032;&#24212;&#29992;&#31243;&#24207;&#20013;&#30340;XML&#25991;&#26723;&#12290;&#36890;&#36807;&#33719;&#21462;&#19968;&#20010;dom4j&#20250;&#35805;&#21487;&#20197;&#20570;&#21040;&#36825;&#19968;&#28857;&#65306; </P><PRE class=programlisting>Document doc = ....;
       
Session session = factory.openSession();
Session dom4jSession = session.getSession(EntityMode.DOM4J);
Transaction tx = session.beginTransaction();

List results = dom4jSession
    .createQuery("from Customer c left join fetch c.accounts where c.lastName like :lastName")
    .list();
for ( int i=0; i&lt;results.size(); i++ ) {
    //add the customer data to the XML document
    Element customer = (Element) results.get(i);
    doc.add(customer);
}

tx.commit();
session.close();</PRE><PRE class=programlisting>Session session = factory.openSession();
Session dom4jSession = session.getSession(EntityMode.DOM4J);
Transaction tx = session.beginTransaction();

Element cust = (Element) dom4jSession.get("Customer", customerId);
for ( int i=0; i&lt;results.size(); i++ ) {
    Element customer = (Element) results.get(i);
    //change the customer name in the XML and database
    Element name = customer.element("name");
    name.element("first-name").setText(firstName);
    name.element("initial").setText(initial);
    name.element("last-name").setText(lastName);
}

tx.commit();
session.close();</PRE>
<P>&#23558;&#36825;&#19968;&#29305;&#33394;&#19982;Hibernate&#30340;<TT 
class=literal>replicate()</TT>&#25805;&#20316;&#32467;&#21512;&#36215;&#26469;&#23545;&#20110;&#23454;&#29616;&#30340;&#22522;&#20110;XML&#30340;&#25968;&#25454;&#23548;&#20837;/&#23548;&#20986;&#23558;&#38750;&#24120;&#26377;&#29992;. </P></DIV></DIV>
<DIV class=navfooter>
<HR>

<TABLE width="100%" summary="Navigation footer">
  <TBODY>
  <TR>
    <TD width="40%" align=left><A accessKey=p 
    href="filters.html">&#19978;&#19968;&#39029;</A>&nbsp;</TD>
    <TD width="20%" align=center><A accessKey=u href="index.html">&#19978;&#19968;&#32423;</A></TD>
    <TD width="40%" align=right>&nbsp;<A accessKey=n 
      href="performance.html">&#19979;&#19968;&#39029;</A></TD></TR>
  <TR>
    <TD vAlign=top width="40%" align=left>&#31532;&nbsp;17&nbsp;&#31456;&nbsp;&#36807;&#28388;&#25968;&#25454;&nbsp;</TD>
    <TD width="20%" align=center><A accessKey=h href="index.html">&#36215;&#22987;&#39029;</A></TD>
    <TD vAlign=top width="40%" align=right>&nbsp;&#31532;&nbsp;19&nbsp;&#31456;&nbsp;&#25552;&#21319;&#24615;&#33021; 
  </TD></TR></TBODY></TABLE></DIV></BODY></HTML>
