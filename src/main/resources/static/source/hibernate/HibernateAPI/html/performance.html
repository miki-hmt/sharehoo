<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML><HEAD><TITLE>&#31532; 19 &#31456; &#25552;&#21319;&#24615;&#33021;</TITLE>
<META content="text/html; charset=ISO-8859-1" http-equiv=Content-Type><LINK 
rel=stylesheet type=text/css href="../shared/css/html.css">
<META name=GENERATOR content="MSHTML 11.00.9431.193"><LINK 
title="HIBERNATE - &#31526;&#21512;Java&#20064;&#24815;&#30340;&#20851;&#31995;&#25968;&#25454;&#24211;&#25345;&#20037;&#21270;" rel=home href="index.html"><LINK 
title="HIBERNATE - &#31526;&#21512;Java&#20064;&#24815;&#30340;&#20851;&#31995;&#25968;&#25454;&#24211;&#25345;&#20037;&#21270;" rel=up href="index.html"><LINK 
title=&#31532;&nbsp;18&nbsp;&#31456;&nbsp;XML&#26144;&#23556; rel=previous href="xml.html"><LINK 
title=&#31532;&nbsp;20&nbsp;&#31456;&nbsp;&#24037;&#20855;&#31665;&#25351;&#21335; rel=next href="toolsetguide.html"></HEAD>
<BODY aLink=#0000ff link=#0000ff bgColor=white text=black vLink=#840084>
<DIV class=navheader>
<TABLE width="100%" summary="Navigation header">
  <TBODY>
  <TR>
    <TH colSpan=3 align=center>&#31532;&nbsp;19&nbsp;&#31456;&nbsp;&#25552;&#21319;&#24615;&#33021; </TH></TR>
  <TR>
    <TD width="20%" align=left><A accessKey=p href="xml.html">&#19978;&#19968;&#39029;</A>&nbsp;</TD>
    <TH width="60%" align=center>&nbsp;</TH>
    <TD width="20%" align=right>&nbsp;<A accessKey=n 
      href="toolsetguide.html">&#19979;&#19968;&#39029;</A></TD></TR></TBODY></TABLE>
<HR>
</DIV>
<DIV lang=zh-cn class=chapter>
<DIV class=titlepage>
<DIV>
<DIV>
<H2 class=title><A name=performance></A>&#31532;&nbsp;19&nbsp;&#31456;&nbsp;&#25552;&#21319;&#24615;&#33021; </H2>
<P class=title>&#23398;&#20064;<FONT color=#ff0000>QQ&#32676;&#65306;</FONT><FONT color=#ff0000 
size=5>476133513&nbsp;&nbsp; &#21487;&#20197;&#21152;&#32676;&#19968;&#36215;&#35752;&#35770;&#23398;&#20064;</FONT></P></DIV></DIV>
<DIV></DIV></DIV>
<DIV lang=zh-cn class=sect1>
<DIV class=titlepage>
<DIV>
<DIV>
<H2 class=title style="CLEAR: both"><A name=performance-fetching></A>19.1.&nbsp; 
&#25235;&#21462;&#31574;&#30053;(Fetching strategies) </H2></DIV></DIV>
<DIV></DIV></DIV>
<P><SPAN class=emphasis><EM>&#25235;&#21462;&#31574;&#30053;&#65288;fetching strategy&#65289;</EM></SPAN> 
&#26159;&#25351;&#65306;&#24403;&#24212;&#29992;&#31243;&#24207;&#38656;&#35201;&#22312;&#65288;Hibernate&#23454;&#20307;&#23545;&#35937;&#22270;&#30340;&#65289;&#20851;&#32852;&#20851;&#31995;&#38388;&#36827;&#34892;&#23548;&#33322;&#30340;&#26102;&#20505;&#65292; 
Hibernate&#22914;&#20309;&#33719;&#21462;&#20851;&#32852;&#23545;&#35937;&#30340;&#31574;&#30053;&#12290;&#25235;&#21462;&#31574;&#30053;&#21487;&#20197;&#22312;O/R&#26144;&#23556;&#30340;&#20803;&#25968;&#25454;&#20013;&#22768;&#26126;&#65292;&#20063;&#21487;&#20197;&#22312;&#29305;&#23450;&#30340;HQL &#25110;<TT 
class=literal>&#26465;&#20214;&#26597;&#35810;&#65288;Criteria Query&#65289;</TT>&#20013;&#37325;&#36733;&#22768;&#26126;&#12290; </P>
<P>Hibernate3 &#23450;&#20041;&#20102;&#22914;&#19979;&#20960;&#31181;&#25235;&#21462;&#31574;&#30053;&#65306; </P>
<DIV class=itemizedlist>
<UL type=disc>
  <LI>
  <P><SPAN class=emphasis><EM>&#36830;&#25509;&#25235;&#21462;&#65288;Join fetching&#65289;</EM></SPAN> - Hibernate&#36890;&#36807; &#22312;<TT 
  class=literal>SELECT</TT>&#35821;&#21477;&#20351;&#29992;<TT class=literal>OUTER JOIN</TT>&#65288;&#22806;&#36830;&#25509;&#65289;&#26469; 
  &#33719;&#24471;&#23545;&#35937;&#30340;&#20851;&#32852;&#23454;&#20363;&#25110;&#32773;&#20851;&#32852;&#38598;&#21512;&#12290; </P>
  <LI>
  <P><SPAN class=emphasis><EM>&#26597;&#35810;&#25235;&#21462;&#65288;Select fetching&#65289;</EM></SPAN> - &#21478;&#22806;&#21457;&#36865;&#19968;&#26465; <TT 
  class=literal>SELECT</TT> &#35821;&#21477;&#25235;&#21462;&#24403;&#21069;&#23545;&#35937;&#30340;&#20851;&#32852;&#23454;&#20307;&#25110;&#38598;&#21512;&#12290;&#38500;&#38750;&#20320;&#26174;&#24335;&#30340;&#25351;&#23450;<TT 
  class=literal>lazy="false"</TT>&#31105;&#27490; &#24310;&#36831;&#25235;&#21462;&#65288;lazy 
  fetching&#65289;&#65292;&#21542;&#21017;&#21482;&#26377;&#24403;&#20320;&#30495;&#27491;&#35775;&#38382;&#20851;&#32852;&#20851;&#31995;&#30340;&#26102;&#20505;&#65292;&#25165;&#20250;&#25191;&#34892;&#31532;&#20108;&#26465;select&#35821;&#21477;&#12290; </P>
  <LI>
  <P><SPAN class=emphasis><EM>&#23376;&#26597;&#35810;&#25235;&#21462;&#65288;Subselect fetching&#65289;</EM></SPAN> - &#21478;&#22806;&#21457;&#36865;&#19968;&#26465;<TT 
  class=literal>SELECT</TT> &#35821;&#21477;&#25235;&#21462;&#22312;&#21069;&#38754;&#26597;&#35810;&#21040;&#65288;&#25110;&#32773;&#25235;&#21462;&#21040;&#65289;&#30340;&#25152;&#26377;&#23454;&#20307;&#23545;&#35937;&#30340;&#20851;&#32852;&#38598;&#21512;&#12290;&#38500;&#38750;&#20320;&#26174;&#24335;&#30340;&#25351;&#23450;<TT 
  class=literal>lazy="false"</TT> &#31105;&#27490;&#24310;&#36831;&#25235;&#21462;&#65288;lazy 
  fetching&#65289;&#65292;&#21542;&#21017;&#21482;&#26377;&#24403;&#20320;&#30495;&#27491;&#35775;&#38382;&#20851;&#32852;&#20851;&#31995;&#30340;&#26102;&#20505;&#65292;&#25165;&#20250;&#25191;&#34892;&#31532;&#20108;&#26465;select&#35821;&#21477;&#12290; </P>
  <LI>
  <P><SPAN class=emphasis><EM>&#25209;&#37327;&#25235;&#21462;&#65288;Batch fetching&#65289;</EM></SPAN> - &#23545;&#26597;&#35810;&#25235;&#21462;&#30340;&#20248;&#21270;&#26041;&#26696;&#65292; 
  &#36890;&#36807;&#25351;&#23450;&#19968;&#20010;&#20027;&#38190;&#25110;&#22806;&#38190;&#21015;&#34920;&#65292;Hibernate&#20351;&#29992;&#21333;&#26465;<TT class=literal>SELECT</TT>&#35821;&#21477;&#33719;&#21462;&#19968;&#25209;&#23545;&#35937;&#23454;&#20363;&#25110;&#38598;&#21512;&#12290; 
  </P></LI></UL></DIV>
<P>Hibernate&#20250;&#21306;&#20998;&#19979;&#21015;&#21508;&#31181;&#24773;&#20917;&#65306; </P>
<DIV class=itemizedlist>
<UL type=disc>
  <LI>
  <P><SPAN class=emphasis><EM>Immediate fetching&#65292;&#31435;&#21363;&#25235;&#21462;</EM></SPAN> - 
  &#24403;&#23487;&#20027;&#34987;&#21152;&#36733;&#26102;&#65292;&#20851;&#32852;&#12289;&#38598;&#21512;&#25110;&#23646;&#24615;&#34987;&#31435;&#21363;&#25235;&#21462;&#12290; </P>
  <LI>
  <P><SPAN class=emphasis><EM>Lazy collection fetching&#65292;&#24310;&#36831;&#38598;&#21512;&#25235;&#21462;</EM></SPAN>- 
  &#30452;&#21040;&#24212;&#29992;&#31243;&#24207;&#23545;&#38598;&#21512;&#36827;&#34892;&#20102;&#19968;&#27425;&#25805;&#20316;&#26102;&#65292;&#38598;&#21512;&#25165;&#34987;&#25235;&#21462;&#12290;&#65288;&#23545;&#38598;&#21512;&#32780;&#35328;&#36825;&#26159;&#40664;&#35748;&#34892;&#20026;&#12290;&#65289; </P>
  <LI>
  <P><SPAN class=emphasis><EM>"Extra-lazy" collection 
  fetching,"Extra-lazy"&#38598;&#21512;&#25235;&#21462;</EM></SPAN> 
  -&#23545;&#38598;&#21512;&#31867;&#20013;&#30340;&#27599;&#20010;&#20803;&#32032;&#32780;&#35328;&#65292;&#37117;&#26159;&#30452;&#21040;&#38656;&#35201;&#26102;&#25165;&#21435;&#35775;&#38382;&#25968;&#25454;&#24211;&#12290;&#38500;&#38750;&#32477;&#23545;&#24517;&#35201;&#65292;Hibernate&#19981;&#20250;&#35797;&#22270;&#21435;&#25226;&#25972;&#20010;&#38598;&#21512;&#37117;&#25235;&#21462;&#21040;&#20869;&#23384;&#37324;&#26469;&#65288;&#36866;&#29992;&#20110;&#38750;&#24120;&#22823;&#30340;&#38598;&#21512;&#65289;&#12290; 
  </P>
  <LI>
  <P><SPAN class=emphasis><EM>Proxy fetching&#65292;&#20195;&#29702;&#25235;&#21462;</EM></SPAN> - 
  &#23545;&#36820;&#22238;&#21333;&#20540;&#30340;&#20851;&#32852;&#32780;&#35328;&#65292;&#24403;&#20854;&#26576;&#20010;&#26041;&#27861;&#34987;&#35843;&#29992;&#65292;&#32780;&#38750;&#23545;&#20854;&#20851;&#38190;&#23383;&#36827;&#34892;get&#25805;&#20316;&#26102;&#25165;&#25235;&#21462;&#12290; </P>
  <LI>
  <P><SPAN class=emphasis><EM>"No-proxy" fetching,&#38750;&#20195;&#29702;&#25235;&#21462;</EM></SPAN> - 
  &#23545;&#36820;&#22238;&#21333;&#20540;&#30340;&#20851;&#32852;&#32780;&#35328;&#65292;&#24403;&#23454;&#20363;&#21464;&#37327;&#34987;&#35775;&#38382;&#30340;&#26102;&#20505;&#36827;&#34892;&#25235;&#21462;&#12290;&#19982;&#19978;&#38754;&#30340;&#20195;&#29702;&#25235;&#21462;&#30456;&#27604;&#65292;&#36825;&#31181;&#26041;&#27861;&#27809;&#26377;&#37027;&#20040;“&#24310;&#36831;”&#24471;&#21385;&#23475;(&#23601;&#31639;&#21482;&#35775;&#38382;&#26631;&#35782;&#31526;&#65292;&#20063;&#20250;&#23548;&#33268;&#20851;&#32852;&#25235;&#21462;)&#20294;&#26159;&#26356;&#21152;&#36879;&#26126;&#65292;&#22240;&#20026;&#23545;&#24212;&#29992;&#31243;&#24207;&#26469;&#35828;&#65292;&#19981;&#20877;&#30475;&#21040;proxy&#12290;&#36825;&#31181;&#26041;&#27861;&#38656;&#35201;&#22312;&#32534;&#35793;&#26399;&#38388;&#36827;&#34892;&#23383;&#33410;&#30721;&#22686;&#24378;&#25805;&#20316;&#65292;&#22240;&#27492;&#24456;&#23569;&#38656;&#35201;&#29992;&#21040;&#12290; 
  </P>
  <LI>
  <P><SPAN class=emphasis><EM>Lazy attribute fetching&#65292;&#23646;&#24615;&#24310;&#36831;&#21152;&#36733;</EM></SPAN> - 
  &#23545;&#23646;&#24615;&#25110;&#36820;&#22238;&#21333;&#20540;&#30340;&#20851;&#32852;&#32780;&#35328;&#65292;&#24403;&#20854;&#23454;&#20363;&#21464;&#37327;&#34987;&#35775;&#38382;&#30340;&#26102;&#20505;&#36827;&#34892;&#25235;&#21462;&#12290;&#38656;&#35201;&#32534;&#35793;&#26399;&#23383;&#33410;&#30721;&#24378;&#21270;&#65292;&#22240;&#27492;&#36825;&#19968;&#26041;&#27861;&#24456;&#23569;&#26159;&#24517;&#35201;&#30340;&#12290; </P></LI></UL></DIV>
<P>&#36825;&#37324;&#26377;&#20004;&#20010;&#27491;&#20132;&#30340;&#27010;&#24565;&#65306;&#20851;&#32852;<SPAN class=emphasis><EM>&#20309;&#26102;</EM></SPAN>&#34987;&#25235;&#21462;&#65292;&#20197;&#21450;&#34987;<SPAN 
class=emphasis><EM>&#22914;&#20309;</EM></SPAN>&#25235;&#21462;&#65288;&#20250;&#37319;&#29992;&#20160;&#20040;&#26679;&#30340;SQL&#35821;&#21477;&#65289;&#12290;&#19981;&#35201;&#28151;&#28102;&#23427;&#20204;&#65281;&#25105;&#20204;&#20351;&#29992;<TT 
class=literal>&#25235;&#21462;</TT>&#26469;&#25913;&#21892;&#24615;&#33021;&#12290;&#25105;&#20204;&#20351;&#29992;<TT 
class=literal>&#24310;&#36831;</TT>&#26469;&#23450;&#20041;&#19968;&#20123;&#22865;&#32422;&#65292;&#23545;&#26576;&#29305;&#23450;&#31867;&#30340;&#26576;&#20010;&#33073;&#31649;&#30340;&#23454;&#20363;&#65292;&#30693;&#36947;&#26377;&#21738;&#20123;&#25968;&#25454;&#26159;&#21487;&#20197;&#20351;&#29992;&#30340;&#12290; </P>
<DIV lang=zh-cn class=sect2>
<DIV class=titlepage>
<DIV>
<DIV>
<H3 class=title><A 
name=performance-fetching-lazy></A>19.1.1.&nbsp;&#25805;&#20316;&#24310;&#36831;&#21152;&#36733;&#30340;&#20851;&#32852;</H3></DIV></DIV>
<DIV></DIV></DIV>
<P>&#40664;&#35748;&#24773;&#20917;&#19979;&#65292;Hibernate 
3&#23545;&#38598;&#21512;&#20351;&#29992;&#24310;&#36831;select&#25235;&#21462;&#65292;&#23545;&#36820;&#22238;&#21333;&#20540;&#30340;&#20851;&#32852;&#20351;&#29992;&#24310;&#36831;&#20195;&#29702;&#25235;&#21462;&#12290;&#23545;&#20960;&#20046;&#26159;&#25152;&#26377;&#30340;&#24212;&#29992;&#32780;&#35328;&#65292;&#20854;&#32477;&#22823;&#22810;&#25968;&#30340;&#20851;&#32852;&#65292;&#36825;&#31181;&#31574;&#30053;&#37117;&#26159;&#26377;&#25928;&#30340;&#12290; </P>
<P><SPAN class=emphasis><EM>&#27880;&#24847;:</EM></SPAN>&#20551;&#33509;&#20320;&#35774;&#32622;&#20102;<TT 
class=literal>hibernate.default_batch_fetch_size</TT>,Hibernate&#20250;&#23545;&#24310;&#36831;&#21152;&#36733;&#37319;&#21462;&#25209;&#37327;&#25235;&#21462;&#20248;&#21270;&#25514;&#26045;&#65288;&#36825;&#31181;&#20248;&#21270;&#20063;&#21487;&#33021;&#20250;&#22312;&#26356;&#32454;&#21270;&#30340;&#32423;&#21035;&#25171;&#24320;&#65289;&#12290; 
</P>
<P>&#28982;&#32780;&#65292;&#20320;&#24517;&#39035;&#20102;&#35299;&#24310;&#36831;&#25235;&#21462;&#24102;&#26469;&#30340;&#19968;&#20010;&#38382;&#39064;&#12290;&#22312;&#19968;&#20010;&#25171;&#24320;&#30340;Hibernate session&#19978;&#19979;&#25991;&#20043;&#22806;&#35843;&#29992;&#24310;&#36831;&#38598;&#21512;&#20250;&#23548;&#33268;&#19968;&#27425;&#24847;&#22806;&#12290;&#27604;&#22914;&#65306; </P><PRE class=programlisting>s = sessions.openSession();
Transaction tx = s.beginTransaction();
            
User u = (User) s.createQuery("from User u where u.name=:userName")
	.setString("userName", userName).uniqueResult();
Map permissions = u.getPermissions();

tx.commit();
s.close();

Integer accessLevel = (Integer) permissions.get("accounts");  // Error!</PRE>
<P>&#22312;<TT class=literal>Session</TT>&#20851;&#38381;&#21518;&#65292;permessions&#38598;&#21512;&#23558;&#26159;&#26410;&#23454;&#20363;&#21270;&#30340;&#12289;&#19981;&#20877;&#21487;&#29992;&#65292;&#22240;&#27492;&#26080;&#27861;&#27491;&#24120;&#36733;&#20837;&#20854;&#29366;&#24577;&#12290; 
<SPAN class=emphasis><EM>Hibernate&#23545;&#33073;&#31649;&#23545;&#35937;&#19981;&#25903;&#25345;&#24310;&#36831;&#23454;&#20363;&#21270;</EM></SPAN>. 
&#36825;&#37324;&#30340;&#20462;&#25913;&#26041;&#27861;&#26159;&#65306;&#23558;permissions&#35835;&#21462;&#25968;&#25454;&#30340;&#20195;&#30721; &#31227;&#21040;tx.commit()&#20043;&#21069;&#12290; </P>
<P>&#38500;&#27492;&#20043;&#22806;&#65292;&#36890;&#36807;&#23545;&#20851;&#32852;&#26144;&#23556;&#25351;&#23450;<TT class=literal>lazy="false"</TT>,&#25105;&#20204;&#20063;&#21487;&#20197;&#20351;&#29992;&#38750;&#24310;&#36831;&#30340;&#38598;&#21512;&#25110;&#20851;&#32852;&#12290;&#20294;&#26159;&#65292; 
&#23545;&#32477;&#22823;&#37096;&#20998;&#38598;&#21512;&#26469;&#35828;&#65292;&#26356;&#25512;&#33616;&#20351;&#29992;&#24310;&#36831;&#26041;&#24335;&#25235;&#21462;&#25968;&#25454;&#12290;&#22914;&#26524;&#22312;&#20320;&#30340;&#23545;&#35937;&#27169;&#22411;&#20013;&#23450;&#20041;&#20102;&#22826;&#22810;&#30340;&#38750;&#24310;&#36831;&#20851;&#32852;&#65292;Hibernate&#26368;&#32456;&#20960;&#20046;&#38656;&#35201;&#22312;&#27599;&#20010;&#20107;&#21153;&#20013;&#36733;&#20837;&#25972;&#20010;&#25968;&#25454;&#24211;&#21040;&#20869;&#23384;&#20013;&#65281; 
</P>
<P>&#20294;&#26159;&#65292;&#21478;&#19968;&#26041;&#38754;&#65292;&#22312;&#19968;&#20123;&#29305;&#27530;&#30340;&#20107;&#21153;&#20013;&#65292;&#25105;&#20204;&#20063;&#32463;&#24120;&#38656;&#35201;&#20351;&#29992;&#21040;&#36830;&#25509;&#25235;&#21462;&#65288;&#23427;&#26412;&#36523;&#19978;&#23601;&#26159;&#38750;&#24310;&#36831;&#30340;&#65289;&#65292;&#20197;&#20195;&#26367;&#26597;&#35810;&#25235;&#21462;&#12290; 
&#19979;&#38754;&#25105;&#20204;&#23558;&#20250;&#24456;&#24555;&#26126;&#30333;&#22914;&#20309;&#20855;&#20307;&#30340;&#23450;&#21046;Hibernate&#20013;&#30340;&#25235;&#21462;&#31574;&#30053;&#12290;&#22312;Hibernate3&#20013;&#65292;&#20855;&#20307;&#36873;&#25321;&#21738;&#31181;&#25235;&#21462;&#31574;&#30053;&#30340;&#26426;&#21046;&#26159;&#21644;&#36873;&#25321; &#21333;&#20540;&#20851;&#32852;&#25110;&#38598;&#21512;&#20851;&#32852;&#30456;&#19968;&#33268;&#30340;&#12290; 
</P></DIV>
<DIV lang=zh-cn class=sect2>
<DIV class=titlepage>
<DIV>
<DIV>
<H3 class=title><A name=performance-fetching-custom></A>19.1.2.&nbsp; 
&#35843;&#25972;&#25235;&#21462;&#31574;&#30053;&#65288;Tuning fetch strategies&#65289; </H3></DIV></DIV>
<DIV></DIV></DIV>
<P>&#26597;&#35810;&#25235;&#21462;&#65288;&#40664;&#35748;&#30340;&#65289;&#22312;N+1&#26597;&#35810;&#30340;&#24773;&#20917;&#19979;&#26159;&#26497;&#20854;&#33030;&#24369;&#30340;&#65292;&#22240;&#27492;&#25105;&#20204;&#21487;&#33021;&#20250;&#35201;&#27714;&#22312;&#26144;&#23556;&#25991;&#26723;&#20013;&#23450;&#20041;&#20351;&#29992;&#36830;&#25509;&#25235;&#21462;&#65306; </P><PRE class=programlisting>&lt;set name="permissions" 
            fetch="join"&gt;
    &lt;key column="userId"/&gt;
    &lt;one-to-many class="Permission"/&gt;
&lt;/set</PRE><PRE class=programlisting>&lt;many-to-one name="mother" class="Cat" fetch="join"/&gt;</PRE>
<P>&#22312;&#26144;&#23556;&#25991;&#26723;&#20013;&#23450;&#20041;&#30340;<TT class=literal>&#25235;&#21462;</TT>&#31574;&#30053;&#23558;&#20250;&#23545;&#20197;&#19979;&#21015;&#34920;&#26465;&#30446;&#20135;&#29983;&#24433;&#21709;&#65306; </P>
<DIV class=itemizedlist>
<UL type=disc>
  <LI>
  <P>&#36890;&#36807;<TT class=literal>get()</TT>&#25110;<TT class=literal>load()</TT>&#26041;&#27861;&#21462;&#24471;&#25968;&#25454;&#12290; </P>
  <LI>
  <P>&#21482;&#26377;&#22312;&#20851;&#32852;&#20043;&#38388;&#36827;&#34892;&#23548;&#33322;&#26102;&#65292;&#25165;&#20250;&#38544;&#24335;&#30340;&#21462;&#24471;&#25968;&#25454;&#12290; </P>
  <LI>
  <P><TT class=literal>&#26465;&#20214;&#26597;&#35810;</TT> </P>
  <LI>
  <P>&#20351;&#29992;&#20102;<TT class=literal>subselect</TT>&#25235;&#21462;&#30340;HQL&#26597;&#35810; </P></LI></UL></DIV>
<P>&#19981;&#31649;&#20320;&#20351;&#29992;&#21738;&#31181;&#25235;&#21462;&#31574;&#30053;&#65292;&#23450;&#20041;&#20026;&#38750;&#24310;&#36831;&#30340;&#31867;&#22270;&#20250;&#34987;&#20445;&#35777;&#19968;&#23450;&#35013;&#36733;&#20837;&#20869;&#23384;&#12290;&#27880;&#24847;&#36825;&#21487;&#33021;&#24847;&#21619;&#30528;&#22312;&#19968;&#26465;HQL&#26597;&#35810;&#21518;&#32039;&#36319;&#30528;&#19968;&#31995;&#21015;&#30340;&#26597;&#35810;&#12290; </P>
<P>&#36890;&#24120;&#24773;&#20917;&#19979;&#65292;&#25105;&#20204;&#24182;&#19981;&#20351;&#29992;&#26144;&#23556;&#25991;&#26723;&#36827;&#34892;&#25235;&#21462;&#31574;&#30053;&#30340;&#23450;&#21046;&#12290;&#26356;&#22810;&#30340;&#26159;&#65292;&#20445;&#25345;&#20854;&#40664;&#35748;&#20540;&#65292;&#28982;&#21518;&#22312;&#29305;&#23450;&#30340;&#20107;&#21153;&#20013;&#65292; &#20351;&#29992;HQL&#30340;<TT 
class=literal>&#24038;&#36830;&#25509;&#25235;&#21462;&#65288;left join fetch&#65289;</TT> &#23545;&#20854;&#36827;&#34892;&#37325;&#36733;&#12290;&#36825;&#23558;&#36890;&#30693; 
Hibernate&#22312;&#31532;&#19968;&#27425;&#26597;&#35810;&#20013;&#20351;&#29992;&#22806;&#37096;&#20851;&#32852;&#65288;outer join&#65289;&#65292;&#30452;&#25509;&#24471;&#21040;&#20854;&#20851;&#32852;&#25968;&#25454;&#12290; &#22312;<TT class=literal>&#26465;&#20214;&#26597;&#35810;</TT> 
API&#20013;&#65292;&#24212;&#35813;&#35843;&#29992; <TT class=literal>setFetchMode(FetchMode.JOIN)</TT>&#35821;&#21477;&#12290; </P>
<P>&#20063;&#35768;&#20320;&#21916;&#27426;&#20165;&#20165;&#36890;&#36807;&#26465;&#20214;&#26597;&#35810;&#65292;&#23601;&#21487;&#20197;&#25913;&#21464;<TT class=literal>get()</TT> &#25110; <TT 
class=literal>load()</TT>&#35821;&#21477;&#20013;&#30340;&#25968;&#25454;&#25235;&#21462;&#31574;&#30053;&#12290;&#20363;&#22914;&#65306; </P><PRE class=programlisting>User user = (User) session.createCriteria(User.class)
            	.setFetchMode("permissions", FetchMode.JOIN)
            	.add( Restrictions.idEq(userId) )
            	.uniqueResult();</PRE>
<P>&#65288;&#36825;&#23601;&#26159;&#20854;&#20182;ORM&#35299;&#20915;&#26041;&#26696;&#30340;“&#25235;&#21462;&#35745;&#21010;(fetch plan)”&#22312;Hibernate&#20013;&#30340;&#31561;&#20215;&#29289;&#12290;&#65289; </P>
<P>&#25130;&#28982;&#19981;&#21516;&#30340;&#19968;&#31181;&#36991;&#20813;N+1&#27425;&#26597;&#35810;&#30340;&#26041;&#27861;&#26159;&#65292;&#20351;&#29992;&#20108;&#32423;&#32531;&#23384;&#12290; </P></DIV>
<DIV lang=zh-cn class=sect2>
<DIV class=titlepage>
<DIV>
<DIV>
<H3 class=title><A 
name=performance-fetching-proxies></A>19.1.3.&nbsp;&#21333;&#31471;&#20851;&#32852;&#20195;&#29702;&#65288;Single-ended 
association proxies&#65289; </H3></DIV></DIV>
<DIV></DIV></DIV>
<P>&#22312;Hinerbate&#20013;&#65292;&#23545;&#38598;&#21512;&#30340;&#24310;&#36831;&#25235;&#21462;&#30340;&#37319;&#29992;&#20102;&#33258;&#24049;&#30340;&#23454;&#29616;&#26041;&#27861;&#12290;&#20294;&#26159;&#65292;&#23545;&#20110;&#21333;&#31471;&#20851;&#32852;&#30340;&#24310;&#36831;&#25235;&#21462;&#65292;&#21017;&#38656;&#35201;&#37319;&#29992; 
&#20854;&#20182;&#19981;&#21516;&#30340;&#26426;&#21046;&#12290;&#21333;&#31471;&#20851;&#32852;&#30340;&#30446;&#26631;&#23454;&#20307;&#24517;&#39035;&#20351;&#29992;&#20195;&#29702;&#65292;Hihernate&#22312;&#36816;&#34892;&#26399;&#20108;&#36827;&#21046;&#32423;&#65288;&#36890;&#36807;&#20248;&#24322;&#30340;CGLIB&#24211;&#65289;&#65292; &#20026;&#25345;&#20037;&#23545;&#35937;&#23454;&#29616;&#20102;&#24310;&#36831;&#36733;&#20837;&#20195;&#29702;&#12290; </P>
<P>&#40664;&#35748;&#30340;&#65292;Hibernate3&#23558;&#20250;&#20026;&#25152;&#26377;&#30340;&#25345;&#20037;&#23545;&#35937;&#20135;&#29983;&#20195;&#29702;&#65288;&#22312;&#21551;&#21160;&#38454;&#27573;&#65289;&#65292;&#28982;&#21518;&#20351;&#29992;&#20182;&#20204;&#23454;&#29616; <TT 
class=literal>&#22810;&#23545;&#19968;&#65288;many-to-one&#65289;</TT>&#20851;&#32852;&#21644;<TT class=literal>&#19968;&#23545;&#19968;&#65288;one-to-one&#65289;</TT> 
&#20851;&#32852;&#30340;&#24310;&#36831;&#25235;&#21462;&#12290; </P>
<P>&#22312;&#26144;&#23556;&#25991;&#20214;&#20013;&#65292;&#21487;&#20197;&#36890;&#36807;&#35774;&#32622;<TT class=literal>proxy</TT>&#23646;&#24615;&#20026;&#30446;&#26631;class&#22768;&#26126;&#19968;&#20010;&#25509;&#21475;&#20379;&#20195;&#29702;&#25509;&#21475;&#20351;&#29992;&#12290; 
&#40664;&#35748;&#30340;&#65292;Hibernate&#23558;&#20250;&#20351;&#29992;&#35813;&#31867;&#30340;&#19968;&#20010;&#23376;&#31867;&#12290; <SPAN 
class=emphasis><EM>&#27880;&#24847;&#65306;&#34987;&#20195;&#29702;&#30340;&#31867;&#24517;&#39035;&#23454;&#29616;&#19968;&#20010;&#33267;&#23569;&#21253;&#21487;&#35265;&#30340;&#40664;&#35748;&#26500;&#36896;&#20989;&#25968;&#65292;&#25105;&#20204;&#24314;&#35758;&#25152;&#26377;&#30340;&#25345;&#20037;&#31867;&#37117;&#24212;&#25317;&#26377;&#36825;&#26679;&#30340;&#26500;&#36896;&#20989;&#25968;</EM></SPAN> 
</P>
<P>&#22312;&#22914;&#27492;&#26041;&#24335;&#23450;&#20041;&#19968;&#20010;&#22810;&#24577;&#31867;&#30340;&#26102;&#20505;&#65292;&#26377;&#35768;&#22810;&#20540;&#24471;&#27880;&#24847;&#30340;&#24120;&#35265;&#24615;&#30340;&#38382;&#39064;&#65292;&#20363;&#22914;&#65306; </P><PRE class=programlisting>&lt;class name="Cat" proxy="Cat"&gt;
    ......
    &lt;subclass name="DomesticCat"&gt;
        .....
    &lt;/subclass&gt;
&lt;/class&gt;</PRE>
<P>&#39318;&#20808;&#65292;<TT class=literal>Cat</TT>&#23454;&#20363;&#27704;&#36828;&#19981;&#21487;&#20197;&#34987;&#24378;&#21046;&#36716;&#25442;&#20026;<TT class=literal>DomesticCat</TT>, 
&#21363;&#20351;&#23427;&#26412;&#36523;&#23601;&#26159;<TT class=literal>DomesticCat</TT>&#23454;&#20363;&#12290; </P><PRE class=programlisting>Cat cat = (Cat) session.load(Cat.class, id);  // instantiate a proxy (does not hit the db)
if ( cat.isDomesticCat() ) {                  // hit the db to initialize the proxy
    DomesticCat dc = (DomesticCat) cat;       // Error!
    ....
}</PRE>
<P>&#20854;&#27425;&#65292;&#20195;&#29702;&#30340;“<TT class=literal>==</TT>”&#21487;&#33021;&#19981;&#20877;&#25104;&#31435;&#12290; </P><PRE class=programlisting>Cat cat = (Cat) session.load(Cat.class, id);            // instantiate a Cat proxy
DomesticCat dc = 
        (DomesticCat) session.load(DomesticCat.class, id);  // acquire new DomesticCat proxy!
System.out.println(cat==dc);                            // false</PRE>
<P>&#34429;&#28982;&#22914;&#27492;&#65292;&#20294;&#23454;&#38469;&#24773;&#20917;&#24182;&#27809;&#26377;&#30475;&#19978;&#21435;&#37027;&#20040;&#31967;&#31957;&#12290;&#34429;&#28982;&#25105;&#20204;&#29616;&#22312;&#26377;&#20004;&#20010;&#19981;&#21516;&#30340;&#24341;&#29992;&#65292;&#20998;&#21035;&#25351;&#21521;&#36825;&#20004;&#20010;&#19981;&#21516;&#30340;&#20195;&#29702;&#23545;&#35937;&#65292; &#20294;&#23454;&#38469;&#19978;&#65292;&#20854;&#24213;&#23618;&#24212;&#35813;&#26159;&#21516;&#19968;&#20010;&#23454;&#20363;&#23545;&#35937;&#65306; </P><PRE class=programlisting>cat.setWeight(11.0);  // hit the db to initialize the proxy
System.out.println( dc.getWeight() );  // 11.0</PRE>
<P>&#31532;&#19977;&#65292;&#20320;&#19981;&#33021;&#23545;“final&#31867;”&#25110;“&#20855;&#26377;final&#26041;&#27861;&#30340;&#31867;”&#20351;&#29992;CGLIB&#20195;&#29702;&#12290; </P>
<P>&#26368;&#21518;&#65292;&#22914;&#26524;&#20320;&#30340;&#25345;&#20037;&#21270;&#23545;&#35937;&#22312;&#23454;&#20363;&#21270;&#26102;&#38656;&#35201;&#26576;&#20123;&#36164;&#28304;&#65288;&#20363;&#22914;&#65292;&#22312;&#23454;&#20363;&#21270;&#26041;&#27861;&#12289;&#40664;&#35748;&#26500;&#36896;&#26041;&#27861;&#20013;&#65289;&#65292; 
&#37027;&#20040;&#20195;&#29702;&#23545;&#35937;&#20063;&#21516;&#26679;&#38656;&#35201;&#20351;&#29992;&#36825;&#20123;&#36164;&#28304;&#12290;&#23454;&#38469;&#19978;&#65292;&#20195;&#29702;&#31867;&#26159;&#25345;&#20037;&#21270;&#31867;&#30340;&#23376;&#31867;&#12290; </P>
<P>&#36825;&#20123;&#38382;&#39064;&#37117;&#28304;&#20110;Java&#30340;&#21333;&#26681;&#32487;&#25215;&#27169;&#22411;&#30340;&#22825;&#29983;&#38480;&#21046;&#12290;&#22914;&#26524;&#20320;&#24076;&#26395;&#36991;&#20813;&#36825;&#20123;&#38382;&#39064;&#65292;&#37027;&#20040;&#20320;&#30340;&#27599;&#20010;&#25345;&#20037;&#21270;&#31867;&#24517;&#39035;&#23454;&#29616;&#19968;&#20010;&#25509;&#21475;&#65292; 
&#22312;&#27492;&#25509;&#21475;&#20013;&#24050;&#32463;&#22768;&#26126;&#20102;&#20854;&#19994;&#21153;&#26041;&#27861;&#12290;&#28982;&#21518;&#65292;&#20320;&#38656;&#35201;&#22312;&#26144;&#23556;&#25991;&#26723;&#20013;&#20877;&#25351;&#23450;&#36825;&#20123;&#25509;&#21475;&#12290;&#20363;&#22914;&#65306; </P><PRE class=programlisting>&lt;class name="CatImpl" proxy="Cat"&gt;
    ......
    &lt;subclass name="DomesticCatImpl" proxy="DomesticCat"&gt;
        .....
    &lt;/subclass&gt;
&lt;/class&gt;</PRE>
<P>&#36825;&#37324;<TT class=literal>CatImpl</TT>&#23454;&#29616;&#20102;<TT class=literal>Cat</TT>&#25509;&#21475;&#65292; <TT 
class=literal>DomesticCatImpl</TT>&#23454;&#29616;<TT class=literal>DomesticCat</TT>&#25509;&#21475;&#12290; &#22312;<TT 
class=literal>load()</TT>&#12289;<TT class=literal>iterate()</TT>&#26041;&#27861;&#20013;&#23601;&#20250;&#36820;&#22238; <TT 
class=literal>Cat</TT>&#21644;<TT class=literal>DomesticCat</TT>&#30340;&#20195;&#29702;&#23545;&#35937;&#12290; (&#27880;&#24847;<TT 
class=literal>list()</TT>&#24182;&#19981;&#20250;&#36820;&#22238;&#20195;&#29702;&#23545;&#35937;&#12290;) </P><PRE class=programlisting>Cat cat = (Cat) session.load(CatImpl.class, catid);
Iterator iter = session.iterate("from CatImpl as cat where cat.name='fritz'");
Cat fritz = (Cat) iter.next();</PRE>
<P>&#36825;&#37324;&#65292;&#23545;&#35937;&#20043;&#38388;&#30340;&#20851;&#31995;&#20063;&#23558;&#34987;&#24310;&#36831;&#36733;&#20837;&#12290;&#36825;&#23601;&#24847;&#21619;&#30528;&#65292;&#20320;&#24212;&#35813;&#23558;&#23646;&#24615;&#22768;&#26126;&#20026;<TT class=literal>Cat</TT>&#65292;&#32780;&#19981;&#26159;<TT 
class=literal>CatImpl</TT>&#12290; </P>
<P>&#20294;&#26159;&#65292;&#22312;&#26377;&#20123;&#26041;&#27861;&#20013;&#26159;<SPAN class=emphasis><EM>&#19981;&#38656;&#35201;</EM></SPAN>&#20351;&#29992;&#20195;&#29702;&#30340;&#12290;&#20363;&#22914;&#65306; </P>
<DIV class=itemizedlist>
<UL type=disc compact>
  <LI>
  <P><TT class=literal>equals()</TT>&#26041;&#27861;&#65292;&#22914;&#26524;&#25345;&#20037;&#31867;&#27809;&#26377;&#37325;&#36733;<TT 
  class=literal>equals()</TT>&#26041;&#27861;&#12290; </P>
  <LI>
  <P><TT class=literal>hashCode()</TT>&#26041;&#27861;&#65292;&#22914;&#26524;&#25345;&#20037;&#31867;&#27809;&#26377;&#37325;&#36733;<TT 
  class=literal>hashCode()</TT>&#26041;&#27861;&#12290; </P>
  <LI>
  <P>&#26631;&#24535;&#31526;&#30340;getter&#26041;&#27861;&#12290; </P></LI></UL></DIV>
<P>Hibernate&#23558;&#20250;&#35782;&#21035;&#20986;&#37027;&#20123;&#37325;&#36733;&#20102;<TT class=literal>equals()</TT>&#12289;&#25110;<TT 
class=literal>hashCode()</TT>&#26041;&#27861;&#30340;&#25345;&#20037;&#21270;&#31867;&#12290; </P>
<P>&#33509;&#36873;&#25321;<TT class=literal>lazy="no-proxy"</TT>&#32780;&#38750;&#40664;&#35748;&#30340;<TT 
class=literal>lazy="proxy"</TT>&#65292;&#25105;&#20204;&#21487;&#20197;&#36991;&#20813;&#31867;&#22411;&#36716;&#25442;&#24102;&#26469;&#30340;&#38382;&#39064;&#12290;&#28982;&#32780;&#65292;&#36825;&#26679;&#25105;&#20204;&#23601;&#38656;&#35201;&#32534;&#35793;&#26399;&#23383;&#33410;&#30721;&#22686;&#24378;&#65292;&#24182;&#19988;&#25152;&#26377;&#30340;&#25805;&#20316;&#37117;&#20250;&#23548;&#33268;&#31435;&#21051;&#36827;&#34892;&#20195;&#29702;&#21021;&#22987;&#21270;&#12290; 
</P></DIV>
<DIV lang=zh-cn class=sect2>
<DIV class=titlepage>
<DIV>
<DIV>
<H3 class=title><A 
name=performance-fetching-initialization></A>19.1.4.&nbsp;&#23454;&#20363;&#21270;&#38598;&#21512;&#21644;&#20195;&#29702;&#65288;Initializing 
collections and proxies&#65289; </H3></DIV></DIV>
<DIV></DIV></DIV>
<P>&#22312;<TT class=literal>Session</TT>&#33539;&#22260;&#20043;&#22806;&#35775;&#38382;&#26410;&#21021;&#22987;&#21270;&#30340;&#38598;&#21512;&#25110;&#20195;&#29702;&#65292;Hibernate&#23558;&#20250;&#25243;&#20986;<TT 
class=literal>LazyInitializationException</TT>&#24322;&#24120;&#12290; 
&#20063;&#23601;&#26159;&#35828;&#65292;&#22312;&#20998;&#31163;&#29366;&#24577;&#19979;&#65292;&#35775;&#38382;&#19968;&#20010;&#23454;&#20307;&#25152;&#25317;&#26377;&#30340;&#38598;&#21512;&#65292;&#25110;&#32773;&#35775;&#38382;&#20854;&#25351;&#21521;&#20195;&#29702;&#30340;&#23646;&#24615;&#26102;&#65292;&#20250;&#24341;&#21457;&#27492;&#24322;&#24120;&#12290; </P>
<P>&#26377;&#26102;&#20505;&#25105;&#20204;&#38656;&#35201;&#20445;&#35777;&#26576;&#20010;&#20195;&#29702;&#25110;&#32773;&#38598;&#21512;&#22312;Session&#20851;&#38381;&#21069;&#23601;&#24050;&#32463;&#34987;&#21021;&#22987;&#21270;&#20102;&#12290; &#24403;&#28982;&#65292;&#25105;&#20204;&#21487;&#20197;&#36890;&#36807;&#24378;&#34892;&#35843;&#29992;<TT 
class=literal>cat.getSex()</TT>&#25110;&#32773;<TT 
class=literal>cat.getKittens().size()</TT>&#20043;&#31867;&#30340;&#26041;&#27861;&#26469;&#30830;&#20445;&#36825;&#19968;&#28857;&#12290; 
&#20294;&#26159;&#36825;&#26679;&#30340;&#31243;&#24207;&#20250;&#36896;&#25104;&#35835;&#32773;&#30340;&#30097;&#24785;&#65292;&#20063;&#19981;&#31526;&#21512;&#36890;&#24120;&#30340;&#20195;&#30721;&#35268;&#33539;&#12290; </P>
<P>&#38745;&#24577;&#26041;&#27861;<TT class=literal>Hibernate.initialized()</TT> 
&#20026;&#20320;&#30340;&#24212;&#29992;&#31243;&#24207;&#25552;&#20379;&#20102;&#19968;&#20010;&#20415;&#25463;&#30340;&#36884;&#24452;&#26469;&#24310;&#36831;&#21152;&#36733;&#38598;&#21512;&#25110;&#20195;&#29702;&#12290; &#21482;&#35201;&#23427;&#30340;Session&#22788;&#20110;open&#29366;&#24577;&#65292;<TT 
class=literal>Hibernate.initialize(cat)</TT> &#23558;&#20250;&#20026;cat&#24378;&#21046;&#23545;&#20195;&#29702;&#23454;&#20363;&#21270;&#12290; &#21516;&#26679;&#65292;<TT 
class=literal>Hibernate.initialize( cat.getKittens() )</TT> &#23545;kittens&#30340;&#38598;&#21512;&#20855;&#26377;&#21516;&#26679;&#30340;&#21151;&#33021;&#12290; 
</P>
<P>&#36824;&#26377;&#21478;&#22806;&#19968;&#31181;&#36873;&#25321;&#65292;&#23601;&#26159;&#20445;&#25345;<TT class=literal>Session</TT>&#19968;&#30452;&#22788;&#20110;open&#29366;&#24577;&#65292;&#30452;&#21040;&#25152;&#26377;&#38656;&#35201;&#30340;&#38598;&#21512;&#25110;&#20195;&#29702;&#37117;&#34987;&#36733;&#20837;&#12290; 
&#22312;&#26576;&#20123;&#24212;&#29992;&#26550;&#26500;&#20013;&#65292;&#29305;&#21035;&#26159;&#23545;&#20110;&#37027;&#20123;&#20351;&#29992;Hibernate&#36827;&#34892;&#25968;&#25454;&#35775;&#38382;&#30340;&#20195;&#30721;&#65292;&#20197;&#21450;&#37027;&#20123;&#22312;&#19981;&#21516;&#24212;&#29992;&#23618;&#21644;&#19981;&#21516;&#29289;&#29702;&#36827;&#31243;&#20013;&#20351;&#29992;Hibernate&#30340;&#20195;&#30721;&#12290; 
&#22312;&#38598;&#21512;&#23454;&#20363;&#21270;&#26102;&#65292;&#22914;&#20309;&#20445;&#35777;<TT class=literal>Session</TT>&#22788;&#20110;open&#29366;&#24577;&#32463;&#24120;&#20250;&#26159;&#19968;&#20010;&#38382;&#39064;&#12290;&#26377;&#20004;&#31181;&#26041;&#27861;&#21487;&#20197;&#35299;&#20915;&#27492;&#38382;&#39064;&#65306; </P>
<DIV class=itemizedlist>
<UL type=disc>
  <LI>
  <P>&#22312;&#19968;&#20010;&#22522;&#20110;Web&#30340;&#24212;&#29992;&#20013;&#65292;&#21487;&#20197;&#21033;&#29992;servlet&#36807;&#28388;&#22120;&#65288;filter&#65289;&#65292;&#22312;&#29992;&#25143;&#35831;&#27714;&#65288;request&#65289;&#32467;&#26463;&#12289;&#39029;&#38754;&#29983;&#25104; &#32467;&#26463;&#26102;&#20851;&#38381;<TT 
  class=literal>Session</TT>&#65288;&#36825;&#37324;&#20351;&#29992;&#20102;<SPAN 
  class=emphasis><EM>&#22312;&#23637;&#31034;&#23618;&#20445;&#25345;&#25171;&#24320;Session&#27169;&#24335;&#65288;Open Session in View&#65289;</EM></SPAN>&#65289;&#65292; 
  &#24403;&#28982;&#65292;&#36825;&#23558;&#20381;&#36182;&#20110;&#24212;&#29992;&#26694;&#26550;&#20013;&#24322;&#24120;&#38656;&#35201;&#34987;&#27491;&#30830;&#30340;&#22788;&#29702;&#12290;&#22312;&#36820;&#22238;&#30028;&#38754;&#32473;&#29992;&#25143;&#20043;&#21069;&#65292;&#20035;&#33267;&#22312;&#29983;&#25104;&#30028;&#38754;&#36807;&#31243;&#20013;&#21457;&#29983;&#24322;&#24120;&#30340;&#24773;&#20917;&#19979;&#65292; &#27491;&#30830;&#20851;&#38381;<TT 
  class=literal>Session</TT>&#21644;&#32467;&#26463;&#20107;&#21153;&#23558;&#26159;&#38750;&#24120;&#37325;&#35201;&#30340;&#65292; &#35831;&#21442;&#35265;Hibernate wiki&#19978;&#30340;"Open Session in 
  View"&#27169;&#24335;&#65292;&#20320;&#21487;&#20197;&#25214;&#21040;&#31034;&#20363;&#12290; </P>
  <LI>
  <P>&#22312;&#19968;&#20010;&#25317;&#26377;&#21333;&#29420;&#19994;&#21153;&#23618;&#30340;&#24212;&#29992;&#20013;&#65292;&#19994;&#21153;&#23618;&#24517;&#39035;&#22312;&#36820;&#22238;&#20043;&#21069;&#65292;&#20026;web&#23618;“&#20934;&#22791;”&#22909;&#20854;&#25152;&#38656;&#30340;&#25968;&#25454;&#38598;&#21512;&#12290;&#36825;&#23601;&#24847;&#21619;&#30528; 
  &#19994;&#21153;&#23618;&#24212;&#35813;&#36733;&#20837;&#25152;&#26377;&#34920;&#29616;&#23618;/web&#23618;&#25152;&#38656;&#30340;&#25968;&#25454;&#65292;&#24182;&#23558;&#36825;&#20123;&#24050;&#23454;&#20363;&#21270;&#23436;&#27605;&#30340;&#25968;&#25454;&#36820;&#22238;&#12290;&#36890;&#24120;&#65292;&#24212;&#29992;&#31243;&#24207;&#24212;&#35813; &#20026;web&#23618;&#25152;&#38656;&#30340;&#27599;&#20010;&#38598;&#21512;&#35843;&#29992;<TT 
  class=literal>Hibernate.initialize()</TT>&#65288;&#36825;&#20010;&#35843;&#29992;&#24517;&#39035;&#21457;&#29983;&#21681;session&#20851;&#38381;&#20043;&#21069;&#65289;&#65307; &#25110;&#32773;&#20351;&#29992;&#24102;&#26377;<TT 
  class=literal>FETCH</TT>&#20174;&#21477;&#65292;&#25110;<TT class=literal>FetchMode.JOIN</TT>&#30340;Hibernate&#26597;&#35810;&#65292; 
  &#20107;&#20808;&#21462;&#24471;&#25152;&#26377;&#30340;&#25968;&#25454;&#38598;&#21512;&#12290;&#22914;&#26524;&#20320;&#22312;&#24212;&#29992;&#20013;&#20351;&#29992;&#20102;<SPAN class=emphasis><EM>Command</EM></SPAN>&#27169;&#24335;&#65292;&#20195;&#26367;<SPAN 
  class=emphasis><EM>Session Facade</EM></SPAN> &#65292; &#37027;&#20040;&#36825;&#39033;&#20219;&#21153;&#23558;&#20250;&#21464;&#24471;&#31616;&#21333;&#30340;&#22810;&#12290; </P>
  <LI>
  <P>&#20320;&#20063;&#21487;&#20197;&#36890;&#36807;<TT class=literal>merge()</TT>&#25110;<TT 
  class=literal>lock()</TT>&#26041;&#27861;&#65292;&#22312;&#35775;&#38382;&#26410;&#23454;&#20363;&#21270;&#30340;&#38598;&#21512;&#65288;&#25110;&#20195;&#29702;&#65289;&#20043;&#21069;&#65292; &#20026;&#20808;&#21069;&#36733;&#20837;&#30340;&#23545;&#35937;&#32465;&#23450;&#19968;&#20010;&#26032;&#30340;<TT 
  class=literal>Session</TT>&#12290; &#26174;&#28982;&#65292;Hibernate&#23558;&#19981;&#20250;&#65292;&#20063;&#19981;<SPAN 
  class=emphasis><EM>&#24212;&#35813;</EM></SPAN>&#33258;&#21160;&#23436;&#25104;&#36825;&#20123;&#20219;&#21153;&#65292;&#22240;&#20026;&#36825;&#23558;&#24341;&#20837;&#19968;&#20010;&#29305;&#27530;&#30340;&#20107;&#21153;&#35821;&#20041;&#12290; </P></LI></UL></DIV>
<P>&#26377;&#26102;&#20505;&#65292;&#20320;&#24182;&#19981;&#38656;&#35201;&#23436;&#20840;&#23454;&#20363;&#21270;&#25972;&#20010;&#22823;&#30340;&#38598;&#21512;&#65292;&#20165;&#38656;&#35201;&#20102;&#35299;&#23427;&#30340;&#37096;&#20998;&#20449;&#24687;&#65288;&#20363;&#22914;&#20854;&#22823;&#23567;&#65289;&#12289;&#25110;&#32773;&#38598;&#21512;&#30340;&#37096;&#20998;&#20869;&#23481;&#12290; </P>
<P>&#20320;&#21487;&#20197;&#20351;&#29992;&#38598;&#21512;&#36807;&#28388;&#22120;&#24471;&#21040;&#20854;&#38598;&#21512;&#30340;&#22823;&#23567;&#65292;&#32780;&#19981;&#24517;&#23454;&#20363;&#21270;&#25972;&#20010;&#38598;&#21512;&#65306; </P><PRE class=programlisting>( (Integer) s.createFilter( collection, "select count(*)" ).list().get(0) ).intValue()</PRE>
<P>&#36825;&#37324;&#30340;<TT class=literal>createFilter()</TT>&#26041;&#27861;&#20063;&#21487;&#20197;&#34987;&#29992;&#26469;&#26377;&#25928;&#30340;&#25235;&#21462;&#38598;&#21512;&#30340;&#37096;&#20998;&#20869;&#23481;&#65292;&#32780;&#26080;&#38656;&#23454;&#20363;&#21270;&#25972;&#20010;&#38598;&#21512;&#65306; </P><PRE class=programlisting>s.createFilter( lazyCollection, "").setFirstResult(0).setMaxResults(10).list();</PRE></DIV>
<DIV lang=zh-cn class=sect2>
<DIV class=titlepage>
<DIV>
<DIV>
<H3 class=title><A name=performance-fetching-batch></A>19.1.5.&nbsp;&#20351;&#29992;&#25209;&#37327;&#25235;&#21462;&#65288;Using 
batch fetching&#65289; </H3></DIV></DIV>
<DIV></DIV></DIV>
<P>Hibernate&#21487;&#20197;&#20805;&#20998;&#26377;&#25928;&#30340;&#20351;&#29992;&#25209;&#37327;&#25235;&#21462;&#65292;&#20063;&#23601;&#26159;&#35828;&#65292;&#22914;&#26524;&#20165;&#19968;&#20010;&#35775;&#38382;&#20195;&#29702;&#65288;&#25110;&#38598;&#21512;&#65289;&#65292;&#37027;&#20040;Hibernate&#23558;&#19981;&#36733;&#20837;&#20854;&#20182;&#26410;&#23454;&#20363;&#21270;&#30340;&#20195;&#29702;&#12290; 
&#25209;&#37327;&#25235;&#21462;&#26159;&#24310;&#36831;&#26597;&#35810;&#25235;&#21462;&#30340;&#20248;&#21270;&#26041;&#26696;&#65292;&#20320;&#21487;&#20197;&#22312;&#20004;&#31181;&#25209;&#37327;&#25235;&#21462;&#26041;&#26696;&#20043;&#38388;&#36827;&#34892;&#36873;&#25321;&#65306;&#22312;&#31867;&#32423;&#21035;&#21644;&#38598;&#21512;&#32423;&#21035;&#12290; </P>
<P>&#31867;/&#23454;&#20307;&#32423;&#21035;&#30340;&#25209;&#37327;&#25235;&#21462;&#24456;&#23481;&#26131;&#29702;&#35299;&#12290;&#20551;&#35774;&#20320;&#22312;&#36816;&#34892;&#26102;&#23558;&#38656;&#35201;&#38754;&#23545;&#19979;&#38754;&#30340;&#38382;&#39064;&#65306;&#20320;&#22312;&#19968;&#20010;<TT class=literal>Session</TT>&#20013;&#36733;&#20837;&#20102;25&#20010; 
<TT class=literal>Cat</TT>&#23454;&#20363;&#65292;&#27599;&#20010;<TT class=literal>Cat</TT>&#23454;&#20363;&#37117;&#25317;&#26377;&#19968;&#20010;&#24341;&#29992;&#25104;&#21592;<TT 
class=literal>owner</TT>&#65292; &#20854;&#25351;&#21521;<TT class=literal>Person</TT>&#65292;&#32780;<TT 
class=literal>Person</TT>&#31867;&#26159;&#20195;&#29702;&#65292;&#21516;&#26102;<TT class=literal>lazy="true"</TT>&#12290; 
&#22914;&#26524;&#20320;&#24517;&#39035;&#36941;&#21382;&#25972;&#20010;cats&#38598;&#21512;&#65292;&#23545;&#27599;&#20010;&#20803;&#32032;&#35843;&#29992;<TT 
class=literal>getOwner()</TT>&#26041;&#27861;&#65292;Hibernate&#23558;&#20250;&#40664;&#35748;&#30340;&#25191;&#34892;25&#27425;<TT 
class=literal>SELECT</TT>&#26597;&#35810;&#65292; &#24471;&#21040;&#20854;owner&#30340;&#20195;&#29702;&#23545;&#35937;&#12290;&#36825;&#26102;&#65292;&#20320;&#21487;&#20197;&#36890;&#36807;&#22312;&#26144;&#23556;&#25991;&#20214;&#30340;<TT 
class=literal>Person</TT>&#23646;&#24615;&#65292;&#26174;&#24335;&#22768;&#26126;<TT class=literal>batch-size</TT>&#65292;&#25913;&#21464;&#20854;&#34892;&#20026;&#65306; </P><PRE class=programlisting>&lt;class name="Person" batch-size="10"&gt;...&lt;/class&gt;</PRE>
<P>&#38543;&#20043;&#65292;Hibernate&#23558;&#21482;&#38656;&#35201;&#25191;&#34892;&#19977;&#27425;&#26597;&#35810;&#65292;&#20998;&#21035;&#20026;10&#12289;10&#12289; 5&#12290; </P>
<P>&#20320;&#20063;&#21487;&#20197;&#22312;&#38598;&#21512;&#32423;&#21035;&#23450;&#20041;&#25209;&#37327;&#25235;&#21462;&#12290;&#20363;&#22914;&#65292;&#22914;&#26524;&#27599;&#20010;<TT class=literal>Person</TT>&#37117;&#25317;&#26377;&#19968;&#20010;&#24310;&#36831;&#36733;&#20837;&#30340;<TT 
class=literal>Cats</TT>&#38598;&#21512;&#65292; &#29616;&#22312;&#65292;<TT 
class=literal>Sesssion</TT>&#20013;&#36733;&#20837;&#20102;10&#20010;person&#23545;&#35937;&#65292;&#36941;&#21382;person&#38598;&#21512;&#23558;&#20250;&#24341;&#36215;10&#27425;<TT 
class=literal>SELECT</TT>&#26597;&#35810;&#65292; &#27599;&#27425;&#26597;&#35810;&#37117;&#20250;&#35843;&#29992;<TT class=literal>getCats()</TT>&#26041;&#27861;&#12290;&#22914;&#26524;&#20320;&#22312;<TT 
class=literal>Person</TT>&#30340;&#26144;&#23556;&#23450;&#20041;&#37096;&#20998;&#65292;&#20801;&#35768;&#23545;<TT class=literal>cats</TT>&#25209;&#37327;&#25235;&#21462;, 
&#37027;&#20040;&#65292;Hibernate&#23558;&#21487;&#20197;&#39044;&#20808;&#25235;&#21462;&#25972;&#20010;&#38598;&#21512;&#12290;&#35831;&#30475;&#20363;&#23376;&#65306; </P><PRE class=programlisting>&lt;class name="Person"&gt;
    &lt;set name="cats" batch-size="3"&gt;
        ...
    &lt;/set&gt;
&lt;/class&gt;</PRE>
<P>&#22914;&#26524;&#25972;&#20010;&#30340;<TT class=literal>batch-size</TT>&#26159;3&#65288;&#31508;&#35823;&#65311;&#65289;&#65292;&#37027;&#20040;Hibernate&#23558;&#20250;&#20998;&#22235;&#27425;&#25191;&#34892;<TT 
class=literal>SELECT</TT>&#26597;&#35810;&#65292; &#25353;&#29031;3&#12289;3&#12289;3&#12289;1&#30340;&#22823;&#23567;&#20998;&#21035;&#36733;&#20837;&#25968;&#25454;&#12290;&#36825;&#37324;&#30340;&#27599;&#27425;&#36733;&#20837;&#30340;&#25968;&#25454;&#37327;&#36824;&#20855;&#20307;&#20381;&#36182;&#20110;&#24403;&#21069;<TT 
class=literal>Session</TT>&#20013;&#26410;&#23454;&#20363;&#21270;&#38598;&#21512;&#30340;&#20010;&#25968;&#12290; </P>
<P>&#22914;&#26524;&#20320;&#30340;&#27169;&#22411;&#20013;&#26377;&#23884;&#22871;&#30340;&#26641;&#29366;&#32467;&#26500;&#65292;&#20363;&#22914;&#20856;&#22411;&#30340;&#24080;&#21333;&#65293;&#21407;&#26009;&#32467;&#26500;&#65288;bill-of-materials pattern&#65289;&#65292;&#38598;&#21512;&#30340;&#25209;&#37327;&#25235;&#21462;&#26159;&#38750;&#24120;&#26377;&#29992;&#30340;&#12290; 
&#65288;&#23613;&#31649;&#22312;&#26356;&#22810;&#24773;&#20917;&#19979;&#23545;&#26641;&#36827;&#34892;&#35835;&#21462;&#26102;&#65292;<SPAN class=emphasis><EM>&#23884;&#22871;&#38598;&#21512;&#65288;nested set&#65289;</EM></SPAN>&#25110;<SPAN 
class=emphasis><EM>&#21407;&#26009;&#36335;&#24452;(materialized path)</EM></SPAN>&#65288;××&#65289; &#26159;&#26356;&#22909;&#30340;&#35299;&#20915;&#26041;&#27861;&#12290;&#65289; </P></DIV>
<DIV lang=zh-cn class=sect2>
<DIV class=titlepage>
<DIV>
<DIV>
<H3 class=title><A 
name=performance-fetching-subselect></A>19.1.6.&nbsp;&#20351;&#29992;&#23376;&#26597;&#35810;&#25235;&#21462;&#65288;Using subselect 
fetching&#65289; </H3></DIV></DIV>
<DIV></DIV></DIV>
<P>&#20551;&#33509;&#19968;&#20010;&#24310;&#36831;&#38598;&#21512;&#25110;&#21333;&#20540;&#20195;&#29702;&#38656;&#35201;&#25235;&#21462;&#65292;Hibernate&#20250;&#20351;&#29992;&#19968;&#20010;subselect&#37325;&#26032;&#36816;&#34892;&#21407;&#26469;&#30340;&#26597;&#35810;&#65292;&#19968;&#27425;&#24615;&#35835;&#20837;&#25152;&#26377;&#30340;&#23454;&#20363;&#12290;&#36825;&#21644;&#25209;&#37327;&#25235;&#21462;&#30340;&#23454;&#29616;&#26041;&#27861;&#26159;&#19968;&#26679;&#30340;&#65292;&#19981;&#20250;&#26377;&#30772;&#30862;&#30340;&#21152;&#36733;&#12290; 
</P></DIV>
<DIV lang=zh-cn class=sect2>
<DIV class=titlepage>
<DIV>
<DIV>
<H3 class=title><A 
name=performance-fetching-lazyproperties></A>19.1.7.&nbsp;&#20351;&#29992;&#24310;&#36831;&#23646;&#24615;&#25235;&#21462;&#65288;Using lazy 
property fetching&#65289; </H3></DIV></DIV>
<DIV></DIV></DIV>
<P>Hibernate3&#23545;&#21333;&#29420;&#30340;&#23646;&#24615;&#25903;&#25345;&#24310;&#36831;&#25235;&#21462;&#65292;&#36825;&#39033;&#20248;&#21270;&#25216;&#26415;&#20063;&#34987;&#31216;&#20026;<SPAN class=emphasis><EM>&#32452;&#25235;&#21462;&#65288;fetch 
groups&#65289;</EM></SPAN>&#12290; 
&#35831;&#27880;&#24847;&#65292;&#35813;&#25216;&#26415;&#26356;&#22810;&#30340;&#23646;&#20110;&#24066;&#22330;&#29305;&#24615;&#12290;&#22312;&#23454;&#38469;&#24212;&#29992;&#20013;&#65292;&#20248;&#21270;&#34892;&#35835;&#21462;&#27604;&#20248;&#21270;&#21015;&#35835;&#21462;&#26356;&#37325;&#35201;&#12290;&#20294;&#26159;&#65292;&#20165;&#36733;&#20837;&#31867;&#30340;&#37096;&#20998;&#23646;&#24615;&#22312;&#26576;&#20123;&#29305;&#23450;&#24773;&#20917;&#19979;&#20250;&#26377;&#29992;&#65292;&#20363;&#22914;&#22312;&#21407;&#26377;&#34920;&#20013;&#25317;&#26377;&#20960;&#30334;&#21015;&#25968;&#25454;&#12289;&#25968;&#25454;&#27169;&#22411;&#26080;&#27861;&#25913;&#21160;&#30340;&#24773;&#20917;&#19979;&#12290; 
</P>
<P>&#21487;&#20197;&#22312;&#26144;&#23556;&#25991;&#20214;&#20013;&#23545;&#29305;&#23450;&#30340;&#23646;&#24615;&#35774;&#32622;<TT class=literal>lazy</TT>&#65292;&#23450;&#20041;&#35813;&#23646;&#24615;&#20026;&#24310;&#36831;&#36733;&#20837;&#12290; </P><PRE class=programlisting>&lt;class name="Document"&gt;
       &lt;id name="id"&gt;
        &lt;generator class="native"/&gt;
    &lt;/id&gt;
    &lt;property name="name" not-null="true" length="50"/&gt;
    &lt;property name="summary" not-null="true" length="200" lazy="true"/&gt;
    &lt;property name="text" not-null="true" length="2000" lazy="true"/&gt;
&lt;/class&gt;</PRE>
<P>&#23646;&#24615;&#30340;&#24310;&#36831;&#36733;&#20837;&#35201;&#27714;&#22312;&#20854;&#20195;&#30721;&#26500;&#24314;&#26102;&#21152;&#20837;&#20108;&#36827;&#21046;&#25351;&#31034;&#25351;&#20196;&#65288;bytecode instrumentation&#65289;&#65292;&#22914;&#26524;&#20320;&#30340;&#25345;&#20037;&#31867;&#20195;&#30721;&#20013;&#26410;&#21547;&#26377;&#36825;&#20123;&#25351;&#20196;&#65292; 
Hibernate&#23558;&#20250;&#24573;&#30053;&#36825;&#20123;&#23646;&#24615;&#30340;&#24310;&#36831;&#35774;&#32622;&#65292;&#20173;&#28982;&#23558;&#20854;&#30452;&#25509;&#36733;&#20837;&#12290; </P>
<P>&#20320;&#21487;&#20197;&#22312;Ant&#30340;Task&#20013;&#65292;&#36827;&#34892;&#22914;&#19979;&#23450;&#20041;&#65292;&#23545;&#25345;&#20037;&#31867;&#20195;&#30721;&#21152;&#20837;“&#20108;&#36827;&#21046;&#25351;&#20196;&#12290;” </P><PRE class=programlisting>&lt;target name="instrument" depends="compile"&gt;
    &lt;taskdef name="instrument" classname="org.hibernate.tool.instrument.InstrumentTask"&gt;
        &lt;classpath path="${jar.path}"/&gt;
        &lt;classpath path="${classes.dir}"/&gt;
        &lt;classpath refid="lib.class.path"/&gt;
    &lt;/taskdef&gt;

    &lt;instrument verbose="true"&gt;
        &lt;fileset dir="${testclasses.dir}/org/hibernate/auction/model"&gt;
            &lt;include name="*.class"/&gt;
        &lt;/fileset&gt;
    &lt;/instrument&gt;
&lt;/target&gt;</PRE>
<P>&#36824;&#26377;&#19968;&#31181;&#21487;&#20197;&#20248;&#21270;&#30340;&#26041;&#27861;&#65292;&#23427;&#20351;&#29992;HQL&#25110;&#26465;&#20214;&#26597;&#35810;&#30340;&#25237;&#24433;&#65288;projection&#65289;&#29305;&#24615;&#65292;&#21487;&#20197;&#36991;&#20813;&#35835;&#21462;&#38750;&#24517;&#35201;&#30340;&#21015;&#65292; 
&#36825;&#19968;&#28857;&#33267;&#23569;&#23545;&#21482;&#35835;&#20107;&#21153;&#26159;&#38750;&#24120;&#26377;&#29992;&#30340;&#12290;&#23427;&#26080;&#38656;&#22312;&#20195;&#30721;&#26500;&#24314;&#26102;“&#20108;&#36827;&#21046;&#25351;&#20196;”&#22788;&#29702;&#65292;&#22240;&#27492;&#26159;&#19968;&#20010;&#26356;&#21152;&#20540;&#24471;&#36873;&#25321;&#30340;&#35299;&#20915;&#26041;&#27861;&#12290; </P>
<P>&#26377;&#26102;&#20320;&#38656;&#35201;&#22312;HQL&#20013;&#36890;&#36807;<TT class=literal>&#25235;&#21462;&#25152;&#26377;&#23646;&#24615;</TT>&#65292;&#24378;&#34892;&#25235;&#21462;&#25152;&#26377;&#20869;&#23481;&#12290; </P></DIV></DIV>
<DIV lang=zh-cn class=sect1>
<DIV class=titlepage>
<DIV>
<DIV>
<H2 class=title style="CLEAR: both"><A 
name=performance-cache></A>19.2.&nbsp;&#20108;&#32423;&#32531;&#23384;&#65288;The Second Level Cache&#65289; 
</H2></DIV></DIV>
<DIV></DIV></DIV>
<P>Hibernate&#30340;<TT class=literal>Session</TT>&#22312;&#20107;&#21153;&#32423;&#21035;&#36827;&#34892;&#25345;&#20037;&#21270;&#25968;&#25454;&#30340;&#32531;&#23384;&#25805;&#20316;&#12290; 
&#24403;&#28982;&#65292;&#20063;&#26377;&#21487;&#33021;&#20998;&#21035;&#20026;&#27599;&#20010;&#31867;&#65288;&#25110;&#38598;&#21512;)&#65292;&#37197;&#32622;&#38598;&#32676;&#12289;&#25110;JVM&#32423;&#21035;(<TT class=literal>SessionFactory&#32423;&#21035;</TT>)&#30340;&#32531;&#23384;&#12290; 
&#20320;&#29978;&#33267;&#21487;&#20197;&#20026;&#20043;&#25554;&#20837;&#19968;&#20010;&#38598;&#32676;&#30340;&#32531;&#23384;&#12290;&#27880;&#24847;&#65292;&#32531;&#23384;&#27704;&#36828;&#19981;&#30693;&#36947;&#20854;&#20182;&#24212;&#29992;&#31243;&#24207;&#23545;&#25345;&#20037;&#21270;&#20179;&#24211;&#65288;&#25968;&#25454;&#24211;&#65289;&#21487;&#33021;&#36827;&#34892;&#30340;&#20462;&#25913; &#65288;&#21363;&#20351;&#21487;&#20197;&#23558;&#32531;&#23384;&#25968;&#25454;&#35774;&#23450;&#20026;&#23450;&#26399;&#22833;&#25928;&#65289;&#12290; </P>
<P>&#40664;&#35748;&#24773;&#20917;&#19979;&#65292;Hibernate&#20351;&#29992;EHCache&#36827;&#34892;JVM&#32423;&#21035;&#30340;&#32531;&#23384;&#65288;&#30446;&#21069;&#65292;Hibernate&#24050;&#32463;&#24223;&#24323;&#20102;&#23545;JCS&#30340;&#25903;&#25345;&#65292;&#26410;&#26469;&#29256;&#26412;&#20013;&#23558;&#20250;&#21435;&#25481;&#23427;&#65289;&#12290; 
&#20320;&#21487;&#20197;&#36890;&#36807;&#35774;&#32622;<TT class=literal>hibernate.cache.provider_class</TT>&#23646;&#24615;&#65292;&#25351;&#23450;&#20854;&#20182;&#30340;&#32531;&#23384;&#31574;&#30053;&#65292; 
&#35813;&#32531;&#23384;&#31574;&#30053;&#24517;&#39035;&#23454;&#29616;<TT class=literal>org.hibernate.cache.CacheProvider</TT>&#25509;&#21475;&#12290; </P>
<DIV class=table><A name=cacheproviders></A>
<P class=title><B>&#34920;&nbsp;19.1.&nbsp; &#32531;&#23384;&#31574;&#30053;&#25552;&#20379;&#21830;&#65288;Cache Providers&#65289; </B></P>
<TABLE summary="&#10;&#9;&#9;&#9;&#9;&#32531;&#23384;&#31574;&#30053;&#25552;&#20379;&#21830;&#65288;Cache Providers&#65289;&#10;&#9;&#9;&#9;" 
border=1>
  <COLGROUP>
  <COL align=left>
  <COL align=left>
  <COL align=left>
  <COL align=left>
  <COL align=left></COLGROUP>
  <THEAD>
  <TR>
    <TH align=left>Cache</TH>
    <TH align=left>Provider class</TH>
    <TH align=left>Type</TH>
    <TH align=left>Cluster Safe</TH>
    <TH align=left>Query Cache Supported</TH></TR></THEAD>
  <TBODY>
  <TR>
    <TD align=left>Hashtable (not intended for production use)</TD>
    <TD align=left><TT 
      class=literal>org.hibernate.cache.HashtableCacheProvider</TT></TD>
    <TD align=left>memory</TD>
    <TD align=left>&nbsp;</TD>
    <TD align=left>yes</TD></TR>
  <TR>
    <TD align=left>EHCache</TD>
    <TD align=left><TT 
    class=literal>org.hibernate.cache.EhCacheProvider</TT></TD>
    <TD align=left>memory, disk</TD>
    <TD align=left>&nbsp;</TD>
    <TD align=left>yes</TD></TR>
  <TR>
    <TD align=left>OSCache</TD>
    <TD align=left><TT 
    class=literal>org.hibernate.cache.OSCacheProvider</TT></TD>
    <TD align=left>memory, disk</TD>
    <TD align=left>&nbsp;</TD>
    <TD align=left>yes</TD></TR>
  <TR>
    <TD align=left>SwarmCache</TD>
    <TD align=left><TT 
      class=literal>org.hibernate.cache.SwarmCacheProvider</TT></TD>
    <TD align=left>clustered (ip multicast)</TD>
    <TD align=left>yes (clustered invalidation)</TD>
    <TD align=left>&nbsp;</TD></TR>
  <TR>
    <TD align=left>JBoss TreeCache</TD>
    <TD align=left><TT 
    class=literal>org.hibernate.cache.TreeCacheProvider</TT></TD>
    <TD align=left>clustered (ip multicast), transactional</TD>
    <TD align=left>yes (replication)</TD>
    <TD align=left>yes (clock sync req.)</TD></TR></TBODY></TABLE></DIV>
<DIV lang=zh-cn class=sect2>
<DIV class=titlepage>
<DIV>
<DIV>
<H3 class=title><A name=performance-cache-mapping></A>19.2.1.&nbsp;&#32531;&#23384;&#26144;&#23556;&#65288;Cache 
mappings&#65289; </H3></DIV></DIV>
<DIV></DIV></DIV>
<P>&#31867;&#25110;&#32773;&#38598;&#21512;&#26144;&#23556;&#30340;“<TT class=literal>&lt;cache&gt;</TT>&#20803;&#32032;”&#21487;&#20197;&#26377;&#19979;&#21015;&#24418;&#24335;&#65306; </P>
<DIV class=programlistingco><PRE class=programlisting>&lt;cache 
    usage="transactional|read-write|nonstrict-read-write|read-only"  <SPAN class=co>(1)</SPAN>
    region="RegionName"                                              <SPAN class=co>(2)</SPAN>
    include="all|non-lazy"                                           <SPAN class=co>(3)</SPAN>
/&gt;</PRE>
<DIV class=calloutlist>
<TABLE summary="Callout list" border=0>
  <TBODY>
  <TR>
    <TD vAlign=top width="5%" align=left>(1)</TD>
    <TD vAlign=top align=left>
      <P><TT class=literal>usage</TT>(&#24517;&#39035;)&#35828;&#26126;&#20102;&#32531;&#23384;&#30340;&#31574;&#30053;: <TT 
      class=literal>transactional</TT>&#12289; <TT class=literal>read-write</TT>&#12289; <TT 
      class=literal>nonstrict-read-write</TT>&#25110; <TT class=literal>read-only</TT>&#12290; 
      </P></TD></TR>
  <TR>
    <TD vAlign=top width="5%" align=left>(2)</TD>
    <TD vAlign=top align=left>
      <P><TT class=literal>region</TT> (&#21487;&#36873;, &#40664;&#35748;&#20026;&#31867;&#25110;&#32773;&#38598;&#21512;&#30340;&#21517;&#23383;(class or collection role 
      name)) &#25351;&#23450;&#31532;&#20108;&#32423;&#32531;&#23384;&#30340;&#21306;&#22495;&#21517;(name of the second level cache region) </P></TD></TR>
  <TR>
    <TD vAlign=top width="5%" align=left>(3)</TD>
    <TD vAlign=top align=left>
      <P><TT class=literal>include</TT> (&#21487;&#36873;,&#40664;&#35748;&#20026; <TT class=literal>all</TT>) <TT 
      class=literal>non-lazy</TT> &#24403;&#23646;&#24615;&#32423;&#24310;&#36831;&#25235;&#21462;&#25171;&#24320;&#26102;, &#26631;&#35760;&#20026;<TT 
      class=literal>lazy="true"</TT>&#30340;&#23454;&#20307;&#30340;&#23646;&#24615;&#21487;&#33021;&#26080;&#27861;&#34987;&#32531;&#23384; 
</P></TD></TR></TBODY></TABLE></DIV></DIV>
<P>&#21478;&#22806;(&#39318;&#36873;?), &#20320;&#21487;&#20197;&#22312;hibernate.cfg.xml&#20013;&#25351;&#23450;<TT class=literal>&lt;class-cache&gt;</TT>&#21644; 
<TT class=literal>&lt;collection-cache&gt;</TT> &#20803;&#32032;&#12290; </P>
<P>&#36825;&#37324;&#30340;<TT class=literal>usage</TT> &#23646;&#24615;&#25351;&#26126;&#20102;<SPAN class=emphasis><EM>&#32531;&#23384;&#24182;&#21457;&#31574;&#30053;&#65288;cache 
concurrency strategy&#65289;</EM></SPAN>&#12290; </P></DIV>
<DIV lang=zh-cn class=sect2>
<DIV class=titlepage>
<DIV>
<DIV>
<H3 class=title><A 
name=performance-cache-readonly></A>19.2.2.&nbsp;&#31574;&#30053;&#65306;&#21482;&#35835;&#32531;&#23384;&#65288;Strategy: read only&#65289; 
</H3></DIV></DIV>
<DIV></DIV></DIV>
<P>&#22914;&#26524;&#20320;&#30340;&#24212;&#29992;&#31243;&#24207;&#21482;&#38656;&#35835;&#21462;&#19968;&#20010;&#25345;&#20037;&#21270;&#31867;&#30340;&#23454;&#20363;&#65292;&#32780;&#26080;&#38656;&#23545;&#20854;&#20462;&#25913;&#65292; &#37027;&#20040;&#23601;&#21487;&#20197;&#23545;&#20854;&#36827;&#34892;<TT class=literal>&#21482;&#35835;</TT> 
&#32531;&#23384;&#12290;&#36825;&#26159;&#26368;&#31616;&#21333;&#65292;&#20063;&#26159;&#23454;&#29992;&#24615;&#26368;&#22909;&#30340;&#26041;&#27861;&#12290;&#29978;&#33267;&#22312;&#38598;&#32676;&#20013;&#65292;&#23427;&#20063;&#33021;&#23436;&#32654;&#22320;&#36816;&#20316;&#12290; </P><PRE class=programlisting>&lt;class name="eg.Immutable" mutable="false"&gt;
    &lt;cache usage="read-only"/&gt;
    ....
&lt;/class&gt;</PRE></DIV>
<DIV lang=zh-cn class=sect2>
<DIV class=titlepage>
<DIV>
<DIV>
<H3 class=title><A name=performance-cache-readwrite></A>19.2.3.&nbsp; 
&#31574;&#30053;:&#35835;/&#20889;&#32531;&#23384;&#65288;Strategy: read/write&#65289; </H3></DIV></DIV>
<DIV></DIV></DIV>
<P>&#22914;&#26524;&#24212;&#29992;&#31243;&#24207;&#38656;&#35201;&#26356;&#26032;&#25968;&#25454;&#65292;&#37027;&#20040;&#20351;&#29992;<TT class=literal>&#35835;/&#20889;&#32531;&#23384;</TT> &#27604;&#36739;&#21512;&#36866;&#12290; 
&#22914;&#26524;&#24212;&#29992;&#31243;&#24207;&#35201;&#27714;“&#24207;&#21015;&#21270;&#20107;&#21153;”&#30340;&#38548;&#31163;&#32423;&#21035;&#65288;serializable transaction isolation level&#65289;&#65292;&#37027;&#20040;&#23601;&#20915;&#19981;&#33021;&#20351;&#29992;&#36825;&#31181;&#32531;&#23384;&#31574;&#30053;&#12290; 
&#22914;&#26524;&#22312;JTA&#29615;&#22659;&#20013;&#20351;&#29992;&#32531;&#23384;&#65292;&#20320;&#24517;&#39035;&#25351;&#23450;<TT 
class=literal>hibernate.transaction.manager_lookup_class</TT>&#23646;&#24615;&#30340;&#20540;&#65292; 
&#36890;&#36807;&#23427;&#65292;Hibernate&#25165;&#33021;&#30693;&#36947;&#35813;&#24212;&#29992;&#31243;&#24207;&#20013;JTA&#30340;<TT class=literal>TransactionManager</TT>&#30340;&#20855;&#20307;&#31574;&#30053;&#12290; 
&#22312;&#20854;&#23427;&#29615;&#22659;&#20013;&#65292;&#20320;&#24517;&#39035;&#20445;&#35777;&#22312;<TT class=literal>Session.close()</TT>&#12289;&#25110;<TT 
class=literal>Session.disconnect()</TT>&#35843;&#29992;&#21069;&#65292; &#25972;&#20010;&#20107;&#21153;&#24050;&#32463;&#32467;&#26463;&#12290; 
&#22914;&#26524;&#20320;&#24819;&#22312;&#38598;&#32676;&#29615;&#22659;&#20013;&#20351;&#29992;&#27492;&#31574;&#30053;&#65292;&#20320;&#24517;&#39035;&#20445;&#35777;&#24213;&#23618;&#30340;&#32531;&#23384;&#23454;&#29616;&#25903;&#25345;&#38145;&#23450;(locking)&#12290;Hibernate&#20869;&#32622;&#30340;&#32531;&#23384;&#31574;&#30053;&#24182;&#19981;&#25903;&#25345;&#38145;&#23450;&#21151;&#33021;&#12290; </P><PRE class=programlisting>&lt;class name="eg.Cat" .... &gt;
    &lt;cache usage="read-write"/&gt;
    ....
    &lt;set name="kittens" ... &gt;
        &lt;cache usage="read-write"/&gt;
        ....
    &lt;/set&gt;
&lt;/class&gt;</PRE></DIV>
<DIV lang=zh-cn class=sect2>
<DIV class=titlepage>
<DIV>
<DIV>
<H3 class=title><A name=performance-cache-nonstrict></A>19.2.4.&nbsp; 
&#31574;&#30053;:&#38750;&#20005;&#26684;&#35835;/&#20889;&#32531;&#23384;&#65288;Strategy: nonstrict read/write&#65289; </H3></DIV></DIV>
<DIV></DIV></DIV>
<P>&#22914;&#26524;&#24212;&#29992;&#31243;&#24207;&#21482;&#20598;&#23572;&#38656;&#35201;&#26356;&#26032;&#25968;&#25454;&#65288;&#20063;&#23601;&#26159;&#35828;&#65292;&#20004;&#20010;&#20107;&#21153;&#21516;&#26102;&#26356;&#26032;&#21516;&#19968;&#35760;&#24405;&#30340;&#24773;&#20917;&#24456;&#19981;&#24120;&#35265;&#65289;&#65292;&#20063;&#19981;&#38656;&#35201;&#21313;&#20998;&#20005;&#26684;&#30340;&#20107;&#21153;&#38548;&#31163;&#65292; &#37027;&#20040;&#27604;&#36739;&#36866;&#21512;&#20351;&#29992;<TT 
class=literal>&#38750;&#20005;&#26684;&#35835;/&#20889;&#32531;&#23384;</TT>&#31574;&#30053;&#12290;&#22914;&#26524;&#22312;JTA&#29615;&#22659;&#20013;&#20351;&#29992;&#35813;&#31574;&#30053;&#65292; &#20320;&#24517;&#39035;&#20026;&#20854;&#25351;&#23450;<TT 
class=literal>hibernate.transaction.manager_lookup_class</TT>&#23646;&#24615;&#30340;&#20540;&#65292; 
&#22312;&#20854;&#23427;&#29615;&#22659;&#20013;&#65292;&#20320;&#24517;&#39035;&#20445;&#35777;&#22312;<TT class=literal>Session.close()</TT>&#12289;&#25110;<TT 
class=literal>Session.disconnect()</TT>&#35843;&#29992;&#21069;&#65292; &#25972;&#20010;&#20107;&#21153;&#24050;&#32463;&#32467;&#26463;&#12290; </P></DIV>
<DIV lang=zh-cn class=sect2>
<DIV class=titlepage>
<DIV>
<DIV>
<H3 class=title><A name=performance-cache-transactional></A>19.2.5.&nbsp; 
&#31574;&#30053;:&#20107;&#21153;&#32531;&#23384;&#65288;transactional&#65289; </H3></DIV></DIV>
<DIV></DIV></DIV>
<P>Hibernate&#30340;<TT class=literal>&#20107;&#21153;&#32531;&#23384;</TT>&#31574;&#30053;&#25552;&#20379;&#20102;&#20840;&#20107;&#21153;&#30340;&#32531;&#23384;&#25903;&#25345;&#65292; &#20363;&#22914;&#23545;JBoss 
TreeCache&#30340;&#25903;&#25345;&#12290;&#36825;&#26679;&#30340;&#32531;&#23384;&#21482;&#33021;&#29992;&#20110;JTA&#29615;&#22659;&#20013;&#65292;&#20320;&#24517;&#39035;&#25351;&#23450; &#20026;&#20854;<TT 
class=literal>hibernate.transaction.manager_lookup_class</TT>&#23646;&#24615;&#12290; </P></DIV>
<P>&#27809;&#26377;&#19968;&#31181;&#32531;&#23384;&#25552;&#20379;&#21830;&#33021;&#22815;&#25903;&#25345;&#19978;&#21015;&#30340;&#25152;&#26377;&#32531;&#23384;&#24182;&#21457;&#31574;&#30053;&#12290;&#19979;&#34920;&#20013;&#21015;&#20986;&#20102;&#21508;&#31181;&#25552;&#20379;&#22120;&#12289;&#21450;&#20854;&#21508;&#33258;&#36866;&#29992;&#30340;&#24182;&#21457;&#31574;&#30053;&#12290; </P>
<DIV class=table><A name=d0e14570></A>
<P class=title><B>&#34920;&nbsp;19.2.&nbsp; &#21508;&#31181;&#32531;&#23384;&#25552;&#20379;&#21830;&#23545;&#32531;&#23384;&#24182;&#21457;&#31574;&#30053;&#30340;&#25903;&#25345;&#24773;&#20917;&#65288;Cache Concurrency 
Strategy Support&#65289; </B></P>
<TABLE 
summary="&#10;&#9;&#9;&#9;&#21508;&#31181;&#32531;&#23384;&#25552;&#20379;&#21830;&#23545;&#32531;&#23384;&#24182;&#21457;&#31574;&#30053;&#30340;&#25903;&#25345;&#24773;&#20917;&#65288;Cache Concurrency Strategy Support&#65289;&#10;&#9;&#9;&#9;" 
border=1>
  <COLGROUP>
  <COL align=left>
  <COL align=left>
  <COL align=left>
  <COL align=left>
  <COL align=left></COLGROUP>
  <THEAD>
  <TR>
    <TH align=left>Cache</TH>
    <TH align=left>read-only</TH>
    <TH align=left>nonstrict-read-write</TH>
    <TH align=left>read-write</TH>
    <TH align=left>transactional</TH></TR></THEAD>
  <TBODY>
  <TR>
    <TD align=left>Hashtable (not intended for production use)</TD>
    <TD align=left>yes</TD>
    <TD align=left>yes</TD>
    <TD align=left>yes</TD>
    <TD align=left>&nbsp;</TD></TR>
  <TR>
    <TD align=left>EHCache</TD>
    <TD align=left>yes</TD>
    <TD align=left>yes</TD>
    <TD align=left>yes</TD>
    <TD align=left>&nbsp;</TD></TR>
  <TR>
    <TD align=left>OSCache</TD>
    <TD align=left>yes</TD>
    <TD align=left>yes</TD>
    <TD align=left>yes</TD>
    <TD align=left>&nbsp;</TD></TR>
  <TR>
    <TD align=left>SwarmCache</TD>
    <TD align=left>yes</TD>
    <TD align=left>yes</TD>
    <TD align=left>&nbsp;</TD>
    <TD align=left>&nbsp;</TD></TR>
  <TR>
    <TD align=left>JBoss TreeCache</TD>
    <TD align=left>yes</TD>
    <TD align=left>&nbsp;</TD>
    <TD align=left>&nbsp;</TD>
    <TD align=left>yes</TD></TR></TBODY></TABLE></DIV></DIV>
<DIV lang=zh-cn class=sect1>
<DIV class=titlepage>
<DIV>
<DIV>
<H2 class=title style="CLEAR: both"><A 
name=performance-sessioncache></A>19.3.&nbsp; &#31649;&#29702;&#32531;&#23384;&#65288;Managing the caches&#65289; 
</H2></DIV></DIV>
<DIV></DIV></DIV>
<P>&#26080;&#35770;&#20309;&#26102;&#65292;&#24403;&#20320;&#32473;<TT class=literal>save()</TT>&#12289;<TT class=literal>update()</TT>&#25110; <TT 
class=literal>saveOrUpdate()</TT>&#26041;&#27861;&#20256;&#36882;&#19968;&#20010;&#23545;&#35937;&#26102;&#65292;&#25110;&#20351;&#29992;<TT class=literal>load()</TT>&#12289; <TT 
class=literal>get()</TT>&#12289;<TT class=literal>list()</TT>&#12289;<TT 
class=literal>iterate()</TT> &#25110;<TT class=literal>scroll()</TT>&#26041;&#27861;&#33719;&#24471;&#19968;&#20010;&#23545;&#35937;&#26102;, 
&#35813;&#23545;&#35937;&#37117;&#23558;&#34987;&#21152;&#20837;&#21040;<TT class=literal>Session</TT>&#30340;&#20869;&#37096;&#32531;&#23384;&#20013;&#12290; </P>
<P>&#24403;&#38543;&#21518;flush()&#26041;&#27861;&#34987;&#35843;&#29992;&#26102;&#65292;&#23545;&#35937;&#30340;&#29366;&#24577;&#20250;&#21644;&#25968;&#25454;&#24211;&#21462;&#24471;&#21516;&#27493;&#12290; &#22914;&#26524;&#20320;&#19981;&#24076;&#26395;&#27492;&#21516;&#27493;&#25805;&#20316;&#21457;&#29983;&#65292;&#25110;&#32773;&#20320;&#27491;&#22788;&#29702;&#22823;&#37327;&#23545;&#35937;&#12289;&#38656;&#35201;&#23545;&#26377;&#25928;&#31649;&#29702;&#20869;&#23384;&#26102;&#65292;&#20320;&#21487;&#20197;&#35843;&#29992;<TT 
class=literal>evict()</TT> &#26041;&#27861;&#65292;&#20174;&#19968;&#32423;&#32531;&#23384;&#20013;&#21435;&#25481;&#36825;&#20123;&#23545;&#35937;&#21450;&#20854;&#38598;&#21512;&#12290; </P><PRE class=programlisting>ScrollableResult cats = sess.createQuery("from Cat as cat").scroll(); //a huge result set
while ( cats.next() ) {
    Cat cat = (Cat) cats.get(0);
    doSomethingWithACat(cat);
    sess.evict(cat);
}</PRE>
<P>Session&#36824;&#25552;&#20379;&#20102;&#19968;&#20010;<TT class=literal>contains()</TT>&#26041;&#27861;&#65292;&#29992;&#26469;&#21028;&#26029;&#26576;&#20010;&#23454;&#20363;&#26159;&#21542;&#22788;&#20110;&#24403;&#21069;session&#30340;&#32531;&#23384;&#20013;&#12290; 
</P>
<P>&#22914;&#33509;&#35201;&#25226;&#25152;&#26377;&#30340;&#23545;&#35937;&#20174;session&#32531;&#23384;&#20013;&#24443;&#24213;&#28165;&#38500;&#65292;&#21017;&#38656;&#35201;&#35843;&#29992;<TT class=literal>Session.clear()</TT>&#12290; </P>
<P>&#23545;&#20110;&#20108;&#32423;&#32531;&#23384;&#26469;&#35828;&#65292;&#22312;<TT class=literal>SessionFactory</TT>&#20013;&#23450;&#20041;&#20102;&#35768;&#22810;&#26041;&#27861;&#65292; 
&#28165;&#38500;&#32531;&#23384;&#20013;&#23454;&#20363;&#12289;&#25972;&#20010;&#31867;&#12289;&#38598;&#21512;&#23454;&#20363;&#25110;&#32773;&#25972;&#20010;&#38598;&#21512;&#12290; </P><PRE class=programlisting>sessionFactory.evict(Cat.class, catId); //evict a particular Cat
sessionFactory.evict(Cat.class);  //evict all Cats
sessionFactory.evictCollection("Cat.kittens", catId); //evict a particular collection of kittens
sessionFactory.evictCollection("Cat.kittens"); //evict all kitten collections</PRE>
<P><TT class=literal>CacheMode</TT>&#21442;&#25968;&#29992;&#20110;&#25511;&#21046;&#20855;&#20307;&#30340;Session&#22914;&#20309;&#19982;&#20108;&#32423;&#32531;&#23384;&#36827;&#34892;&#20132;&#20114;&#12290; </P>
<DIV class=itemizedlist>
<UL type=disc>
  <LI>
  <P><TT class=literal>CacheMode.NORMAL</TT> - &#20174;&#20108;&#32423;&#32531;&#23384;&#20013;&#35835;&#12289;&#20889;&#25968;&#25454;&#12290; </P>
  <LI>
  <P><TT class=literal>CacheMode.GET</TT> - &#20174;&#20108;&#32423;&#32531;&#23384;&#20013;&#35835;&#21462;&#25968;&#25454;&#65292;&#20165;&#22312;&#25968;&#25454;&#26356;&#26032;&#26102;&#23545;&#20108;&#32423;&#32531;&#23384;&#20889;&#25968;&#25454;&#12290; </P>
  <LI>
  <P><TT class=literal>CacheMode.PUT</TT> - &#20165;&#21521;&#20108;&#32423;&#32531;&#23384;&#20889;&#25968;&#25454;&#65292;&#20294;&#19981;&#20174;&#20108;&#32423;&#32531;&#23384;&#20013;&#35835;&#25968;&#25454;&#12290; </P>
  <LI>
  <P><TT class=literal>CacheMode.REFRESH</TT> - &#20165;&#21521;&#20108;&#32423;&#32531;&#23384;&#20889;&#25968;&#25454;&#65292;&#20294;&#19981;&#20174;&#20108;&#32423;&#32531;&#23384;&#20013;&#35835;&#25968;&#25454;&#12290;&#36890;&#36807; <TT 
  class=literal>hibernate.cache.use_minimal_puts</TT>&#30340;&#35774;&#32622;&#65292;&#24378;&#21046;&#20108;&#32423;&#32531;&#23384;&#20174;&#25968;&#25454;&#24211;&#20013;&#35835;&#21462;&#25968;&#25454;&#65292;&#21047;&#26032;&#32531;&#23384;&#20869;&#23481;&#12290; 
  </P></LI></UL></DIV>
<P>&#22914;&#33509;&#38656;&#35201;&#26597;&#30475;&#20108;&#32423;&#32531;&#23384;&#25110;&#26597;&#35810;&#32531;&#23384;&#21306;&#22495;&#30340;&#20869;&#23481;&#65292;&#20320;&#21487;&#20197;&#20351;&#29992;<TT class=literal>&#32479;&#35745;&#65288;Statistics&#65289;</TT> API&#12290; </P><PRE class=programlisting>Map cacheEntries = sessionFactory.getStatistics()
        .getSecondLevelCacheStatistics(regionName)
        .getEntries();</PRE>
<P>&#27492;&#26102;&#65292;&#20320;&#24517;&#39035;&#25163;&#24037;&#25171;&#24320;&#32479;&#35745;&#36873;&#39033;&#12290;&#21487;&#36873;&#30340;&#65292;&#20320;&#21487;&#20197;&#35753;Hibernate&#26356;&#20154;&#24037;&#21487;&#35835;&#30340;&#26041;&#24335;&#32500;&#25252;&#32531;&#23384;&#20869;&#23481;&#12290; </P><PRE class=programlisting>hibernate.generate_statistics true
hibernate.cache.use_structured_entries true</PRE></DIV>
<DIV lang=zh-cn class=sect1>
<DIV class=titlepage>
<DIV>
<DIV>
<H2 class=title style="CLEAR: both"><A 
name=performance-querycache></A>19.4.&nbsp;&#26597;&#35810;&#32531;&#23384;&#65288;The Query Cache&#65289; 
</H2></DIV></DIV>
<DIV></DIV></DIV>
<P>&#26597;&#35810;&#30340;&#32467;&#26524;&#38598;&#20063;&#21487;&#20197;&#34987;&#32531;&#23384;&#12290;&#21482;&#26377;&#24403;&#32463;&#24120;&#20351;&#29992;&#21516;&#26679;&#30340;&#21442;&#25968;&#36827;&#34892;&#26597;&#35810;&#26102;&#65292;&#36825;&#25165;&#20250;&#26377;&#20123;&#29992;&#22788;&#12290; &#35201;&#20351;&#29992;&#26597;&#35810;&#32531;&#23384;&#65292;&#39318;&#20808;&#20320;&#24517;&#39035;&#25171;&#24320;&#23427;&#65306; </P><PRE class=programlisting>hibernate.cache.use_query_cache true</PRE>
<P>&#35813;&#35774;&#32622;&#23558;&#20250;&#21019;&#24314;&#20004;&#20010;&#32531;&#23384;&#21306;&#22495; - &#19968;&#20010;&#29992;&#20110;&#20445;&#23384;&#26597;&#35810;&#32467;&#26524;&#38598;(<TT 
class=literal>org.hibernate.cache.StandardQueryCache</TT>)&#65307; 
&#21478;&#19968;&#20010;&#21017;&#29992;&#20110;&#20445;&#23384;&#26368;&#36817;&#26597;&#35810;&#30340;&#19968;&#31995;&#21015;&#34920;&#30340;&#26102;&#38388;&#25139;(<TT 
class=literal>org.hibernate.cache.UpdateTimestampsCache</TT>)&#12290; 
&#35831;&#27880;&#24847;&#65306;&#22312;&#26597;&#35810;&#32531;&#23384;&#20013;&#65292;&#23427;&#24182;&#19981;&#32531;&#23384;&#32467;&#26524;&#38598;&#20013;&#25152;&#21253;&#21547;&#30340;&#23454;&#20307;&#30340;&#30830;&#20999;&#29366;&#24577;&#65307;&#23427;&#21482;&#32531;&#23384;&#36825;&#20123;&#23454;&#20307;&#30340;&#26631;&#35782;&#31526;&#23646;&#24615;&#30340;&#20540;&#12289;&#20197;&#21450;&#21508;&#20540;&#31867;&#22411;&#30340;&#32467;&#26524;&#12290; &#25152;&#20197;&#26597;&#35810;&#32531;&#23384;&#36890;&#24120;&#20250;&#21644;&#20108;&#32423;&#32531;&#23384;&#19968;&#36215;&#20351;&#29992;&#12290; 
</P>
<P>&#32477;&#22823;&#22810;&#25968;&#30340;&#26597;&#35810;&#24182;&#19981;&#33021;&#20174;&#26597;&#35810;&#32531;&#23384;&#20013;&#21463;&#30410;&#65292;&#25152;&#20197;Hibernate&#40664;&#35748;&#26159;&#19981;&#36827;&#34892;&#26597;&#35810;&#32531;&#23384;&#30340;&#12290;&#22914;&#33509;&#38656;&#35201;&#36827;&#34892;&#32531;&#23384;&#65292;&#35831;&#35843;&#29992; <TT 
class=literal>Query.setCacheable(true)</TT>&#26041;&#27861;&#12290;&#36825;&#20010;&#35843;&#29992;&#20250;&#35753;&#26597;&#35810;&#22312;&#25191;&#34892;&#36807;&#31243;&#20013;&#26102;&#20808;&#20174;&#32531;&#23384;&#20013;&#26597;&#25214;&#32467;&#26524;&#65292; 
&#24182;&#23558;&#33258;&#24049;&#30340;&#32467;&#26524;&#38598;&#25918;&#21040;&#32531;&#23384;&#20013;&#21435;&#12290; </P>
<P>&#22914;&#26524;&#20320;&#35201;&#23545;&#26597;&#35810;&#32531;&#23384;&#30340;&#22833;&#25928;&#25919;&#31574;&#36827;&#34892;&#31934;&#30830;&#30340;&#25511;&#21046;&#65292;&#20320;&#24517;&#39035;&#35843;&#29992;<TT class=literal>Query.setCacheRegion()</TT>&#26041;&#27861;&#65292; 
&#20026;&#27599;&#20010;&#26597;&#35810;&#25351;&#23450;&#20854;&#21629;&#21517;&#30340;&#32531;&#23384;&#21306;&#22495;&#12290; </P><PRE class=programlisting>List blogs = sess.createQuery("from Blog blog where blog.blogger = :blogger")
    .setEntity("blogger", blogger)
    .setMaxResults(15)
    .setCacheable(true)
    .setCacheRegion("frontpages")
    .list();</PRE>
<P>&#22914;&#26524;&#26597;&#35810;&#38656;&#35201;&#24378;&#34892;&#21047;&#26032;&#20854;&#26597;&#35810;&#32531;&#23384;&#21306;&#22495;&#65292;&#37027;&#20040;&#20320;&#24212;&#35813;&#35843;&#29992;<TT 
class=literal>Query.setCacheMode(CacheMode.REFRESH)</TT>&#26041;&#27861;&#12290; 
&#36825;&#23545;&#22312;&#20854;&#20182;&#36827;&#31243;&#20013;&#20462;&#25913;&#24213;&#23618;&#25968;&#25454;&#65288;&#20363;&#22914;&#65292;&#19981;&#36890;&#36807;Hibernate&#20462;&#25913;&#25968;&#25454;&#65289;&#65292;&#25110;&#23545;&#37027;&#20123;&#38656;&#35201;&#36873;&#25321;&#24615;&#26356;&#26032;&#29305;&#23450;&#26597;&#35810;&#32467;&#26524;&#38598;&#30340;&#24773;&#20917;&#29305;&#21035;&#26377;&#29992;&#12290; &#36825;&#26159;&#23545;<TT 
class=literal>SessionFactory.evictQueries()</TT>&#30340;&#26356;&#20026;&#26377;&#25928;&#30340;&#26367;&#20195;&#26041;&#26696;&#65292;&#21516;&#26679;&#21487;&#20197;&#28165;&#38500;&#26597;&#35810;&#32531;&#23384;&#21306;&#22495;&#12290; 
</P></DIV>
<DIV lang=zh-cn class=sect1>
<DIV class=titlepage>
<DIV>
<DIV>
<H2 class=title style="CLEAR: both"><A 
name=performance-collections></A>19.5.&nbsp; &#29702;&#35299;&#38598;&#21512;&#24615;&#33021;&#65288;Understanding Collection 
performance&#65289; </H2></DIV></DIV>
<DIV></DIV></DIV>
<P>&#21069;&#38754;&#25105;&#20204;&#24050;&#32463;&#23545;&#38598;&#21512;&#36827;&#34892;&#20102;&#36275;&#22815;&#30340;&#35752;&#35770;&#12290;&#26412;&#27573;&#20013;&#65292;&#25105;&#20204;&#23558;&#30528;&#37325;&#35762;&#36848;&#38598;&#21512;&#22312;&#36816;&#34892;&#26102;&#30340;&#20107;&#23452;&#12290; </P>
<DIV lang=zh-cn class=sect2>
<DIV class=titlepage>
<DIV>
<DIV>
<H3 class=title><A name=performance-collections-taxonomy></A>19.5.1.&nbsp; 
&#20998;&#31867;&#65288;Taxonomy&#65289; </H3></DIV></DIV>
<DIV></DIV></DIV>
<P>Hibernate&#23450;&#20041;&#20102;&#19977;&#31181;&#22522;&#26412;&#31867;&#22411;&#30340;&#38598;&#21512;&#65306; </P>
<DIV class=itemizedlist>
<UL type=disc>
  <LI>
  <P>&#20540;&#25968;&#25454;&#38598;&#21512; </P>
  <LI>
  <P>&#19968;&#23545;&#22810;&#20851;&#32852; </P>
  <LI>
  <P>&#22810;&#23545;&#22810;&#20851;&#32852; </P></LI></UL></DIV>
<P>&#36825;&#20010;&#20998;&#31867;&#26159;&#21306;&#20998;&#20102;&#19981;&#21516;&#30340;&#34920;&#21644;&#22806;&#38190;&#20851;&#31995;&#31867;&#22411;&#65292;&#20294;&#26159;&#23427;&#27809;&#26377;&#21578;&#35785;&#25105;&#20204;&#20851;&#31995;&#27169;&#22411;&#30340;&#25152;&#26377;&#20869;&#23481;&#12290; 
&#35201;&#23436;&#20840;&#29702;&#35299;&#20182;&#20204;&#30340;&#20851;&#31995;&#32467;&#26500;&#21644;&#24615;&#33021;&#29305;&#28857;&#65292;&#25105;&#20204;&#24517;&#39035;&#21516;&#26102;&#32771;&#34385;“&#29992;&#20110;Hibernate&#26356;&#26032;&#25110;&#21024;&#38500;&#38598;&#21512;&#34892;&#25968;&#25454;&#30340;&#20027;&#38190;&#30340;&#32467;&#26500;”&#12290; &#22240;&#27492;&#24471;&#21040;&#20102;&#22914;&#19979;&#30340;&#20998;&#31867;&#65306; </P>
<DIV class=itemizedlist>
<UL type=disc>
  <LI>
  <P>&#26377;&#24207;&#38598;&#21512;&#31867; </P>
  <LI>
  <P>&#38598;&#21512;&#65288;sets&#65289; </P>
  <LI>
  <P>&#21253;&#65288;bags) </P></LI></UL></DIV>
<P>&#25152;&#26377;&#30340;&#26377;&#24207;&#38598;&#21512;&#31867;&#65288;maps, lists, arrays)&#37117;&#25317;&#26377;&#19968;&#20010;&#30001;<TT class=literal>&lt;key&gt;</TT>&#21644; <TT 
class=literal>&lt;index&gt;</TT>&#32452;&#25104;&#30340;&#20027;&#38190;&#12290; 
&#36825;&#31181;&#24773;&#20917;&#19979;&#38598;&#21512;&#31867;&#30340;&#26356;&#26032;&#26159;&#38750;&#24120;&#39640;&#25928;&#30340;——&#20027;&#38190;&#24050;&#32463;&#34987;&#26377;&#25928;&#30340;&#32034;&#24341;&#65292;&#22240;&#27492;&#24403;Hibernate&#35797;&#22270;&#26356;&#26032;&#25110;&#21024;&#38500;&#19968;&#34892;&#26102;&#65292;&#21487;&#20197;&#36805;&#36895;&#25214;&#21040;&#35813;&#34892;&#25968;&#25454;&#12290; </P>
<P>&#38598;&#21512;(sets)&#30340;&#20027;&#38190;&#30001;<TT class=literal>&lt;key&gt;</TT>&#21644;&#20854;&#20182;&#20803;&#32032;&#23383;&#27573;&#26500;&#25104;&#12290; 
&#23545;&#20110;&#26377;&#20123;&#20803;&#32032;&#31867;&#22411;&#26469;&#35828;&#65292;&#36825;&#24456;&#20302;&#25928;&#65292;&#29305;&#21035;&#26159;&#32452;&#21512;&#20803;&#32032;&#25110;&#32773;&#22823;&#25991;&#26412;&#12289;&#22823;&#20108;&#36827;&#21046;&#23383;&#27573;&#65307; &#25968;&#25454;&#24211;&#21487;&#33021;&#26080;&#27861;&#26377;&#25928;&#30340;&#23545;&#22797;&#26434;&#30340;&#20027;&#38190;&#36827;&#34892;&#32034;&#24341;&#12290; 
&#21478;&#19968;&#26041;&#38754;&#65292;&#23545;&#20110;&#19968;&#23545;&#22810;&#12289;&#22810;&#23545;&#22810;&#20851;&#32852;&#65292;&#29305;&#21035;&#26159;&#21512;&#25104;&#30340;&#26631;&#35782;&#31526;&#26469;&#35828;&#65292;&#38598;&#21512;&#20063;&#21487;&#20197;&#36798;&#21040;&#21516;&#26679;&#30340;&#39640;&#25928;&#24615;&#33021;&#12290;&#65288; &#38468;&#27880;&#65306;&#22914;&#26524;&#20320;&#24076;&#26395;<TT 
class=literal>SchemaExport</TT>&#20026;&#20320;&#30340;<TT class=literal>&lt;set&gt;</TT>&#21019;&#24314;&#20027;&#38190;&#65292; 
&#20320;&#24517;&#39035;&#25226;&#25152;&#26377;&#30340;&#23383;&#27573;&#37117;&#22768;&#26126;&#20026;<TT class=literal>not-null="true"</TT>&#12290;&#65289; </P>
<P><TT class=literal>&lt;idbag&gt;</TT>&#26144;&#23556;&#23450;&#20041;&#20102;&#20195;&#29702;&#38190;&#65292;&#22240;&#27492;&#23427;&#24635;&#26159;&#21487;&#20197;&#24456;&#39640;&#25928;&#30340;&#34987;&#26356;&#26032;&#12290;&#20107;&#23454;&#19978;&#65292; <TT 
class=literal>&lt;idbag&gt;</TT>&#25317;&#26377;&#30528;&#26368;&#22909;&#30340;&#24615;&#33021;&#34920;&#29616;&#12290; </P>
<P>Bag&#26159;&#26368;&#24046;&#30340;&#12290;&#22240;&#20026;bag&#20801;&#35768;&#37325;&#22797;&#30340;&#20803;&#32032;&#20540;&#65292;&#20063;&#27809;&#26377;&#32034;&#24341;&#23383;&#27573;&#65292;&#22240;&#27492;&#19981;&#21487;&#33021;&#23450;&#20041;&#20027;&#38190;&#12290; 
Hibernate&#26080;&#27861;&#21028;&#26029;&#20986;&#37325;&#22797;&#30340;&#34892;&#12290;&#24403;&#36825;&#31181;&#38598;&#21512;&#34987;&#26356;&#25913;&#26102;&#65292;Hibernate&#23558;&#20250;&#20808;&#23436;&#25972;&#22320;&#31227;&#38500; &#65288;&#36890;&#36807;&#19968;&#20010;(in a single <TT 
class=literal>DELETE</TT>)&#65289;&#25972;&#20010;&#38598;&#21512;&#65292;&#28982;&#21518;&#20877;&#37325;&#26032;&#21019;&#24314;&#25972;&#20010;&#38598;&#21512;&#12290; &#22240;&#27492;Bag&#26159;&#38750;&#24120;&#20302;&#25928;&#30340;&#12290; </P>
<P>&#35831;&#27880;&#24847;&#65306;&#23545;&#20110;&#19968;&#23545;&#22810;&#20851;&#32852;&#26469;&#35828;&#65292;“&#20027;&#38190;”&#24456;&#21487;&#33021;&#24182;&#19981;&#26159;&#25968;&#25454;&#24211;&#34920;&#30340;&#29289;&#29702;&#20027;&#38190;&#12290; 
&#20294;&#23601;&#31639;&#22312;&#27492;&#24773;&#20917;&#19979;&#65292;&#19978;&#38754;&#30340;&#20998;&#31867;&#20173;&#28982;&#26159;&#26377;&#29992;&#30340;&#12290;&#65288;&#23427;&#20173;&#28982;&#21453;&#26144;&#20102;Hibernate&#22312;&#38598;&#21512;&#30340;&#21508;&#25968;&#25454;&#34892;&#20013;&#26159;&#22914;&#20309;&#36827;&#34892;“&#23450;&#20301;”&#30340;&#12290;&#65289; </P></DIV>
<DIV lang=zh-cn class=sect2>
<DIV class=titlepage>
<DIV>
<DIV>
<H3 class=title><A 
name=performance-collections-mostefficientupdate></A>19.5.2.&nbsp; Lists, maps 
&#21644;sets&#29992;&#20110;&#26356;&#26032;&#25928;&#29575;&#26368;&#39640; </H3></DIV></DIV>
<DIV></DIV></DIV>
<P>&#26681;&#25454;&#25105;&#20204;&#19978;&#38754;&#30340;&#35752;&#35770;&#65292;&#26174;&#28982;&#26377;&#24207;&#38598;&#21512;&#31867;&#22411;&#21644;&#22823;&#22810;&#25968;set&#37117;&#21487;&#20197;&#22312;&#22686;&#21152;&#12289;&#21024;&#38500;&#12289;&#20462;&#25913;&#20803;&#32032;&#20013;&#25317;&#26377;&#26368;&#22909;&#30340;&#24615;&#33021;&#12290; </P>
<P>&#21487;&#35770;&#35777;&#30340;&#26159;&#23545;&#20110;&#22810;&#23545;&#22810;&#20851;&#32852;&#12289;&#20540;&#25968;&#25454;&#38598;&#21512;&#32780;&#35328;&#65292;&#26377;&#24207;&#38598;&#21512;&#31867;&#27604;&#38598;&#21512;(set)&#26377;&#19968;&#20010;&#22909;&#22788;&#12290;&#22240;&#20026;<TT class=literal>Set</TT>&#30340;&#20869;&#22312;&#32467;&#26500;&#65292; 
&#22914;&#26524;“&#25913;&#21464;”&#20102;&#19968;&#20010;&#20803;&#32032;&#65292;Hibernate&#24182;&#19981;&#20250;<TT class=literal>&#26356;&#26032;&#65288;UPDATE&#65289;</TT>&#36825;&#19968;&#34892;&#12290; &#23545;&#20110;<TT 
class=literal>Set</TT>&#26469;&#35828;&#65292;&#21482;&#26377;&#22312;<TT class=literal>&#25554;&#20837;&#65288;INSERT&#65289;</TT>&#21644;<TT 
class=literal>&#21024;&#38500;&#65288;DELETE&#65289;</TT> &#25805;&#20316;&#26102;“&#25913;&#21464;”&#25165;&#26377;&#25928;&#12290;&#20877;&#27425;&#24378;&#35843;&#65306;&#36825;&#27573;&#35752;&#35770;&#23545;“&#19968;&#23545;&#22810;&#20851;&#32852;”&#24182;&#19981;&#36866;&#29992;&#12290; </P>
<P>&#27880;&#24847;&#21040;&#25968;&#32452;&#26080;&#27861;&#24310;&#36831;&#36733;&#20837;&#65292;&#25105;&#20204;&#21487;&#20197;&#24471;&#20986;&#32467;&#35770;&#65292;list, map&#21644;idbags&#26159;&#26368;&#39640;&#25928;&#30340;&#65288;&#38750;&#21453;&#21521;&#65289;&#38598;&#21512;&#31867;&#22411;&#65292;set&#21017;&#32039;&#38543;&#20854;&#21518;&#12290; 
&#22312;Hibernate&#20013;&#65292;set&#24212;&#35813;&#26102;&#26368;&#36890;&#29992;&#30340;&#38598;&#21512;&#31867;&#22411;&#65292;&#36825;&#26102;&#22240;&#20026;“set”&#30340;&#35821;&#20041;&#22312;&#20851;&#31995;&#27169;&#22411;&#20013;&#26159;&#26368;&#33258;&#28982;&#30340;&#12290; </P>
<P>&#20294;&#26159;&#65292;&#22312;&#35774;&#35745;&#33391;&#22909;&#30340;Hibernate&#39046;&#22495;&#27169;&#22411;&#20013;&#65292;&#25105;&#20204;&#36890;&#24120;&#21487;&#20197;&#30475;&#21040;&#26356;&#22810;&#30340;&#38598;&#21512;&#20107;&#23454;&#19978;&#26159;&#24102;&#26377;<TT 
class=literal>inverse="true"</TT> 
&#30340;&#19968;&#23545;&#22810;&#30340;&#20851;&#32852;&#12290;&#23545;&#20110;&#36825;&#20123;&#20851;&#32852;&#65292;&#26356;&#26032;&#25805;&#20316;&#23558;&#20250;&#22312;&#22810;&#23545;&#19968;&#30340;&#36825;&#19968;&#31471;&#36827;&#34892;&#22788;&#29702;&#12290;&#22240;&#27492;&#23545;&#20110;&#27492;&#31867;&#24773;&#20917;&#65292;&#26080;&#38656;&#32771;&#34385;&#20854;&#38598;&#21512;&#30340;&#26356;&#26032;&#24615;&#33021;&#12290; </P></DIV>
<DIV lang=zh-cn class=sect2>
<DIV class=titlepage>
<DIV>
<DIV>
<H3 class=title><A 
name=performance-collections-mostefficentinverse></A>19.5.3.&nbsp; 
Bag&#21644;list&#26159;&#21453;&#21521;&#38598;&#21512;&#31867;&#20013;&#25928;&#29575;&#26368;&#39640;&#30340; </H3></DIV></DIV>
<DIV></DIV></DIV>
<P>&#22312;&#25226;bag&#25172;&#36827;&#27700;&#27807;&#20043;&#21069;&#65292;&#20320;&#24517;&#39035;&#20102;&#35299;&#65292;&#22312;&#19968;&#31181;&#24773;&#20917;&#19979;&#65292;bag&#30340;&#24615;&#33021;(&#21253;&#25324;list)&#35201;&#27604;set&#39640;&#24471;&#22810;&#65306; &#23545;&#20110;&#25351;&#26126;&#20102;<TT 
class=literal>inverse="true"</TT>&#30340;&#38598;&#21512;&#31867;&#65288;&#27604;&#22914;&#35828;&#65292;&#26631;&#20934;&#30340;&#21452;&#21521;&#30340;&#19968;&#23545;&#22810;&#20851;&#32852;&#65289;&#65292; 
&#25105;&#20204;&#21487;&#20197;&#22312;&#26410;&#21021;&#22987;&#21270;(fetch)&#21253;&#20803;&#32032;&#30340;&#24773;&#20917;&#19979;&#30452;&#25509;&#21521;bag&#25110;list&#28155;&#21152;&#26032;&#20803;&#32032;&#65281; &#36825;&#26159;&#22240;&#20026;<TT 
class=literal>Collection.add()</TT>)&#25110;&#32773;<TT class=literal>Collection.addAll()</TT> 
&#26041;&#27861; &#23545;bag&#25110;&#32773;List&#24635;&#26159;&#36820;&#22238;true&#65288;&#36825;&#28857;&#19982;&#19982;Set&#19981;&#21516;&#65289;&#12290;&#22240;&#27492;&#23545;&#20110;&#19979;&#38754;&#30340;&#30456;&#21516;&#20195;&#30721;&#26469;&#35828;&#65292;&#36895;&#24230;&#20250;&#24555;&#24471;&#22810;&#12290; </P><PRE class=programlisting>Parent p = (Parent) sess.load(Parent.class, id);
    Child c = new Child();
    c.setParent(p);
    p.getChildren().add(c);  //no need to fetch the collection!
    sess.flush();</PRE></DIV>
<DIV lang=zh-cn class=sect2>
<DIV class=titlepage>
<DIV>
<DIV>
<H3 class=title><A name=performance-collections-oneshotdelete></A>19.5.4.&nbsp; 
&#19968;&#27425;&#24615;&#21024;&#38500;&#65288;One shot delete&#65289; </H3></DIV></DIV>
<DIV></DIV></DIV>
<P>&#20598;&#23572;&#30340;&#65292;&#36880;&#20010;&#21024;&#38500;&#38598;&#21512;&#31867;&#20013;&#30340;&#20803;&#32032;&#26159;&#30456;&#24403;&#20302;&#25928;&#30340;&#12290;Hibernate&#24182;&#27809;&#37027;&#20040;&#31528;&#65292; 
&#22914;&#26524;&#20320;&#24819;&#35201;&#25226;&#25972;&#20010;&#38598;&#21512;&#37117;&#21024;&#38500;&#65288;&#27604;&#22914;&#35828;&#35843;&#29992;list.clear()&#65289;&#65292;Hibernate&#21482;&#38656;&#35201;&#19968;&#20010;DELETE&#23601;&#25630;&#23450;&#20102;&#12290; </P>
<P>&#20551;&#35774;&#25105;&#20204;&#22312;&#19968;&#20010;&#38271;&#24230;&#20026;20&#30340;&#38598;&#21512;&#31867;&#20013;&#26032;&#22686;&#21152;&#20102;&#19968;&#20010;&#20803;&#32032;&#65292;&#28982;&#21518;&#20877;&#21024;&#38500;&#20004;&#20010;&#12290; Hibernate&#20250;&#23433;&#25490;&#19968;&#26465;<TT 
class=literal>INSERT</TT>&#35821;&#21477;&#21644;&#20004;&#26465;<TT class=literal>DELETE</TT>&#35821;&#21477;&#65288;&#38500;&#38750;&#38598;&#21512;&#31867;&#26159;&#19968;&#20010;bag)&#12290; 
&#36825;&#24403;&#28982;&#26159;&#26174;&#32780;&#26131;&#35265;&#30340;&#12290; </P>
<P>&#20294;&#26159;&#65292;&#20551;&#35774;&#25105;&#20204;&#21024;&#38500;&#20102;18&#20010;&#25968;&#25454;&#65292;&#21482;&#21097;&#19979;2&#20010;&#65292;&#28982;&#21518;&#26032;&#22686;3&#20010;&#12290;&#21017;&#26377;&#20004;&#31181;&#22788;&#29702;&#26041;&#24335;&#65306; </P>
<DIV class=itemizedlist>
<UL type=disc>
  <LI>
  <P>&#36880;&#19968;&#30340;&#21024;&#38500;&#36825;18&#20010;&#25968;&#25454;&#65292;&#20877;&#26032;&#22686;&#19977;&#20010;&#65307; </P>
  <LI>
  <P>&#21024;&#38500;&#25972;&#20010;&#38598;&#21512;&#31867;&#65288;&#21482;&#29992;&#19968;&#21477;DELETE&#35821;&#21477;&#65289;&#65292;&#28982;&#21518;&#22686;&#21152;5&#20010;&#25968;&#25454;&#12290; </P></LI></UL></DIV>
<P>Hibernate&#36824;&#27809;&#37027;&#20040;&#32874;&#26126;&#65292;&#30693;&#36947;&#31532;&#20108;&#31181;&#36873;&#25321;&#21487;&#33021;&#20250;&#27604;&#36739;&#24555;&#12290; 
&#65288;&#20063;&#35768;&#35753;Hibernate&#19981;&#36825;&#20040;&#32874;&#26126;&#20063;&#26159;&#22909;&#20107;&#65292;&#21542;&#21017;&#21487;&#33021;&#20250;&#24341;&#21457;&#24847;&#22806;&#30340;“&#25968;&#25454;&#24211;&#35302;&#21457;&#22120;”&#20043;&#31867;&#30340;&#38382;&#39064;&#12290;&#65289; </P>
<P>&#24184;&#36816;&#30340;&#26159;&#65292;&#20320;&#21487;&#20197;&#24378;&#21046;&#20351;&#29992;&#31532;&#20108;&#31181;&#31574;&#30053;&#12290;&#20320;&#38656;&#35201;&#21462;&#28040;&#21407;&#26469;&#30340;&#25972;&#20010;&#38598;&#21512;&#31867;&#65288;&#35299;&#38500;&#20854;&#24341;&#29992;&#65289;&#65292; 
&#28982;&#21518;&#20877;&#36820;&#22238;&#19968;&#20010;&#26032;&#30340;&#23454;&#20363;&#21270;&#30340;&#38598;&#21512;&#31867;&#65292;&#21482;&#21253;&#21547;&#38656;&#35201;&#30340;&#20803;&#32032;&#12290;&#26377;&#20123;&#26102;&#20505;&#36825;&#26159;&#38750;&#24120;&#26377;&#29992;&#30340;&#12290; </P>
<P>&#26174;&#28982;&#65292;&#19968;&#27425;&#24615;&#21024;&#38500;&#24182;&#19981;&#36866;&#29992;&#20110;&#34987;&#26144;&#23556;&#20026;<TT class=literal>inverse="true"</TT>&#30340;&#38598;&#21512;&#12290; </P></DIV></DIV>
<DIV lang=zh-cn class=sect1>
<DIV class=titlepage>
<DIV>
<DIV>
<H2 class=title style="CLEAR: both"><A 
name=performance-monitoring></A>19.6.&nbsp; &#30417;&#27979;&#24615;&#33021;&#65288;Monitoring performance&#65289; 
</H2></DIV></DIV>
<DIV></DIV></DIV>
<P>&#27809;&#26377;&#30417;&#27979;&#21644;&#24615;&#33021;&#21442;&#25968;&#32780;&#36827;&#34892;&#20248;&#21270;&#26159;&#27627;&#26080;&#24847;&#20041;&#30340;&#12290;Hibernate&#20026;&#20854;&#20869;&#37096;&#25805;&#20316;&#25552;&#20379;&#20102;&#19968;&#31995;&#21015;&#30340;&#31034;&#24847;&#22270;&#65292;&#22240;&#27492;&#21487;&#20197;&#20174; &#27599;&#20010;<TT 
class=literal>SessionFactory</TT>&#25235;&#21462;&#20854;&#32479;&#35745;&#25968;&#25454;&#12290; </P>
<DIV lang=zh-cn class=sect2>
<DIV class=titlepage>
<DIV>
<DIV>
<H3 class=title><A name=performance-monitoring-sf></A>19.6.1.&nbsp; 
&#30417;&#27979;SessionFactory </H3></DIV></DIV>
<DIV></DIV></DIV>
<P>&#20320;&#21487;&#20197;&#26377;&#20004;&#31181;&#26041;&#24335;&#35775;&#38382;<TT class=literal>SessionFactory</TT>&#30340;&#25968;&#25454;&#35760;&#24405;&#65292;&#31532;&#19968;&#31181;&#23601;&#26159;&#33258;&#24049;&#30452;&#25509;&#35843;&#29992; <TT 
class=literal>sessionFactory.getStatistics()</TT>&#26041;&#27861;&#35835;&#21462;&#12289;&#26174;&#31034;<TT 
class=literal>&#32479;&#35745;</TT>&#25968;&#25454;&#12290; </P>
<P>&#27492;&#22806;&#65292;&#22914;&#26524;&#20320;&#25171;&#24320;<TT class=literal>StatisticsService</TT> 
MBean&#36873;&#39033;&#65292;&#37027;&#20040;Hibernate&#21017;&#21487;&#20197;&#20351;&#29992;JMX&#25216;&#26415; &#21457;&#24067;&#20854;&#25968;&#25454;&#35760;&#24405;&#12290;&#20320;&#21487;&#20197;&#35753;&#24212;&#29992;&#20013;&#25152;&#26377;&#30340;<TT 
class=literal>SessionFactory</TT>&#21516;&#26102;&#20849;&#20139;&#19968;&#20010;MBean&#65292;&#20063;&#21487;&#20197;&#27599;&#20010; 
SessionFactory&#20998;&#37197;&#19968;&#20010;MBean&#12290;&#19979;&#38754;&#30340;&#20195;&#30721;&#21363;&#26159;&#20854;&#28436;&#31034;&#20195;&#30721;&#65306; </P><PRE class=programlisting>// MBean service registration for a specific SessionFactory
Hashtable tb = new Hashtable();
tb.put("type", "statistics");
tb.put("sessionFactory", "myFinancialApp");
ObjectName on = new ObjectName("hibernate", tb); // MBean object name

StatisticsService stats = new StatisticsService(); // MBean implementation
stats.setSessionFactory(sessionFactory); // Bind the stats to a SessionFactory
server.registerMBean(stats, on); // Register the Mbean on the server</PRE><PRE class=programlisting>// MBean service registration for all SessionFactory's
Hashtable tb = new Hashtable();
tb.put("type", "statistics");
tb.put("sessionFactory", "all");
ObjectName on = new ObjectName("hibernate", tb); // MBean object name

StatisticsService stats = new StatisticsService(); // MBean implementation
server.registerMBean(stats, on); // Register the MBean on the server</PRE>
<P>TODO&#65306;&#20173;&#38656;&#35201;&#35828;&#26126;&#30340;&#26159;&#65306;&#22312;&#31532;&#19968;&#20010;&#20363;&#23376;&#20013;&#65292;&#25105;&#20204;&#30452;&#25509;&#24471;&#21040;&#21644;&#20351;&#29992;MBean&#65307;&#32780;&#22312;&#31532;&#20108;&#20010;&#20363;&#23376;&#20013;&#65292;&#22312;&#20351;&#29992;MBean&#20043;&#21069; 
&#25105;&#20204;&#21017;&#38656;&#35201;&#32473;&#20986;SessionFactory&#30340;JNDI&#21517;&#65292;&#20351;&#29992;<TT 
class=literal>hibernateStatsBean.setSessionFactoryJNDIName("my/JNDI/Name")</TT> 
&#24471;&#21040;SessionFactory&#65292;&#28982;&#21518;&#23558;MBean&#20445;&#23384;&#20110;&#20854;&#20013;&#12290; </P>
<P>&#20320;&#21487;&#20197;&#36890;&#36807;&#20197;&#19979;&#26041;&#27861;&#25171;&#24320;&#25110;&#20851;&#38381;<TT class=literal>SessionFactory</TT>&#30340;&#30417;&#27979;&#21151;&#33021;&#65306; </P>
<DIV class=itemizedlist>
<UL type=disc>
  <LI>
  <P>&#22312;&#37197;&#32622;&#26399;&#38388;&#65292;&#23558;<TT class=literal>hibernate.generate_statistics</TT>&#35774;&#32622;&#20026;<TT 
  class=literal>true</TT>&#25110;<TT class=literal>false</TT>&#65307; </P></LI></UL></DIV>
<DIV class=itemizedlist>
<UL type=disc>
  <LI>
  <P>&#22312;&#36816;&#34892;&#26399;&#38388;&#65292;&#21017;&#21487;&#20197;&#21487;&#20197;&#36890;&#36807;<TT 
  class=literal>sf.getStatistics().setStatisticsEnabled(true)</TT> &#25110;<TT 
  class=literal>hibernateStatsBean.setStatisticsEnabled(true)</TT> 
</P></LI></UL></DIV>
<P>&#20320;&#20063;&#21487;&#20197;&#22312;&#31243;&#24207;&#20013;&#35843;&#29992;<TT class=literal>clear()</TT>&#26041;&#27861;&#37325;&#32622;&#32479;&#35745;&#25968;&#25454;&#65292;&#35843;&#29992;<TT 
class=literal>logSummary()</TT> &#22312;&#26085;&#24535;&#20013;&#35760;&#24405;&#65288;info&#32423;&#21035;&#65289;&#20854;&#24635;&#32467;&#12290; </P></DIV>
<DIV lang=zh-cn class=sect2>
<DIV class=titlepage>
<DIV>
<DIV>
<H3 class=title><A name=performance-monitoring-metrics></A>19.6.2.&nbsp; 
&#25968;&#25454;&#35760;&#24405;&#65288;Metrics&#65289; </H3></DIV></DIV>
<DIV></DIV></DIV>
<P>Hibernate&#25552;&#20379;&#20102;&#19968;&#31995;&#21015;&#25968;&#25454;&#35760;&#24405;&#65292;&#20854;&#35760;&#24405;&#30340;&#20869;&#23481;&#21253;&#25324;&#20174;&#26368;&#22522;&#26412;&#30340;&#20449;&#24687;&#21040;&#19982;&#20855;&#20307;&#22330;&#26223;&#30340;&#29305;&#27530;&#20449;&#24687;&#12290;&#25152;&#26377;&#30340;&#27979;&#37327;&#20540;&#37117;&#21487;&#20197;&#30001; <TT 
class=literal>Statistics</TT>&#25509;&#21475;&#36827;&#34892;&#35775;&#38382;&#65292;&#20027;&#35201;&#20998;&#20026;&#19977;&#31867;&#65306; </P>
<DIV class=itemizedlist>
<UL type=disc>
  <LI>
  <P>&#20351;&#29992;<TT class=literal>Session</TT>&#30340;&#26222;&#36890;&#25968;&#25454;&#35760;&#24405;&#65292;&#20363;&#22914;&#25171;&#24320;&#30340;Session&#30340;&#20010;&#25968;&#12289;&#21462;&#24471;&#30340;JDBC&#30340;&#36830;&#25509;&#25968;&#31561;&#65307; </P>
  <LI>
  <P>&#23454;&#20307;&#12289;&#38598;&#21512;&#12289;&#26597;&#35810;&#12289;&#32531;&#23384;&#31561;&#20869;&#23481;&#30340;&#32479;&#19968;&#25968;&#25454;&#35760;&#24405; </P>
  <LI>
  <P>&#21644;&#20855;&#20307;&#23454;&#20307;&#12289;&#38598;&#21512;&#12289;&#26597;&#35810;&#12289;&#32531;&#23384;&#30456;&#20851;&#30340;&#35814;&#32454;&#25968;&#25454;&#35760;&#24405; </P></LI></UL></DIV>
<P>&#20363;&#22914;&#65306;&#20320;&#21487;&#20197;&#26816;&#26597;&#32531;&#23384;&#30340;&#21629;&#20013;&#25104;&#21151;&#27425;&#25968;&#65292;&#32531;&#23384;&#30340;&#21629;&#20013;&#22833;&#36133;&#27425;&#25968;&#65292;&#23454;&#20307;&#12289;&#38598;&#21512;&#21644;&#26597;&#35810;&#30340;&#20351;&#29992;&#27010;&#29575;&#65292;&#26597;&#35810;&#30340;&#24179;&#22343;&#26102;&#38388;&#31561;&#12290;&#35831;&#27880;&#24847; 
Java&#20013;&#26102;&#38388;&#30340;&#36817;&#20284;&#31934;&#24230;&#26159;&#27627;&#31186;&#12290;Hibernate&#30340;&#25968;&#25454;&#31934;&#24230;&#21644;&#20855;&#20307;&#30340;JVM&#26377;&#20851;&#65292;&#22312;&#26377;&#20123;&#24179;&#21488;&#19978;&#20854;&#31934;&#24230;&#29978;&#33267;&#21482;&#33021;&#31934;&#30830;&#21040;10&#31186;&#12290; </P>
<P>&#20320;&#21487;&#20197;&#30452;&#25509;&#20351;&#29992;getter&#26041;&#27861;&#24471;&#21040;&#20840;&#23616;&#25968;&#25454;&#35760;&#24405;&#65288;&#20363;&#22914;&#65292;&#21644;&#20855;&#20307;&#30340;&#23454;&#20307;&#12289;&#38598;&#21512;&#12289;&#32531;&#23384;&#21306;&#26080;&#20851;&#30340;&#25968;&#25454;&#65289;&#65292;&#20320;&#20063;&#21487;&#20197;&#22312;&#20855;&#20307;&#26597;&#35810;&#20013;&#36890;&#36807;&#26631;&#35760;&#23454;&#20307;&#21517;&#12289; 
&#25110;HQL&#12289;SQL&#35821;&#21477;&#24471;&#21040;&#26576;&#23454;&#20307;&#30340;&#25968;&#25454;&#35760;&#24405;&#12290;&#35831;&#21442;&#32771;<TT class=literal>Statistics</TT>&#12289;<TT 
class=literal>EntityStatistics</TT>&#12289; <TT 
class=literal>CollectionStatistics</TT>&#12289;<TT 
class=literal>SecondLevelCacheStatistics</TT>&#12289; &#21644;<TT 
class=literal>QueryStatistics</TT>&#30340;API&#25991;&#26723;&#20197;&#25235;&#21462;&#26356;&#22810;&#20449;&#24687;&#12290;&#19979;&#38754;&#30340;&#20195;&#30721;&#21017;&#26159;&#20010;&#31616;&#21333;&#30340;&#20363;&#23376;&#65306; </P><PRE class=programlisting>Statistics stats = HibernateUtil.sessionFactory.getStatistics();

double queryCacheHitCount  = stats.getQueryCacheHitCount();
double queryCacheMissCount = stats.getQueryCacheMissCount();
double queryCacheHitRatio =
  queryCacheHitCount / (queryCacheHitCount + queryCacheMissCount);

log.info("Query Hit ratio:" + queryCacheHitRatio);

EntityStatistics entityStats =
  stats.getEntityStatistics( Cat.class.getName() );
long changes =
        entityStats.getInsertCount()
        + entityStats.getUpdateCount()
        + entityStats.getDeleteCount();
log.info(Cat.class.getName() + " changed " + changes + "times"  );</PRE>
<P>&#22914;&#26524;&#20320;&#24819;&#24471;&#21040;&#25152;&#26377;&#23454;&#20307;&#12289;&#38598;&#21512;&#12289;&#26597;&#35810;&#21644;&#32531;&#23384;&#21306;&#30340;&#25968;&#25454;&#65292;&#20320;&#21487;&#20197;&#36890;&#36807;&#20197;&#19979;&#26041;&#27861;&#33719;&#24471;&#23454;&#20307;&#12289;&#38598;&#21512;&#12289;&#26597;&#35810;&#21644;&#32531;&#23384;&#21306;&#21015;&#34920;&#65306; <TT 
class=literal>getQueries()</TT>&#12289;<TT class=literal>getEntityNames()</TT>&#12289; <TT 
class=literal>getCollectionRoleNames()</TT>&#21644; <TT 
class=literal>getSecondLevelCacheRegionNames()</TT>&#12290; </P></DIV></DIV></DIV>
<DIV class=navfooter>
<HR>

<TABLE width="100%" summary="Navigation footer">
  <TBODY>
  <TR>
    <TD width="40%" align=left><A accessKey=p href="xml.html">&#19978;&#19968;&#39029;</A>&nbsp;</TD>
    <TD width="20%" align=center><A accessKey=u href="index.html">&#19978;&#19968;&#32423;</A></TD>
    <TD width="40%" align=right>&nbsp;<A accessKey=n 
      href="toolsetguide.html">&#19979;&#19968;&#39029;</A></TD></TR>
  <TR>
    <TD vAlign=top width="40%" align=left>&#31532;&nbsp;18&nbsp;&#31456;&nbsp;XML&#26144;&#23556;&nbsp;</TD>
    <TD width="20%" align=center><A accessKey=h href="index.html">&#36215;&#22987;&#39029;</A></TD>
    <TD vAlign=top width="40%" 
  align=right>&nbsp;&#31532;&nbsp;20&nbsp;&#31456;&nbsp;&#24037;&#20855;&#31665;&#25351;&#21335;</TD></TR></TBODY></TABLE></DIV></BODY></HTML>
