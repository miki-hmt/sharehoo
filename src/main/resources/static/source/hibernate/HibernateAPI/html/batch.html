<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML><HEAD><TITLE>&#31532; 13 &#31456; &#25209;&#37327;&#22788;&#29702;&#65288;Batch processing&#65289;</TITLE>
<META content="text/html; charset=ISO-8859-1" http-equiv=Content-Type><LINK 
rel=stylesheet type=text/css href="../shared/css/html.css">
<META name=GENERATOR content="MSHTML 11.00.9431.193"><LINK 
title="HIBERNATE - &#31526;&#21512;Java&#20064;&#24815;&#30340;&#20851;&#31995;&#25968;&#25454;&#24211;&#25345;&#20037;&#21270;" rel=home href="index.html"><LINK 
title="HIBERNATE - &#31526;&#21512;Java&#20064;&#24815;&#30340;&#20851;&#31995;&#25968;&#25454;&#24211;&#25345;&#20037;&#21270;" rel=up href="index.html"><LINK 
title="&#31532;&nbsp;12&nbsp;&#31456;&nbsp;&#10;&#9;&#25318;&#25130;&#22120;&#19982;&#20107;&#20214;(Interceptors and events)&#10;&#9;" 
rel=previous href="events.html"><LINK 
title="&#31532;&nbsp;14&nbsp;&#31456;&nbsp;HQL: Hibernate&#26597;&#35810;&#35821;&#35328;" rel=next 
href="queryhql.html"></HEAD>
<BODY aLink=#0000ff link=#0000ff bgColor=white text=black vLink=#840084>
<DIV class=navheader>
<TABLE width="100%" summary="Navigation header">
  <TBODY>
  <TR>
    <TH colSpan=3 align=center>&#31532;&nbsp;13&nbsp;&#31456;&nbsp;&#25209;&#37327;&#22788;&#29702;&#65288;Batch 
  processing&#65289;</TH></TR>
  <TR>
    <TD width="20%" align=left><A accessKey=p 
    href="events.html">&#19978;&#19968;&#39029;</A>&nbsp;</TD>
    <TH width="60%" align=center>&nbsp;</TH>
    <TD width="20%" align=right>&nbsp;<A accessKey=n 
      href="queryhql.html">&#19979;&#19968;&#39029;</A></TD></TR></TBODY></TABLE>
<HR>
</DIV>
<DIV lang=zh-cn class=chapter>
<DIV class=titlepage>
<DIV>
<DIV>
<H2 class=title><A name=batch></A>&#31532;&nbsp;13&nbsp;&#31456;&nbsp;&#25209;&#37327;&#22788;&#29702;&#65288;Batch 
processing&#65289;</H2>
<P class=title>&#23398;&#20064;<FONT color=#ff0000>QQ&#32676;&#65306;</FONT><FONT color=#ff0000 
size=5>476133513&nbsp;&nbsp; &#21487;&#20197;&#21152;&#32676;&#19968;&#36215;&#35752;&#35770;&#23398;&#20064;</FONT></P></DIV></DIV>
<DIV></DIV></DIV>
<P>&#20351;&#29992;Hibernate&#23558; 100 000 &#26465;&#35760;&#24405;&#25554;&#20837;&#21040;&#25968;&#25454;&#24211;&#30340;&#19968;&#20010;&#24456;&#33258;&#28982;&#30340;&#20570;&#27861;&#21487;&#33021;&#26159;&#36825;&#26679;&#30340; </P><PRE class=programlisting>Session session = sessionFactory.openSession();
Transaction tx = session.beginTransaction();
for ( int i=0; i&lt;100000; i++ ) {
    Customer customer = new Customer(.....);
    session.save(customer);
}
tx.commit();
session.close();</PRE>
<P>&#36825;&#27573;&#31243;&#24207;&#22823;&#27010;&#36816;&#34892;&#21040; 50 000 &#26465;&#35760;&#24405;&#24038;&#21491;&#20250;&#22833;&#36133;&#24182;&#25243;&#20986; <TT 
class=literal>&#20869;&#23384;&#28322;&#20986;&#24322;&#24120;&#65288;OutOfMemoryException&#65289;</TT> &#12290; &#36825;&#26159;&#22240;&#20026; Hibernate &#25226;&#25152;&#26377;&#26032;&#25554;&#20837;&#30340; <TT 
class=literal>&#23458;&#25143;&#65288;Customer&#65289;</TT>&#23454;&#20363;&#22312; session&#32423;&#21035;&#30340;&#32531;&#23384;&#21306;&#36827;&#34892;&#20102;&#32531;&#23384;&#30340;&#32536;&#25925;&#12290; </P>
<P>&#25105;&#20204;&#20250;&#22312;&#26412;&#31456;&#21578;&#35785;&#20320;&#22914;&#20309;&#36991;&#20813;&#27492;&#31867;&#38382;&#39064;&#12290;&#39318;&#20808;&#65292;&#22914;&#26524;&#20320;&#35201;&#25191;&#34892;&#25209;&#37327;&#22788;&#29702;&#24182;&#19988;&#24819;&#35201;&#36798;&#21040;&#19968;&#20010;&#29702;&#24819;&#30340;&#24615;&#33021;&#65292; 
&#37027;&#20040;&#20351;&#29992;JDBC&#30340;&#25209;&#37327;&#65288;batching&#65289;&#21151;&#33021;&#26159;&#33267;&#20851;&#37325;&#35201;&#12290;&#23558;JDBC&#30340;&#25209;&#37327;&#25235;&#21462;&#25968;&#37327;&#65288;batch size&#65289;&#21442;&#25968;&#35774;&#32622;&#21040;&#19968;&#20010;&#21512;&#36866;&#20540; &#65288;&#27604;&#22914;&#65292;10-50&#20043;&#38388;&#65289;&#65306; 
</P><PRE class=programlisting>hibernate.jdbc.batch_size 20</PRE>
<P>&#20320;&#20063;&#21487;&#33021;&#24819;&#22312;&#25191;&#34892;&#25209;&#37327;&#22788;&#29702;&#26102;&#20851;&#38381;&#20108;&#32423;&#32531;&#23384;&#65306; </P><PRE class=programlisting>hibernate.cache.use_second_level_cache false</PRE>
<P>&#20294;&#26159;&#65292;&#36825;&#19981;&#26159;&#32477;&#23545;&#24517;&#39035;&#30340;&#65292;&#22240;&#20026;&#25105;&#20204;&#21487;&#20197;&#26174;&#24335;&#35774;&#32622;<TT class=literal>CacheMode</TT>&#26469;&#20851;&#38381;&#19982;&#20108;&#32423;&#32531;&#23384;&#30340;&#20132;&#20114;&#12290; </P>
<DIV lang=zh-cn class=sect1>
<DIV class=titlepage>
<DIV>
<DIV>
<H2 class=title style="CLEAR: both"><A 
name=batch-inserts></A>13.1.&nbsp;&#25209;&#37327;&#25554;&#20837;&#65288;Batch inserts&#65289;</H2></DIV></DIV>
<DIV></DIV></DIV>
<P>&#22914;&#26524;&#35201;&#23558;&#24456;&#22810;&#23545;&#35937;&#25345;&#20037;&#21270;&#65292;&#20320;&#24517;&#39035;&#36890;&#36807;&#32463;&#24120;&#30340;&#35843;&#29992; <TT class=literal>flush()</TT> &#20197;&#21450;&#31245;&#21518;&#35843;&#29992; <TT 
class=literal>clear()</TT> &#26469;&#25511;&#21046;&#31532;&#19968;&#32423;&#32531;&#23384;&#30340;&#22823;&#23567;&#12290; </P><PRE class=programlisting>Session session = sessionFactory.openSession();
Transaction tx = session.beginTransaction();
   
for ( int i=0; i&lt;100000; i++ ) {
    Customer customer = new Customer(.....);
    session.save(customer);
    if ( i % 20 == 0 ) { //20, same as the JDBC batch size //20,&#19982;JDBC&#25209;&#37327;&#35774;&#32622;&#30456;&#21516;
        //flush a batch of inserts and release memory:
        //&#23558;&#26412;&#25209;&#25554;&#20837;&#30340;&#23545;&#35937;&#31435;&#21363;&#20889;&#20837;&#25968;&#25454;&#24211;&#24182;&#37322;&#25918;&#20869;&#23384;
        session.flush();
        session.clear();
    }
}
   
tx.commit();
session.close();</PRE></DIV>
<DIV lang=zh-cn class=sect1>
<DIV class=titlepage>
<DIV>
<DIV>
<H2 class=title style="CLEAR: both"><A 
name=batch-update></A>13.2.&nbsp;&#25209;&#37327;&#26356;&#26032;&#65288;Batch updates&#65289;</H2></DIV></DIV>
<DIV></DIV></DIV>
<P>&#27492;&#26041;&#27861;&#21516;&#26679;&#36866;&#29992;&#20110;&#26816;&#32034;&#21644;&#26356;&#26032;&#25968;&#25454;&#12290;&#27492;&#22806;&#65292;&#22312;&#36827;&#34892;&#20250;&#36820;&#22238;&#24456;&#22810;&#34892;&#25968;&#25454;&#30340;&#26597;&#35810;&#26102;&#65292; &#20320;&#38656;&#35201;&#20351;&#29992; <TT class=literal>scroll()</TT> 
&#26041;&#27861;&#20197;&#20415;&#20805;&#20998;&#21033;&#29992;&#26381;&#21153;&#22120;&#31471;&#28216;&#26631;&#25152;&#24102;&#26469;&#30340;&#22909;&#22788;&#12290; </P><PRE class=programlisting>Session session = sessionFactory.openSession();
Transaction tx = session.beginTransaction();
   
ScrollableResults customers = session.getNamedQuery("GetCustomers")
    .setCacheMode(CacheMode.IGNORE)
    .scroll(ScrollMode.FORWARD_ONLY);
int count=0;
while ( customers.next() ) {
    Customer customer = (Customer) customers.get(0);
    customer.updateStuff(...);
    if ( ++count % 20 == 0 ) {
        //flush a batch of updates and release memory:
        session.flush();
        session.clear();
    }
}
   
tx.commit();
session.close();</PRE></DIV>
<DIV lang=zh-cn class=sect1>
<DIV class=titlepage>
<DIV>
<DIV>
<H2 class=title style="CLEAR: both"><A 
name=batch-statelesssession></A>13.3.&nbsp;StatelessSession 
(&#26080;&#29366;&#24577;session)&#25509;&#21475;</H2></DIV></DIV>
<DIV></DIV></DIV>
<P>&#20316;&#20026;&#36873;&#25321;&#65292;Hibernate&#25552;&#20379;&#20102;&#22522;&#20110;&#21629;&#20196;&#30340;API&#65292;&#21487;&#20197;&#29992;detached object&#30340;&#24418;&#24335;&#25226;&#25968;&#25454;&#20197;&#27969;&#30340;&#26041;&#27861;&#21152;&#20837;&#21040;&#25968;&#25454;&#24211;&#65292;&#25110;&#20174;&#25968;&#25454;&#24211;&#36755;&#20986;&#12290;<TT 
class=literal>StatelessSession</TT>&#27809;&#26377;&#25345;&#20037;&#21270;&#19978;&#19979;&#25991;&#65292;&#20063;&#19981;&#25552;&#20379;&#22810;&#23569;&#39640;&#23618;&#30340;&#29983;&#21629;&#21608;&#26399;&#35821;&#20041;&#12290;&#29305;&#21035;&#26159;&#65292;&#26080;&#29366;&#24577;session&#19981;&#23454;&#29616;&#31532;&#19968;&#32423;cache,&#20063;&#19981;&#21644;&#31532;&#20108;&#32423;&#32531;&#23384;&#65292;&#25110;&#32773;&#26597;&#35810;&#32531;&#23384;&#20132;&#20114;&#12290;&#23427;&#19981;&#23454;&#29616;&#20107;&#21153;&#21270;&#20889;&#65292;&#20063;&#19981;&#23454;&#29616;&#33039;&#25968;&#25454;&#26816;&#26597;&#12290;&#29992;stateless 
session&#36827;&#34892;&#30340;&#25805;&#20316;&#29978;&#33267;&#19981;&#32423;&#32852;&#21040;&#20851;&#32852;&#23454;&#20363;&#12290;stateless session&#24573;&#30053;&#38598;&#21512;&#31867;(Collections)&#12290;&#36890;&#36807;stateless 
session&#36827;&#34892;&#30340;&#25805;&#20316;&#19981;&#35302;&#21457;Hibernate&#30340;&#20107;&#20214;&#27169;&#22411;&#21644;&#25318;&#25130;&#22120;&#12290;&#26080;&#29366;&#24577;session&#23545;&#25968;&#25454;&#30340;&#28151;&#28102;&#29616;&#35937;&#20813;&#30123;&#65292;&#22240;&#20026;&#23427;&#27809;&#26377;&#31532;&#19968;&#32423;&#32531;&#23384;&#12290;&#26080;&#29366;&#24577;session&#26159;&#20302;&#23618;&#30340;&#25277;&#35937;&#65292;&#21644;&#20302;&#23618;JDBC&#30456;&#24403;&#25509;&#36817;&#12290; 
</P><PRE class=programlisting>StatelessSession session = sessionFactory.openStatelessSession();
Transaction tx = session.beginTransaction();
   
ScrollableResults customers = session.getNamedQuery("GetCustomers")
    .scroll(ScrollMode.FORWARD_ONLY);
while ( customers.next() ) {
    Customer customer = (Customer) customers.get(0);
    customer.updateStuff(...);
    session.update(customer);
}
   
tx.commit();
session.close();</PRE>
<P>&#27880;&#24847;&#22312;&#19978;&#38754;&#30340;&#20363;&#23376;&#20013;&#65292;&#26597;&#35810;&#36820;&#22238;&#30340;<TT 
class=literal>Customer</TT>&#23454;&#20363;&#31435;&#21363;&#34987;&#33073;&#31649;(detach)&#12290;&#23427;&#20204;&#19982;&#20219;&#20309;&#25345;&#20037;&#21270;&#19978;&#19979;&#25991;&#37117;&#27809;&#26377;&#20851;&#31995;&#12290; </P>
<P><TT class=literal>StatelessSession</TT> &#25509;&#21475;&#23450;&#20041;&#30340;<TT class=literal>insert(), 
update()</TT> &#21644; <TT class=literal>delete()</TT>&#25805;&#20316;&#26159;&#30452;&#25509;&#30340;&#25968;&#25454;&#24211;&#34892;&#32423;&#21035;&#25805;&#20316;&#65292;&#20854;&#32467;&#26524;&#26159;&#31435;&#21051;&#25191;&#34892;&#19968;&#26465;<TT 
class=literal>INSERT, UPDATE</TT> &#25110; <TT class=literal>DELETE</TT> 
&#35821;&#21477;&#12290;&#22240;&#27492;&#65292;&#23427;&#20204;&#30340;&#35821;&#20041;&#21644;<TT class=literal>Session</TT> &#25509;&#21475;&#23450;&#20041;&#30340;<TT class=literal>save(), 
saveOrUpdate()</TT> &#21644;<TT class=literal>delete()</TT> &#25805;&#20316;&#26377;&#24456;&#22823;&#30340;&#19981;&#21516;&#12290; </P></DIV>
<DIV lang=zh-cn class=sect1>
<DIV class=titlepage>
<DIV>
<DIV>
<H2 class=title style="CLEAR: both"><A 
name=batch-direct></A>13.4.&nbsp;DML(&#25968;&#25454;&#25805;&#20316;&#35821;&#35328;)&#39118;&#26684;&#30340;&#25805;&#20316;(DML-style 
operations)</H2></DIV></DIV>
<DIV></DIV></DIV>
<P>hence manipulating (using the SQL <TT class=literal>Data Manipulation 
Language</TT> (DML) statements: <TT class=literal>INSERT</TT>, <TT 
class=literal>UPDATE</TT>, <TT class=literal>DELETE</TT>) data directly in the 
database will not affect in-memory state. However, Hibernate provides methods 
for bulk SQL-style DML statement execution which are performed through the 
Hibernate Query Language (<A title="&#31532;&nbsp;14&nbsp;&#31456;&nbsp;HQL: Hibernate&#26597;&#35810;&#35821;&#35328;" 
href="queryhql.html">&#31532;&nbsp;14&nbsp;&#31456; <I>HQL: Hibernate&#26597;&#35810;&#35821;&#35328;</I></A>). 
&#23601;&#20687;&#24050;&#32463;&#35752;&#35770;&#30340;&#37027;&#26679;&#65292;&#33258;&#21160;&#21644;&#36879;&#26126;&#30340; &#23545;&#35937;/&#20851;&#31995; &#26144;&#23556;&#65288;object/relational mapping&#65289;&#20851;&#27880;&#20110;&#31649;&#29702;&#23545;&#35937;&#30340;&#29366;&#24577;&#12290; 
&#36825;&#23601;&#24847;&#21619;&#30528;&#23545;&#35937;&#30340;&#29366;&#24577;&#23384;&#22312;&#20110;&#20869;&#23384;&#65292;&#22240;&#27492;&#30452;&#25509;&#25805;&#20316; (&#20351;&#29992; SQL <TT class=literal>Data Manipulation 
Language</TT>(DML,&#25968;&#25454;&#25805;&#20316;&#35821;&#35328;&#65289;&#35821;&#21477; &#65306;<TT class=literal>INSERT</TT> ,<TT 
class=literal>UPDATE</TT> &#21644; <TT class=literal>DELETE</TT>) 
&#25968;&#25454;&#24211;&#20013;&#30340;&#25968;&#25454;&#23558;&#19981;&#20250;&#24433;&#21709;&#20869;&#23384;&#20013;&#30340;&#23545;&#35937;&#29366;&#24577;&#21644;&#23545;&#35937;&#25968;&#25454;&#12290; &#19981;&#36807;&#65292;Hibernate&#25552;&#20379;&#36890;&#36807;Hibernate&#26597;&#35810;&#35821;&#35328;&#65288;<A 
title="&#31532;&nbsp;14&nbsp;&#31456;&nbsp;HQL: Hibernate&#26597;&#35810;&#35821;&#35328;" 
href="queryhql.html">&#31532;&nbsp;14&nbsp;&#31456; <I>HQL: Hibernate&#26597;&#35810;&#35821;&#35328;</I></A>&#65289;&#26469;&#25191;&#34892;&#22823;&#25209; 
&#37327;SQL&#39118;&#26684;&#30340;DML&#35821;&#21477;&#30340;&#26041;&#27861;&#12290; </P>
<P><TT class=literal>UPDATE</TT> &#21644; <TT class=literal>DELETE</TT>&#35821;&#21477;&#30340;&#35821;&#27861;&#20026;&#65306; <TT 
class=literal>( UPDATE | DELETE ) FROM? EntityName (WHERE 
where_conditions)?</TT> &#26377;&#20960;&#28857;&#35828;&#26126;&#65306; </P>
<DIV class=itemizedlist>
<UL type=disc compact>
  <LI>
  <P>&#22312;FROM&#23376;&#21477;&#65288;from-clause&#65289;&#20013;&#65292;FROM&#20851;&#38190;&#23383;&#26159;&#21487;&#36873;&#30340; </P>
  <LI>
  <P>&#22312;FROM&#23376;&#21477;&#65288;from-clause&#65289;&#20013;&#21482;&#33021;&#26377;&#19968;&#20010;&#23454;&#20307;&#21517;&#65292;&#23427;&#21487;&#20197;&#26159;&#21035;&#21517;&#12290;&#22914;&#26524;&#23454;&#20307;&#21517;&#26159;&#21035;&#21517;&#65292;&#37027;&#20040;&#20219;&#20309;&#34987;&#24341;&#29992;&#30340;&#23646;&#24615;&#37117;&#24517;&#39035;&#21152;&#19978;&#27492;&#21035;&#21517;&#30340;&#21069;&#32512;&#65307;&#22914;&#26524;&#19981;&#26159;&#21035;&#21517;&#65292;&#37027;&#20040;&#20219;&#20309;&#26377;&#21069;&#32512;&#30340;&#23646;&#24615;&#24341;&#29992;&#37117;&#26159;&#38750;&#27861;&#30340;&#12290; 
  </P>
  <LI>
  <P>&#19981;&#33021;&#22312;&#22823;&#25209;&#37327;HQL&#35821;&#21477;&#20013;&#20351;&#29992;<A title="14.4.&nbsp;join &#35821;&#27861;&#30340;&#24418;&#24335;" 
  href="queryhql.html#queryhql-joins-forms">&#31532;&nbsp;14.4&nbsp;&#33410; “join 
  &#35821;&#27861;&#30340;&#24418;&#24335;”</A>&#65288;&#26174;&#24335;&#25110;&#32773;&#38544;&#24335;&#30340;&#37117;&#19981;&#34892;&#65289;&#12290;&#19981;&#36807;&#22312;WHERE&#23376;&#21477;&#20013;&#21487;&#20197;&#20351;&#29992;&#23376;&#26597;&#35810;&#12290;&#21487;&#20197;&#22312;where&#23376;&#21477;&#20013;&#20351;&#29992;&#23376;&#26597;&#35810;&#65292;&#23376;&#26597;&#35810;&#26412;&#36523;&#21487;&#20197;&#21253;&#21547;join&#12290; </P>
  <LI>
  <P>&#25972;&#20010;WHERE&#23376;&#21477;&#26159;&#21487;&#36873;&#30340;&#12290; </P></LI></UL></DIV>
<P>&#20030;&#20010;&#20363;&#23376;&#65292;&#20351;&#29992;<TT class=literal>Query.executeUpdate()</TT>&#26041;&#27861;&#25191;&#34892;&#19968;&#20010;HQL <TT 
class=literal>UPDATE</TT>&#35821;&#21477;(&#65306; (&#26041;&#27861;&#21629;&#21517;&#26159;&#26469;&#28304;&#20110;JDBC's <TT 
class=literal>PreparedStatement.executeUpdate()</TT>): </P><PRE class=programlisting>Session session = sessionFactory.openSession();
		Transaction tx = session.beginTransaction();

		String hqlUpdate = "update Customer c set c.name = :newName where c.name = :oldName";
		// or String hqlUpdate = "update Customer set name = :newName where name = :oldName";
		int updatedEntities = s.createQuery( hqlUpdate )
		        .setString( "newName", newName )
		        .setString( "oldName", oldName )
		        .executeUpdate();
		tx.commit();
		session.close();</PRE>
<P>HQL <TT class=literal>UPDATE</TT>&#35821;&#21477;&#65292;&#40664;&#35748;&#19981;&#20250;&#24433;&#21709;&#26356;&#26032;&#23454;&#20307;&#30340;<A 
title=5.1.7.&nbsp;&#29256;&#26412;&#65288;version&#65289;(&#21487;&#36873;) 
href="mapping.html#mapping-declaration-version">&#31532;&nbsp;5.1.7&nbsp;&#33410; 
“&#29256;&#26412;&#65288;version&#65289;(&#21487;&#36873;)”</A>&#25110;&#32773;<A title="5.1.8.&nbsp;timestamp (&#21487;&#36873;)" 
href="mapping.html#mapping-declaration-timestamp">&#31532;&nbsp;5.1.8&nbsp;&#33410; “timestamp 
(&#21487;&#36873;)”</A>&#23646;&#24615;&#20540;&#12290;&#36825;&#21644;EJB3&#35268;&#33539;&#26159;&#19968;&#33268;&#30340;&#12290;&#20294;&#26159;&#65292;&#36890;&#36807;&#20351;&#29992;<TT class=literal>versioned 
update</TT>&#65292;&#20320;&#21487;&#20197;&#24378;&#21046;Hibernate&#27491;&#30830;&#30340;&#37325;&#32622;<TT class=literal>version</TT>&#25110;&#32773;<TT 
class=literal>timestamp</TT>&#23646;&#24615;&#20540;&#12290;&#36825;&#36890;&#36807;&#22312;<TT class=literal>UPDATE</TT>&#20851;&#38190;&#23383;&#21518;&#38754;&#22686;&#21152;<TT 
class=literal>VERSIONED</TT>&#20851;&#38190;&#23383;&#26469;&#23454;&#29616;&#30340;&#12290; </P><PRE class=programlisting>Session session = sessionFactory.openSession();
Transaction tx = session.beginTransaction();
String hqlVersionedUpdate = "update versioned Customer set name = :newName where name = :oldName";
int updatedEntities = s.createQuery( hqlUpdate )
        .setString( "newName", newName )
        .setString( "oldName", oldName )
        .executeUpdate();
tx.commit();
session.close();</PRE>
<P>&#27880;&#24847;&#65292;&#33258;&#23450;&#20041;&#30340;&#29256;&#26412;&#31867;&#22411;(<TT 
class=literal>org.hibernate.usertype.UserVersionType</TT>)&#19981;&#20801;&#35768;&#21644;<TT 
class=literal>update versioned</TT>&#35821;&#21477;&#32852;&#29992;&#12290; </P>
<P>&#25191;&#34892;&#19968;&#20010;HQL <TT class=literal>DELETE</TT>&#65292;&#21516;&#26679;&#20351;&#29992; <TT 
class=literal>Query.executeUpdate()</TT> &#26041;&#27861;: </P><PRE class=programlisting>Session session = sessionFactory.openSession();
		Transaction tx = session.beginTransaction();

		String hqlDelete = "delete Customer c where c.name = :oldName";
		// or String hqlDelete = "delete Customer where name = :oldName";
		int deletedEntities = s.createQuery( hqlDelete )
		        .setString( "oldName", oldName )
		        .executeUpdate();
		tx.commit();
		session.close();</PRE>
<P>&#30001;<TT class=literal>Query.executeUpdate()</TT>&#26041;&#27861;&#36820;&#22238;&#30340;<TT 
class=literal>&#25972;&#22411;</TT>&#20540;&#34920;&#26126;&#20102;&#21463;&#27492;&#25805;&#20316;&#24433;&#21709;&#30340;&#35760;&#24405;&#25968;&#37327;&#12290; 
&#27880;&#24847;&#36825;&#20010;&#25968;&#20540;&#21487;&#33021;&#19982;&#25968;&#25454;&#24211;&#20013;&#34987;&#65288;&#26368;&#21518;&#19968;&#26465;SQL&#35821;&#21477;&#65289;&#24433;&#21709;&#20102;&#30340;“&#34892;”&#25968;&#26377;&#20851;&#65292;&#20063;&#21487;&#33021;&#27809;&#26377;&#12290;&#19968;&#20010;&#22823;&#25209;&#37327;HQL&#25805;&#20316;&#21487;&#33021;&#23548;&#33268;&#22810;&#26465;&#23454;&#38469;&#30340;SQL&#35821;&#21477;&#34987;&#25191;&#34892;&#65292; 
&#20030;&#20010;&#20363;&#23376;&#65292;&#23545;joined-subclass&#26144;&#23556;&#26041;&#24335;&#30340;&#31867;&#36827;&#34892;&#30340;&#27492;&#31867;&#25805;&#20316;&#12290;&#36825;&#20010;&#36820;&#22238;&#20540;&#20195;&#34920;&#20102;&#23454;&#38469;&#34987;&#35821;&#21477;&#24433;&#21709;&#20102;&#30340;&#35760;&#24405;&#25968;&#37327;&#12290;&#22312;&#37027;&#20010;joined-subclass&#30340;&#20363;&#23376;&#20013;&#65292; 
&#23545;&#19968;&#20010;&#23376;&#31867;&#30340;&#21024;&#38500;&#23454;&#38469;&#19978;&#21487;&#33021;&#19981;&#20165;&#20165;&#20250;&#21024;&#38500;&#23376;&#31867;&#26144;&#23556;&#21040;&#30340;&#34920;&#32780;&#19988;&#20250;&#24433;&#21709;“&#26681;”&#34920;&#65292;&#36824;&#26377;&#21487;&#33021;&#24433;&#21709;&#19982;&#20043;&#26377;&#32487;&#25215;&#20851;&#31995;&#30340;joined-subclass&#26144;&#23556;&#26041;&#24335;&#30340;&#23376;&#31867;&#30340;&#34920;&#12290; </P>
<P><TT class=literal>INSERT</TT>&#35821;&#21477;&#30340;&#20266;&#30721;&#26159;: <TT class=literal>INSERT INTO EntityName 
properties_list select_statement</TT>. &#35201;&#27880;&#24847;&#30340;&#26159;: </P>
<DIV class=itemizedlist>
<UL type=disc compact>
  <LI>
  <P>&#21482;&#25903;&#25345;INSERT INTO ... SELECT ...&#24418;&#24335;,&#19981;&#25903;&#25345;INSERT INTO ... VALUES ...&#24418;&#24335;. </P>
  <P>properties_list&#21644;SQL <TT class=literal>INSERT</TT>&#35821;&#21477;&#20013;&#30340;<TT 
  class=literal>&#23383;&#27573;&#23450;&#20041;(column 
  speficiation)</TT>&#31867;&#20284;&#12290;&#23545;&#21442;&#19982;&#32487;&#25215;&#26641;&#26144;&#23556;&#30340;&#23454;&#20307;&#32780;&#35328;&#65292;&#21482;&#26377;&#30452;&#25509;&#23450;&#20041;&#22312;&#32473;&#23450;&#30340;&#31867;&#32423;&#21035;&#30340;&#23646;&#24615;&#25165;&#33021;&#30452;&#25509;&#22312;properties_list&#20013;&#20351;&#29992;&#12290;&#36229;&#31867;&#30340;&#23646;&#24615;&#19981;&#34987;&#25903;&#25345;&#65307;&#23376;&#31867;&#30340;&#23646;&#24615;&#26080;&#24847;&#20041;&#12290;&#25442;&#21477;&#35805;&#35828;&#65292;<TT 
  class=literal>INSERT</TT>&#22825;&#29983;&#19981;&#25903;&#25345;&#22810;&#24577;&#12290; </P>
  <LI>
  <P>select_statement&#21487;&#20197;&#26159;&#20219;&#20309;&#21512;&#27861;&#30340;HQL&#36873;&#25321;&#26597;&#35810;&#65292;&#19981;&#36807;&#35201;&#20445;&#35777;&#36820;&#22238;&#31867;&#22411;&#24517;&#39035;&#21644;&#35201;&#25554;&#20837;&#30340;&#31867;&#22411;&#23436;&#20840;&#21305;&#37197;&#12290;&#30446;&#21069;&#65292;&#36825;&#19968;&#26816;&#26597;&#26159;&#22312;&#26597;&#35810;&#32534;&#35793;&#30340;&#26102;&#20505;&#36827;&#34892;&#30340;&#65292;&#32780;&#19981;&#26159;&#25226;&#23427;&#20132;&#32473;&#25968;&#25454;&#24211;&#12290;&#27880;&#24847;&#65292;&#22312;Hibernate<TT 
  class=literal>Type</TT>&#38388;&#22914;&#26524;&#21482;&#26159;<SPAN 
  class=emphasis><EM>&#31561;&#20215;&#65288;equivalent&#65289;</EM></SPAN>&#32780;&#38750;<SPAN 
  class=emphasis><EM>&#30456;&#31561;(equal)</EM></SPAN>&#65292;&#20250;&#23548;&#33268;&#38382;&#39064;&#12290;&#23450;&#20041;&#20026;<TT 
  class=literal>org.hibernate.type.DateType</TT>&#21644;<TT 
  class=literal>org.hibernate.type.TimestampType</TT>&#30340;&#20004;&#20010;&#23646;&#24615;&#21487;&#33021;&#20250;&#20135;&#29983;&#31867;&#22411;&#19981;&#21305;&#37197;&#38169;&#35823;&#65292;&#34429;&#28982;&#25968;&#25454;&#24211;&#32423;&#21487;&#33021;&#19981;&#21152;&#21306;&#20998;&#25110;&#32773;&#21487;&#20197;&#22788;&#29702;&#36825;&#31181;&#36716;&#25442;&#12290; 
  </P>
  <LI>
  <P>&#23545;id&#23646;&#24615;&#26469;&#35828;,insert&#35821;&#21477;&#32473;&#20320;&#20004;&#20010;&#36873;&#25321;&#12290;&#20320;&#21487;&#20197;&#26126;&#30830;&#22320;&#22312;properties_list&#34920;&#20013;&#25351;&#23450;id&#23646;&#24615;&#65288;&#36825;&#26679;&#23427;&#30340;&#20540;&#26159;&#20174;&#23545;&#24212;&#30340;select&#34920;&#36798;&#24335;&#20013;&#33719;&#24471;&#65289;&#65292;&#25110;&#32773;&#22312;properties_list&#20013;&#30465;&#30053;&#23427;&#65288;&#27492;&#26102;&#20351;&#29992;&#29983;&#25104;&#25351;&#65289;&#12290;&#21518;&#19968;&#31181;&#36873;&#25321;&#21482;&#26377;&#24403;&#20351;&#29992;&#22312;&#25968;&#25454;&#24211;&#20013;&#29983;&#25104;&#20540;&#30340;id&#20135;&#29983;&#22120;&#26102;&#25165;&#33021;&#20351;&#29992;&#65307;&#22914;&#26524;&#26159;“&#20869;&#23384;”&#20013;&#35745;&#31639;&#30340;&#31867;&#22411;&#29983;&#25104;&#22120;&#65292;&#22312;&#35299;&#26512;&#26102;&#20250;&#25243;&#20986;&#19968;&#20010;&#24322;&#24120;&#12290;&#27880;&#24847;&#65292;&#20026;&#20102;&#35828;&#26126;&#36825;&#19968;&#38382;&#39064;&#65292;&#25968;&#25454;&#24211;&#20135;&#29983;&#20540;&#30340;&#29983;&#25104;&#22120;&#26159;<TT 
  class=literal>org.hibernate.id.SequenceGenerator</TT>&#65288;&#21644;&#23427;&#30340;&#23376;&#31867;&#65289;&#65292;&#20197;&#21450;&#20219;&#20309;<TT 
  class=literal>org.hibernate.id.PostInsertIdentifierGenerator</TT>&#25509;&#21475;&#30340;&#23454;&#29616;&#12290;&#36825;&#20799;&#26368;&#20540;&#24471;&#27880;&#24847;&#30340;&#24847;&#22806;&#26159;<TT 
  class=literal>org.hibernate.id.TableHiLoGenerator</TT>&#65292;&#23427;&#19981;&#33021;&#22312;&#27492;&#20351;&#29992;&#65292;&#22240;&#20026;&#23427;&#27809;&#26377;&#24471;&#21040;&#20854;&#20540;&#30340;&#36884;&#24452;&#12290; 
  </P>
  <LI>
  <P>&#23545;&#26144;&#23556;&#20026;<TT class=literal>version</TT> &#25110; <TT 
  class=literal>timestamp</TT>&#30340;&#23646;&#24615;&#26469;&#35828;&#65292;insert&#35821;&#21477;&#20063;&#32473;&#20320;&#20004;&#20010;&#36873;&#25321;&#65292;&#20320;&#21487;&#20197;&#22312;properties_list&#34920;&#20013;&#25351;&#23450;&#65288;&#27492;&#26102;&#20854;&#20540;&#20174;&#23545;&#24212;&#30340;select&#34920;&#36798;&#24335;&#20013;&#33719;&#24471;&#65289;&#65292;&#25110;&#32773;&#22312;properties_list&#20013;&#30465;&#30053;&#23427;&#65288;&#27492;&#26102;&#65292;&#20351;&#29992;&#22312;<TT 
  class=literal>org.hibernate.type.VersionType</TT> &#20013;&#23450;&#20041;&#30340;<TT class=literal>seed 
  value(&#31181;&#23376;&#20540;)</TT>&#65289;&#12290; </P></LI></UL></DIV>
<P>&#25191;&#34892;HQL <TT class=literal>INSERT</TT>&#35821;&#21477;&#30340;&#20363;&#23376;&#22914;&#19979;&#65306; </P><PRE class=programlisting>Session session = sessionFactory.openSession();
Transaction tx = session.beginTransaction();

String hqlInsert = "insert into DelinquentAccount (id, name) select c.id, c.name from Customer c where ...";
int createdEntities = s.createQuery( hqlInsert )
        .executeUpdate();
tx.commit();
session.close();</PRE></DIV></DIV>
<DIV class=navfooter>
<HR>

<TABLE width="100%" summary="Navigation footer">
  <TBODY>
  <TR>
    <TD width="40%" align=left><A accessKey=p 
    href="events.html">&#19978;&#19968;&#39029;</A>&nbsp;</TD>
    <TD width="20%" align=center><A accessKey=u href="index.html">&#19978;&#19968;&#32423;</A></TD>
    <TD width="40%" align=right>&nbsp;<A accessKey=n 
      href="queryhql.html">&#19979;&#19968;&#39029;</A></TD></TR>
  <TR>
    <TD vAlign=top width="40%" align=left>&#31532;&nbsp;12&nbsp;&#31456;&nbsp; 
      &#25318;&#25130;&#22120;&#19982;&#20107;&#20214;(Interceptors and events) &nbsp;</TD>
    <TD width="20%" align=center><A accessKey=h href="index.html">&#36215;&#22987;&#39029;</A></TD>
    <TD vAlign=top width="40%" align=right>&nbsp;&#31532;&nbsp;14&nbsp;&#31456;&nbsp;HQL: 
      Hibernate&#26597;&#35810;&#35821;&#35328;</TD></TR></TBODY></TABLE></DIV></BODY></HTML>
