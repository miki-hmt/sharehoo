<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML><HEAD><TITLE>&#31532; 17 &#31456; &#36807;&#28388;&#25968;&#25454;</TITLE>
<META content="text/html; charset=ISO-8859-1" http-equiv=Content-Type><LINK 
rel=stylesheet type=text/css href="../shared/css/html.css">
<META name=GENERATOR content="MSHTML 11.00.9431.193"><LINK 
title="HIBERNATE - &#31526;&#21512;Java&#20064;&#24815;&#30340;&#20851;&#31995;&#25968;&#25454;&#24211;&#25345;&#20037;&#21270;" rel=home href="index.html"><LINK 
title="HIBERNATE - &#31526;&#21512;Java&#20064;&#24815;&#30340;&#20851;&#31995;&#25968;&#25454;&#24211;&#25345;&#20037;&#21270;" rel=up href="index.html"><LINK 
title="&#31532;&nbsp;16&nbsp;&#31456;&nbsp;Native SQL&#26597;&#35810;" rel=previous 
href="querysql.html"><LINK title=&#31532;&nbsp;18&nbsp;&#31456;&nbsp;XML&#26144;&#23556; rel=next 
href="xml.html"></HEAD>
<BODY aLink=#0000ff link=#0000ff bgColor=white text=black vLink=#840084>
<DIV class=navheader>
<TABLE width="100%" summary="Navigation header">
  <TBODY>
  <TR>
    <TH colSpan=3 align=center>&#31532;&nbsp;17&nbsp;&#31456;&nbsp;&#36807;&#28388;&#25968;&#25454;</TH></TR>
  <TR>
    <TD width="20%" align=left><A accessKey=p 
    href="querysql.html">&#19978;&#19968;&#39029;</A>&nbsp;</TD>
    <TH width="60%" align=center>&nbsp;</TH>
    <TD width="20%" align=right>&nbsp;<A accessKey=n 
  href="xml.html">&#19979;&#19968;&#39029;</A></TD></TR></TBODY></TABLE>
<HR>
</DIV>
<DIV lang=zh-cn class=chapter>
<DIV class=titlepage>
<DIV>
<DIV>
<H2 class=title><A name=filters></A>&#31532;&nbsp;17&nbsp;&#31456;&nbsp;&#36807;&#28388;&#25968;&#25454;</H2>
<P class=title>&#23398;&#20064;<FONT color=#ff0000>QQ&#32676;&#65306;</FONT><FONT color=#ff0000 
size=5>476133513&nbsp;&nbsp; &#21487;&#20197;&#21152;&#32676;&#19968;&#36215;&#35752;&#35770;&#23398;&#20064;</FONT></P></DIV></DIV>
<DIV></DIV></DIV>
<P>Hibernate3 &#25552;&#20379;&#20102;&#19968;&#31181;&#21019;&#26032;&#30340;&#26041;&#24335;&#26469;&#22788;&#29702;&#20855;&#26377;“&#26174;&#24615;(visibility)”&#35268;&#21017;&#30340;&#25968;&#25454;&#65292;&#37027;&#23601;&#26159;&#20351;&#29992;<SPAN 
class=emphasis><EM>Hibernate filter</EM></SPAN>&#12290; <SPAN 
class=emphasis><EM>Hibernate filter</EM></SPAN>&#26159;&#20840;&#23616;&#26377;&#25928;&#30340;&#12289;&#20855;&#26377;&#21517;&#23383;&#12289;&#21487;&#20197;&#24102;&#21442;&#25968;&#30340;&#36807;&#28388;&#22120;&#65292; 
&#23545;&#20110;&#26576;&#20010;&#29305;&#23450;&#30340;Hibernate session&#24744;&#21487;&#20197;&#36873;&#25321;&#26159;&#21542;&#21551;&#29992;&#65288;&#25110;&#31105;&#29992;&#65289;&#26576;&#20010;&#36807;&#28388;&#22120;&#12290; </P>
<DIV lang=zh-cn class=sect1>
<DIV class=titlepage>
<DIV>
<DIV>
<H2 class=title style="CLEAR: both"><A 
name=objectstate-filters></A>17.1.&nbsp;Hibernate &#36807;&#28388;&#22120;(filters)</H2></DIV></DIV>
<DIV></DIV></DIV>
<P>Hibernate3&#26032;&#22686;&#20102;&#23545;&#26576;&#20010;&#31867;&#25110;&#32773;&#38598;&#21512;&#20351;&#29992;&#39044;&#20808;&#23450;&#20041;&#30340;&#36807;&#28388;&#22120;&#26465;&#20214;(filter criteria)&#30340;&#21151;&#33021;&#12290;&#36807;&#28388;&#22120;&#26465;&#20214;&#30456;&#24403;&#20110;&#23450;&#20041;&#19968;&#20010; 
&#38750;&#24120;&#31867;&#20284;&#20110;&#31867;&#21644;&#21508;&#31181;&#38598;&#21512;&#19978;&#30340;“where”&#23646;&#24615;&#30340;&#32422;&#26463;&#23376;&#21477;&#65292;&#20294;&#26159;&#36807;&#28388;&#22120;&#26465;&#20214;&#21487;&#20197;&#24102;&#21442;&#25968;&#12290; &#24212;&#29992;&#31243;&#24207;&#21487;&#20197;&#22312;&#36816;&#34892;&#26102;&#20915;&#23450;&#26159;&#21542;&#21551;&#29992;&#32473;&#23450;&#30340;&#36807;&#28388;&#22120;&#65292;&#20197;&#21450;&#20351;&#29992;&#20160;&#20040;&#26679;&#30340;&#21442;&#25968;&#20540;&#12290; 
&#36807;&#28388;&#22120;&#30340;&#29992;&#27861;&#24456;&#20687;&#25968;&#25454;&#24211;&#35270;&#22270;&#65292;&#21482;&#19981;&#36807;&#26159;&#22312;&#24212;&#29992;&#31243;&#24207;&#20013;&#30830;&#23450;&#20351;&#29992;&#20160;&#20040;&#26679;&#30340;&#21442;&#25968;&#30340;&#12290; </P>
<P>&#35201;&#20351;&#29992;&#36807;&#28388;&#22120;&#65292;&#24517;&#39035;&#39318;&#20808;&#22312;&#30456;&#24212;&#30340;&#26144;&#23556;&#33410;&#28857;&#20013;&#23450;&#20041;&#12290;&#32780;&#23450;&#20041;&#19968;&#20010;&#36807;&#28388;&#22120;&#65292;&#35201;&#29992;&#21040;&#20301;&#20110;<TT 
class=literal>&lt;hibernate-mapping/&gt;</TT> &#33410;&#28857;&#20043;&#20869;&#30340;<TT 
class=literal>&lt;filter-def/&gt;</TT>&#33410;&#28857;&#65306; </P><PRE class=programlisting>&lt;filter-def name="myFilter"&gt;
    &lt;filter-param name="myFilterParam" type="string"/&gt;
&lt;/filter-def&gt;</PRE>
<P>&#23450;&#20041;&#22909;&#20043;&#21518;&#65292;&#23601;&#21487;&#20197;&#22312;&#26576;&#20010;&#31867;&#20013;&#20351;&#29992;&#36825;&#20010;&#36807;&#28388;&#22120;&#65306; </P><PRE class=programlisting>&lt;class name="myClass" ...&gt;
    ...
    &lt;filter name="myFilter" condition=":myFilterParam = MY_FILTERED_COLUMN"/&gt;
&lt;/class&gt;</PRE>
<P>&#20063;&#21487;&#20197;&#22312;&#26576;&#20010;&#38598;&#21512;&#20351;&#29992;&#23427;&#65306; </P><PRE class=programlisting>&lt;set ...&gt;
    &lt;filter name="myFilter" condition=":myFilterParam = MY_FILTERED_COLUMN"/&gt;
&lt;/set&gt;</PRE>
<P>&#21487;&#20197;&#22312;&#22810;&#20010;&#31867;&#25110;&#38598;&#21512;&#20013;&#20351;&#29992;&#26576;&#20010;&#36807;&#28388;&#22120;&#65307;&#26576;&#20010;&#31867;&#25110;&#32773;&#38598;&#21512;&#20013;&#20063;&#21487;&#20197;&#20351;&#29992;&#22810;&#20010;&#36807;&#28388;&#22120;&#12290; </P>
<P><TT class=literal>Session</TT>&#23545;&#35937;&#20013;&#20250;&#29992;&#21040;&#30340;&#26041;&#27861;&#26377;&#65306;<TT 
class=literal>enableFilter(String filterName)</TT>, <TT 
class=literal>getEnabledFilter(String filterName)</TT>, &#21644; <TT 
class=literal>disableFilter(String filterName)</TT>. Session&#20013;&#40664;&#35748;&#26159;<SPAN 
class=emphasis><EM>&#19981;</EM></SPAN>&#21551;&#29992;&#36807;&#28388;&#22120;&#30340;&#65292;&#24517;&#39035;&#36890;&#36807;<TT 
class=literal>Session.enabledFilter()</TT>&#26041;&#27861;&#26174;&#24335;&#30340;&#21551;&#29992;&#12290; &#35813;&#26041;&#27861;&#36820;&#22238;&#34987;&#21551;&#29992;&#30340;<TT 
class=literal>Filter</TT>&#30340;&#23454;&#20363;&#12290;&#20197;&#19978;&#25991;&#23450;&#20041;&#30340;&#36807;&#28388;&#22120;&#20026;&#20363;&#65306; </P><PRE class=programlisting>session.enableFilter("myFilter").setParameter("myFilterParam", "some-value");</PRE>
<P>&#27880;&#24847;&#65292;org.hibernate.Filter&#30340;&#26041;&#27861;&#20801;&#35768;&#38142;&#24335;&#26041;&#27861;&#35843;&#29992;&#12290;&#65288;&#31867;&#20284;&#19978;&#38754;&#20363;&#23376;&#20013;&#21551;&#29992;Filter&#20043;&#21518;&#35774;&#23450;Filter&#21442;&#25968;&#36825;&#20010;“&#26041;&#27861;&#38142;”&#65289; 
Hibernate&#30340;&#20854;&#20182;&#37096;&#20998;&#20063;&#22823;&#22810;&#26377;&#36825;&#20010;&#29305;&#24615;&#12290; </P>
<P>&#19979;&#38754;&#26159;&#19968;&#20010;&#27604;&#36739;&#23436;&#25972;&#30340;&#20363;&#23376;&#65292;&#20351;&#29992;&#20102;&#35760;&#24405;&#29983;&#25928;&#26085;&#26399;&#27169;&#24335;&#36807;&#28388;&#26377;&#26102;&#25928;&#30340;&#25968;&#25454;&#65306; </P><PRE class=programlisting>&lt;filter-def name="effectiveDate"&gt;
    &lt;filter-param name="asOfDate" type="date"/&gt;
&lt;/filter-def&gt;

&lt;class name="Employee" ...&gt;
...
    &lt;many-to-one name="department" column="dept_id" class="Department"/&gt;
    &lt;property name="effectiveStartDate" type="date" column="eff_start_dt"/&gt;
    &lt;property name="effectiveEndDate" type="date" column="eff_end_dt"/&gt;
...
    &lt;!--
        Note that this assumes non-terminal records have an eff_end_dt set to
        a max db date for simplicity-sake

		&#27880;&#24847;&#65292;&#20026;&#20102;&#31616;&#21333;&#36215;&#35265;&#65292;&#27492;&#22788;&#20551;&#35774;&#38599;&#29992;&#20851;&#31995;&#29983;&#25928;&#26399;&#23578;&#26410;&#32467;&#26463;&#30340;&#35760;&#24405;&#30340;eff_end_dt&#23383;&#27573;&#30340;&#20540;&#31561;&#20110;&#25968;&#25454;&#24211;&#26368;&#22823;&#30340;&#26085;&#26399;
    --&gt;
    &lt;filter name="effectiveDate"
            condition=":asOfDate BETWEEN eff_start_dt and eff_end_dt"/&gt;
&lt;/class&gt;

&lt;class name="Department" ...&gt;
...
    &lt;set name="employees" lazy="true"&gt;
        &lt;key column="dept_id"/&gt;
        &lt;one-to-many class="Employee"/&gt;
        &lt;filter name="effectiveDate"
                condition=":asOfDate BETWEEN eff_start_dt and eff_end_dt"/&gt;
    &lt;/set&gt;
&lt;/class&gt;</PRE>
<P>&#23450;&#20041;&#22909;&#21518;&#65292;&#22914;&#26524;&#24819;&#35201;&#20445;&#35777;&#21462;&#22238;&#30340;&#37117;&#26159;&#30446;&#21069;&#22788;&#20110;&#29983;&#25928;&#26399;&#30340;&#35760;&#24405;&#65292;&#21482;&#38656;&#22312;&#33719;&#21462;&#38599;&#21592;&#25968;&#25454;&#30340;&#25805;&#20316;&#20043;&#21069;&#20808;&#24320;&#21551;&#36807;&#28388;&#22120;&#21363;&#21487;&#65306; </P><PRE class=programlisting>Session session = ...;
session.enabledFilter("effectiveDate").setParameter("asOfDate", new Date());
List results = session.createQuery("from Employee as e where e.salary &gt; :targetSalary")
         .setLong("targetSalary", new Long(1000000))
         .list();
</PRE>
<P>&#22312;&#19978;&#38754;&#30340;HQL&#20013;&#65292;&#34429;&#28982;&#25105;&#20204;&#20165;&#20165;&#26174;&#24335;&#30340;&#20351;&#29992;&#20102;&#19968;&#20010;&#34218;&#27700;&#26465;&#20214;&#65292;&#20294;&#22240;&#20026;&#21551;&#29992;&#20102;&#36807;&#28388;&#22120;&#65292;&#26597;&#35810;&#23558;&#20165;&#36820;&#22238;&#37027;&#20123;&#30446;&#21069;&#38599;&#29992; 
&#20851;&#31995;&#22788;&#20110;&#29983;&#25928;&#26399;&#30340;&#65292;&#24182;&#19988;&#34218;&#27700;&#39640;&#20110;&#19968;&#30334;&#19975;&#32654;&#20992;&#30340;&#38599;&#21592;&#30340;&#25968;&#25454;&#12290; </P>
<P>&#27880;&#24847;&#65306;&#22914;&#26524;&#20320;&#25171;&#31639;&#22312;&#20351;&#29992;&#22806;&#36830;&#25509;&#65288;&#25110;&#32773;&#36890;&#36807;HQL&#25110;load fetching&#65289;&#30340;&#21516;&#26102;&#20351;&#29992;&#36807;&#28388;&#22120;&#65292;&#35201;&#27880;&#24847;&#26465;&#20214;&#34920;&#36798;&#24335;&#30340;&#26041;&#21521;&#65288;&#24038;&#36824;&#26159;&#21491;&#65289;&#12290; 
&#26368;&#23433;&#20840;&#30340;&#26041;&#24335;&#26159;&#20351;&#29992;&#24038;&#22806;&#36830;&#25509;&#65288;left outer joining&#65289;&#12290;&#24182;&#19988;&#36890;&#24120;&#26469;&#35828;&#65292;&#20808;&#20889;&#21442;&#25968;&#65292; &#28982;&#21518;&#26159;&#25805;&#20316;&#31526;&#65292;&#26368;&#21518;&#20889;&#25968;&#25454;&#24211;&#23383;&#27573;&#21517;&#12290; 
</P></DIV></DIV>
<DIV class=navfooter>
<HR>

<TABLE width="100%" summary="Navigation footer">
  <TBODY>
  <TR>
    <TD width="40%" align=left><A accessKey=p 
    href="querysql.html">&#19978;&#19968;&#39029;</A>&nbsp;</TD>
    <TD width="20%" align=center><A accessKey=u href="index.html">&#19978;&#19968;&#32423;</A></TD>
    <TD width="40%" align=right>&nbsp;<A accessKey=n 
  href="xml.html">&#19979;&#19968;&#39029;</A></TD></TR>
  <TR>
    <TD vAlign=top width="40%" align=left>&#31532;&nbsp;16&nbsp;&#31456;&nbsp;Native 
    SQL&#26597;&#35810;&nbsp;</TD>
    <TD width="20%" align=center><A accessKey=h href="index.html">&#36215;&#22987;&#39029;</A></TD>
    <TD vAlign=top width="40%" 
  align=right>&nbsp;&#31532;&nbsp;18&nbsp;&#31456;&nbsp;XML&#26144;&#23556;</TD></TR></TBODY></TABLE></DIV></BODY></HTML>
