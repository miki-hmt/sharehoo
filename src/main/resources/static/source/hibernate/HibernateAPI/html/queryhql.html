<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML><HEAD><TITLE>&#31532; 14 &#31456; HQL: Hibernate&#26597;&#35810;&#35821;&#35328;</TITLE>
<META content="text/html; charset=ISO-8859-1" http-equiv=Content-Type><LINK 
rel=stylesheet type=text/css href="../shared/css/html.css">
<META name=GENERATOR content="MSHTML 11.00.9431.193"><LINK 
title="HIBERNATE - &#31526;&#21512;Java&#20064;&#24815;&#30340;&#20851;&#31995;&#25968;&#25454;&#24211;&#25345;&#20037;&#21270;" rel=home href="index.html"><LINK 
title="HIBERNATE - &#31526;&#21512;Java&#20064;&#24815;&#30340;&#20851;&#31995;&#25968;&#25454;&#24211;&#25345;&#20037;&#21270;" rel=up href="index.html"><LINK 
title="&#31532;&nbsp;13&nbsp;&#31456;&nbsp;&#25209;&#37327;&#22788;&#29702;&#65288;Batch processing&#65289;" rel=previous 
href="batch.html"><LINK 
title="&#31532;&nbsp;15&nbsp;&#31456;&nbsp;&#10;    &#26465;&#20214;&#26597;&#35810;(Criteria Queries)&#10;    " rel=next 
href="querycriteria.html"></HEAD>
<BODY aLink=#0000ff link=#0000ff bgColor=white text=black vLink=#840084>
<DIV class=navheader>
<TABLE width="100%" summary="Navigation header">
  <TBODY>
  <TR>
    <TH colSpan=3 align=center>&#31532;&nbsp;14&nbsp;&#31456;&nbsp;HQL: Hibernate&#26597;&#35810;&#35821;&#35328;</TH></TR>
  <TR>
    <TD width="20%" align=left><A accessKey=p 
    href="batch.html">&#19978;&#19968;&#39029;</A>&nbsp;</TD>
    <TH width="60%" align=center>&nbsp;</TH>
    <TD width="20%" align=right>&nbsp;<A accessKey=n 
      href="querycriteria.html">&#19979;&#19968;&#39029;</A></TD></TR></TBODY></TABLE>
<HR>
</DIV>
<DIV lang=zh-cn class=chapter>
<DIV class=titlepage>
<DIV>
<DIV>
<H2 class=title><A name=queryhql></A>&#31532;&nbsp;14&nbsp;&#31456;&nbsp;HQL: 
Hibernate&#26597;&#35810;&#35821;&#35328;</H2>
<P class=title>&#23398;&#20064;<FONT color=#ff0000>QQ&#32676;&#65306;</FONT><FONT color=#ff0000 
size=5>476133513&nbsp;&nbsp; &#21487;&#20197;&#21152;&#32676;&#19968;&#36215;&#35752;&#35770;&#23398;&#20064;</FONT></P></DIV></DIV>
<DIV></DIV></DIV>
<P>Hibernate&#37197;&#22791;&#20102;&#19968;&#31181;&#38750;&#24120;&#24378;&#22823;&#30340;&#26597;&#35810;&#35821;&#35328;&#65292;&#36825;&#31181;&#35821;&#35328;&#30475;&#19978;&#21435;&#24456;&#20687;SQL&#12290;&#20294;&#26159;&#19981;&#35201;&#34987;&#35821;&#27861;&#32467;&#26500; 
&#19978;&#30340;&#30456;&#20284;&#25152;&#36855;&#24785;&#65292;HQL&#26159;&#38750;&#24120;&#26377;&#24847;&#35782;&#30340;&#34987;&#35774;&#35745;&#20026;&#23436;&#20840;&#38754;&#21521;&#23545;&#35937;&#30340;&#26597;&#35810;&#65292;&#23427;&#21487;&#20197;&#29702;&#35299;&#22914;&#32487;&#25215;&#12289;&#22810;&#24577; &#21644;&#20851;&#32852;&#20043;&#31867;&#30340;&#27010;&#24565;&#12290; </P>
<DIV lang=zh-cn class=sect1>
<DIV class=titlepage>
<DIV>
<DIV>
<H2 class=title style="CLEAR: both"><A 
name=queryhql-casesensitivity></A>14.1.&nbsp;&#22823;&#23567;&#20889;&#25935;&#24863;&#24615;&#38382;&#39064;</H2></DIV></DIV>
<DIV></DIV></DIV>
<P>&#38500;&#20102;Java&#31867;&#19982;&#23646;&#24615;&#30340;&#21517;&#31216;&#22806;&#65292;&#26597;&#35810;&#35821;&#21477;&#23545;&#22823;&#23567;&#20889;&#24182;&#19981;&#25935;&#24863;&#12290; &#25152;&#20197; <TT class=literal>SeLeCT</TT> &#19982; <TT 
class=literal>sELEct</TT> &#20197;&#21450; <TT class=literal>SELECT</TT> &#26159;&#30456;&#21516;&#30340;&#65292;&#20294;&#26159; <TT 
class=literal>org.hibernate.eg.FOO</TT> &#24182;&#19981;&#31561;&#20215;&#20110; <TT 
class=literal>org.hibernate.eg.Foo</TT> &#24182;&#19988; <TT class=literal>foo.barSet</TT> 
&#20063;&#19981;&#31561;&#20215;&#20110; <TT class=literal>foo.BARSET</TT>&#12290; </P>
<P>&#26412;&#25163;&#20876;&#20013;&#30340;HQL&#20851;&#38190;&#23383;&#23558;&#20351;&#29992;&#23567;&#20889;&#23383;&#27597;. &#24456;&#22810;&#29992;&#25143;&#21457;&#29616;&#20351;&#29992;&#23436;&#20840;&#22823;&#20889;&#30340;&#20851;&#38190;&#23383;&#20250;&#20351;&#26597;&#35810;&#35821;&#21477; &#30340;&#21487;&#35835;&#24615;&#26356;&#24378;, 
&#20294;&#25105;&#20204;&#21457;&#29616;&#65292;&#24403;&#25226;&#26597;&#35810;&#35821;&#21477;&#23884;&#20837;&#21040;Java&#35821;&#21477;&#20013;&#30340;&#26102;&#20505;&#20351;&#29992;&#22823;&#20889;&#20851;&#38190;&#23383;&#27604;&#36739;&#38590;&#30475;&#12290; </P></DIV>
<DIV lang=zh-cn class=sect1>
<DIV class=titlepage>
<DIV>
<DIV>
<H2 class=title style="CLEAR: both"><A 
name=queryhql-from></A>14.2.&nbsp;from&#23376;&#21477;</H2></DIV></DIV>
<DIV></DIV></DIV>
<P>Hibernate&#20013;&#26368;&#31616;&#21333;&#30340;&#26597;&#35810;&#35821;&#21477;&#30340;&#24418;&#24335;&#22914;&#19979;&#65306; </P><PRE class=programlisting>from eg.Cat</PRE>
<P>&#35813;&#23376;&#21477;&#31616;&#21333;&#30340;&#36820;&#22238;<TT class=literal>eg.Cat</TT>&#31867;&#30340;&#25152;&#26377;&#23454;&#20363;&#12290; &#36890;&#24120;&#25105;&#20204;&#19981;&#38656;&#35201;&#20351;&#29992;&#31867;&#30340;&#20840;&#38480;&#23450;&#21517;, &#22240;&#20026; <TT 
class=literal>auto-import</TT>&#65288;&#33258;&#21160;&#24341;&#20837;&#65289; &#26159;&#32570;&#30465;&#30340;&#24773;&#20917;&#12290; &#25152;&#20197;&#25105;&#20204;&#20960;&#20046;&#21482;&#20351;&#29992;&#22914;&#19979;&#30340;&#31616;&#21333;&#20889;&#27861;&#65306; </P><PRE class=programlisting>from Cat</PRE>
<P>&#22823;&#22810;&#25968;&#24773;&#20917;&#19979;, &#20320;&#38656;&#35201;&#25351;&#23450;&#19968;&#20010;<SPAN class=emphasis><EM>&#21035;&#21517;</EM></SPAN>, &#21407;&#22240;&#26159;&#20320;&#21487;&#33021;&#38656;&#35201; 
&#22312;&#26597;&#35810;&#35821;&#21477;&#30340;&#20854;&#23427;&#37096;&#20998;&#24341;&#29992;&#21040;<TT class=literal>Cat</TT> </P><PRE class=programlisting>from Cat as cat</PRE>
<P>&#36825;&#20010;&#35821;&#21477;&#25226;&#21035;&#21517;<TT class=literal>cat</TT>&#25351;&#23450;&#32473;&#31867;<TT class=literal>Cat</TT> &#30340;&#23454;&#20363;, 
&#36825;&#26679;&#25105;&#20204;&#23601;&#21487;&#20197;&#22312;&#38543;&#21518;&#30340;&#26597;&#35810;&#20013;&#20351;&#29992;&#27492;&#21035;&#21517;&#20102;&#12290; &#20851;&#38190;&#23383;<TT class=literal>as</TT> &#26159;&#21487;&#36873;&#30340;&#65292;&#25105;&#20204;&#20063;&#21487;&#20197;&#36825;&#26679;&#20889;: </P><PRE class=programlisting>from Cat cat</PRE>
<P>&#23376;&#21477;&#20013;&#21487;&#20197;&#21516;&#26102;&#20986;&#29616;&#22810;&#20010;&#31867;, &#20854;&#26597;&#35810;&#32467;&#26524;&#26159;&#20135;&#29983;&#19968;&#20010;&#31515;&#21345;&#20799;&#31215;&#25110;&#20135;&#29983;&#36328;&#34920;&#30340;&#36830;&#25509;&#12290; </P><PRE class=programlisting>from Formula, Parameter</PRE><PRE class=programlisting>from Formula as form, Parameter as param</PRE>
<P>&#26597;&#35810;&#35821;&#21477;&#20013;&#21035;&#21517;&#30340;&#24320;&#22836;&#37096;&#20998;&#23567;&#20889;&#34987;&#35748;&#20026;&#26159;&#23454;&#36341;&#20013;&#30340;&#22909;&#20064;&#24815;&#65292; &#36825;&#26679;&#20570;&#19982;Java&#21464;&#37327;&#30340;&#21629;&#21517;&#26631;&#20934;&#20445;&#25345;&#20102;&#19968;&#33268; (&#27604;&#22914;&#65292;<TT 
class=literal>domesticCat</TT>)&#12290; </P></DIV>
<DIV lang=zh-cn class=sect1>
<DIV class=titlepage>
<DIV>
<DIV>
<H2 class=title style="CLEAR: both"><A 
name=queryhql-joins></A>14.3.&nbsp;&#20851;&#32852;(Association)&#19982;&#36830;&#25509;(Join)</H2></DIV></DIV>
<DIV></DIV></DIV>
<P>&#25105;&#20204;&#20063;&#21487;&#20197;&#20026;&#30456;&#20851;&#32852;&#30340;&#23454;&#20307;&#29978;&#33267;&#26159;&#23545;&#19968;&#20010;&#38598;&#21512;&#20013;&#30340;&#20840;&#37096;&#20803;&#32032;&#25351;&#23450;&#19968;&#20010;&#21035;&#21517;, &#36825;&#26102;&#35201;&#20351;&#29992;&#20851;&#38190;&#23383;<TT class=literal>join</TT>&#12290; </P><PRE class=programlisting>from Cat as cat 
    inner join cat.mate as mate
    left outer join cat.kittens as kitten</PRE><PRE class=programlisting>from Cat as cat left join cat.mate.kittens as kittens</PRE><PRE class=programlisting>from Formula form full join form.parameter param</PRE>
<P>&#21463;&#25903;&#25345;&#30340;&#36830;&#25509;&#31867;&#22411;&#26159;&#20174;ANSI SQL&#20013;&#20511;&#37492;&#26469;&#30340;&#12290; </P>
<DIV class=itemizedlist>
<UL type=disc compact>
  <LI>
  <P><TT class=literal>inner join</TT>&#65288;&#20869;&#36830;&#25509;&#65289; </P>
  <LI>
  <P><TT class=literal>left outer join</TT>&#65288;&#24038;&#22806;&#36830;&#25509;&#65289; </P>
  <LI>
  <P><TT class=literal>right outer join</TT>&#65288;&#21491;&#22806;&#36830;&#25509;&#65289; </P>
  <LI>
  <P><TT class=literal>full join</TT> (&#20840;&#36830;&#25509;&#65292;&#24182;&#19981;&#24120;&#29992;) </P></LI></UL></DIV>
<P>&#35821;&#21477;<TT class=literal>inner join</TT>, <TT class=literal>left outer join</TT> 
&#20197;&#21450; <TT class=literal>right outer join</TT> &#21487;&#20197;&#31616;&#20889;&#12290; </P><PRE class=programlisting>from Cat as cat 
    join cat.mate as mate
    left join cat.kittens as kitten</PRE>
<P>&#36890;&#36807;HQL&#30340;<TT class=literal>with</TT>&#20851;&#38190;&#23383;&#65292;&#20320;&#21487;&#20197;&#25552;&#20379;&#39069;&#22806;&#30340;join&#26465;&#20214;&#12290; </P><PRE class=programlisting>from Cat as cat 
    left join cat.kittens as kitten 
        with kitten.bodyWeight &gt; 10.0</PRE>
<P>&#36824;&#26377;&#65292;&#19968;&#20010;"fetch"&#36830;&#25509;&#20801;&#35768;&#20165;&#20165;&#20351;&#29992;&#19968;&#20010;&#36873;&#25321;&#35821;&#21477;&#23601;&#23558;&#30456;&#20851;&#32852;&#30340;&#23545;&#35937;&#25110;&#19968;&#32452;&#20540;&#30340;&#38598;&#21512;&#38543;&#30528;&#20182;&#20204;&#30340;&#29238;&#23545;&#35937;&#30340;&#21021;&#22987;&#21270;&#32780;&#34987;&#21021;&#22987;&#21270;&#65292;&#36825;&#31181;&#26041;&#27861;&#22312;&#20351;&#29992;&#21040;&#38598;&#21512;&#30340;&#24773;&#20917;&#19979;&#23588;&#20854;&#26377;&#29992;&#65292;&#23545;&#20110;&#20851;&#32852;&#21644;&#38598;&#21512;&#26469;&#35828;&#65292;&#23427;&#26377;&#25928;&#30340;&#20195;&#26367;&#20102;&#26144;&#23556;&#25991;&#20214;&#20013;&#30340;&#22806;&#32852;&#25509; 
&#19982;&#24310;&#36831;&#22768;&#26126;&#65288;lazy declarations&#65289;. &#26597;&#30475; <A 
title="19.1.&nbsp;&#10;&#9;&#9;&#9;&#25235;&#21462;&#31574;&#30053;(Fetching strategies)&#10;&#9;&#9;" 
href="performance.html#performance-fetching">&#31532;&nbsp;19.1&nbsp;&#33410; “ &#25235;&#21462;&#31574;&#30053;(Fetching 
strategies) ”</A> &#20197;&#33719;&#24471;&#31561;&#22810;&#30340;&#20449;&#24687;&#12290; </P><PRE class=programlisting>from Cat as cat 
    inner join fetch cat.mate
    left join fetch cat.kittens</PRE>
<P>&#19968;&#20010;fetch&#36830;&#25509;&#36890;&#24120;&#19981;&#38656;&#35201;&#34987;&#25351;&#23450;&#21035;&#21517;, &#22240;&#20026;&#30456;&#20851;&#32852;&#30340;&#23545;&#35937;&#19981;&#24212;&#24403;&#34987;&#29992;&#22312; <TT class=literal>where</TT> &#23376;&#21477; 
(&#25110;&#20854;&#23427;&#20219;&#20309;&#23376;&#21477;)&#20013;&#12290;&#21516;&#26102;&#65292;&#30456;&#20851;&#32852;&#30340;&#23545;&#35937; &#24182;&#19981;&#22312;&#26597;&#35810;&#30340;&#32467;&#26524;&#20013;&#30452;&#25509;&#36820;&#22238;&#65292;&#20294;&#21487;&#20197;&#36890;&#36807;&#20182;&#20204;&#30340;&#29238;&#23545;&#35937;&#26469;&#35775;&#38382;&#21040;&#20182;&#20204;&#12290; </P><PRE class=programlisting>from Cat as cat 
    inner join fetch cat.mate
    left join fetch cat.kittens child
    left join fetch child.kittens</PRE>
<P>&#20551;&#33509;&#20351;&#29992;<TT class=literal>iterate()</TT>&#26469;&#35843;&#29992;&#26597;&#35810;&#65292;&#35831;&#27880;&#24847;<TT 
class=literal>fetch</TT>&#26500;&#36896;&#26159;&#19981;&#33021;&#20351;&#29992;&#30340;(<TT class=literal>scroll()</TT> &#21487;&#20197;&#20351;&#29992;)&#12290;<TT 
class=literal>fetch</TT>&#20063;&#19981;&#24212;&#35813;&#19982;<TT class=literal>setMaxResults()</TT> &#25110;<TT 
class=literal>setFirstResult()</TT>&#20849;&#29992;&#65292;&#36825;&#26159;&#22240;&#20026;&#36825;&#20123;&#25805;&#20316;&#26159;&#22522;&#20110;&#32467;&#26524;&#38598;&#30340;&#65292;&#32780;&#22312;&#39044;&#20808;&#25235;&#21462;&#38598;&#21512;&#31867;&#26102;&#21487;&#33021;&#21253;&#21547;&#37325;&#22797;&#30340;&#25968;&#25454;&#65292;&#20063;&#23601;&#26159;&#35828;&#26080;&#27861;&#39044;&#20808;&#30693;&#36947;&#31934;&#30830;&#30340;&#34892;&#25968;&#12290;<TT 
class=literal>fetch</TT>&#36824;&#19981;&#33021;&#19982;&#29420;&#31435;&#30340; <TT 
class=literal>with</TT>&#26465;&#20214;&#19968;&#36215;&#20351;&#29992;&#12290;&#36890;&#36807;&#22312;&#19968;&#27425;&#26597;&#35810;&#20013;fetch&#22810;&#20010;&#38598;&#21512;&#65292;&#21487;&#20197;&#21046;&#36896;&#20986;&#31515;&#21345;&#23572;&#31215;&#65292;&#22240;&#27492;&#35831;&#22810;&#21152;&#27880;&#24847;&#12290;&#23545;bag&#26144;&#23556;&#26469;&#35828;&#65292;&#21516;&#26102;join 
fetch&#22810;&#20010;&#38598;&#21512;&#35282;&#33394;&#21487;&#33021;&#22312;&#26576;&#20123;&#24773;&#20917;&#19979;&#32473;&#20986;&#24182;&#38750;&#39044;&#26399;&#30340;&#32467;&#26524;&#65292;&#20063;&#35831;&#23567;&#24515;&#12290;&#26368;&#21518;&#27880;&#24847;&#65292;&#20351;&#29992;<TT class=literal>full join fetch</TT> 
&#19982; <TT class=literal>right join fetch</TT>&#26159;&#27809;&#26377;&#24847;&#20041;&#30340;&#12290; </P>
<P>&#22914;&#26524;&#20320;&#20351;&#29992;&#23646;&#24615;&#32423;&#21035;&#30340;&#24310;&#36831;&#33719;&#21462;&#65288;lazy fetching&#65289;&#65288;&#36825;&#26159;&#36890;&#36807;&#37325;&#26032;&#32534;&#20889;&#23383;&#33410;&#30721;&#23454;&#29616;&#30340;&#65289;&#65292;&#21487;&#20197;&#20351;&#29992; <TT class=literal>fetch 
all properties</TT> &#26469;&#24378;&#21046;Hibernate&#31435;&#21363;&#21462;&#24471;&#37027;&#20123;&#21407;&#26412;&#38656;&#35201;&#24310;&#36831;&#21152;&#36733;&#30340;&#23646;&#24615;&#65288;&#22312;&#31532;&#19968;&#20010;&#26597;&#35810;&#20013;&#65289;&#12290; </P><PRE class=programlisting>from Document fetch all properties order by name</PRE><PRE class=programlisting>from Document doc fetch all properties where lower(doc.name) like '%cats%'</PRE></DIV>
<DIV lang=zh-cn class=sect1>
<DIV class=titlepage>
<DIV>
<DIV>
<H2 class=title style="CLEAR: both"><A 
name=queryhql-joins-forms></A>14.4.&nbsp;join &#35821;&#27861;&#30340;&#24418;&#24335;</H2></DIV></DIV>
<DIV></DIV></DIV>
<P>HQL&#25903;&#25345;&#20004;&#31181;&#20851;&#32852;join&#30340;&#24418;&#24335;&#65306;<TT class=literal>implicit(&#38544;&#24335;)</TT> &#19982;<TT 
class=literal>explicit&#65288;&#26174;&#24335;&#65289;</TT>&#12290; </P>
<P>&#19978;&#19968;&#33410;&#20013;&#32473;&#20986;&#30340;&#26597;&#35810;&#37117;&#26159;&#20351;&#29992;<TT 
class=literal>explicit(&#26174;&#24335;)</TT>&#24418;&#24335;&#30340;&#65292;&#20854;&#20013;form&#23376;&#21477;&#20013;&#26126;&#30830;&#32473;&#20986;&#20102;join&#20851;&#38190;&#23383;&#12290;&#36825;&#26159;&#24314;&#35758;&#20351;&#29992;&#30340;&#26041;&#24335;&#12290; </P>
<P><TT class=literal>implicit&#65288;&#38544;&#24335;&#65289;</TT>&#24418;&#24335;&#19981;&#20351;&#29992;join&#20851;&#38190;&#23383;&#12290;&#20851;&#32852;&#20351;&#29992;"&#28857;&#21495;"&#26469;&#36827;&#34892;“&#24341;&#29992;”&#12290;<TT 
class=literal>implicit</TT> join&#21487;&#20197;&#22312;&#20219;&#20309;HQL&#23376;&#21477;&#20013;&#20986;&#29616;.<TT class=literal>implicit</TT> 
join&#22312;&#26368;&#32456;&#30340;SQL&#35821;&#21477;&#20013;&#20197;inner join&#30340;&#26041;&#24335;&#20986;&#29616;&#12290; </P><PRE class=programlisting>from Cat as cat where cat.mate.name like '%s%'</PRE></DIV>
<DIV lang=zh-cn class=sect1>
<DIV class=titlepage>
<DIV>
<DIV>
<H2 class=title style="CLEAR: both"><A 
name=queryhql-select></A>14.5.&nbsp;select&#23376;&#21477;</H2></DIV></DIV>
<DIV></DIV></DIV>
<P><TT class=literal>select</TT> &#23376;&#21477;&#36873;&#25321;&#23558;&#21738;&#20123;&#23545;&#35937;&#19982;&#23646;&#24615;&#36820; &#22238;&#21040;&#26597;&#35810;&#32467;&#26524;&#38598;&#20013;. &#32771;&#34385;&#22914;&#19979;&#24773;&#20917;: </P><PRE class=programlisting>select mate 
from Cat as cat 
    inner join cat.mate as mate</PRE>
<P>&#35813;&#35821;&#21477;&#23558;&#36873;&#25321;<TT class=literal>mate</TT>s of other <TT 
class=literal>Cat</TT>s&#12290;&#65288;&#20854;&#20182;&#29483;&#30340;&#37197;&#20598;&#65289; &#23454;&#38469;&#19978;, &#20320;&#21487;&#20197;&#26356;&#31616;&#27905;&#30340;&#29992;&#20197;&#19979;&#30340;&#26597;&#35810;&#35821;&#21477;&#34920;&#36798;&#30456;&#21516;&#30340;&#21547;&#20041;: </P><PRE class=programlisting>select cat.mate from Cat cat</PRE>
<P>&#26597;&#35810;&#35821;&#21477;&#21487;&#20197;&#36820;&#22238;&#20540;&#20026;&#20219;&#20309;&#31867;&#22411;&#30340;&#23646;&#24615;&#65292;&#21253;&#25324;&#36820;&#22238;&#31867;&#22411;&#20026;&#26576;&#31181;&#32452;&#20214;(Component)&#30340;&#23646;&#24615;: </P><PRE class=programlisting>select cat.name from DomesticCat cat
where cat.name like 'fri%'</PRE><PRE class=programlisting>select cust.name.firstName from Customer as cust</PRE>
<P>&#26597;&#35810;&#35821;&#21477;&#21487;&#20197;&#36820;&#22238;&#22810;&#20010;&#23545;&#35937;&#21644;&#65288;&#25110;&#65289;&#23646;&#24615;&#65292;&#23384;&#25918;&#22312; <TT class=literal>Object[]</TT>&#38431;&#21015;&#20013;, </P><PRE class=programlisting>select mother, offspr, mate.name 
from DomesticCat as mother
    inner join mother.mate as mate
    left outer join mother.kittens as offspr</PRE>
<P>&#25110;&#23384;&#25918;&#22312;&#19968;&#20010;<TT class=literal>List</TT>&#23545;&#35937;&#20013;, </P><PRE class=programlisting>select new list(mother, offspr, mate.name)
from DomesticCat as mother
    inner join mother.mate as mate
    left outer join mother.kittens as offspr</PRE>
<P>&#20063;&#21487;&#33021;&#30452;&#25509;&#36820;&#22238;&#19968;&#20010;&#23454;&#38469;&#30340;&#31867;&#22411;&#23433;&#20840;&#30340;Java&#23545;&#35937;, </P><PRE class=programlisting>select new Family(mother, mate, offspr)
from DomesticCat as mother
    join mother.mate as mate
    left join mother.kittens as offspr</PRE>
<P>&#20551;&#35774;&#31867;<TT class=literal>Family</TT>&#26377;&#19968;&#20010;&#21512;&#36866;&#30340;&#26500;&#36896;&#20989;&#25968;. </P>
<P>&#20320;&#21487;&#20197;&#20351;&#29992;&#20851;&#38190;&#23383;<TT class=literal>as</TT>&#32473;“&#34987;&#36873;&#25321;&#20102;&#30340;&#34920;&#36798;&#24335;”&#25351;&#27966;&#21035;&#21517;: </P><PRE class=programlisting>select max(bodyWeight) as max, min(bodyWeight) as min, count(*) as n
from Cat cat</PRE>
<P>&#36825;&#31181;&#20570;&#27861;&#22312;&#19982;&#23376;&#21477;<TT class=literal>select new map</TT>&#19968;&#36215;&#20351;&#29992;&#26102;&#26368;&#26377;&#29992;: </P><PRE class=programlisting>select new map( max(bodyWeight) as max, min(bodyWeight) as min, count(*) as n )
from Cat cat</PRE>
<P>&#35813;&#26597;&#35810;&#36820;&#22238;&#20102;&#19968;&#20010;<TT class=literal>Map</TT>&#30340;&#23545;&#35937;&#65292;&#20869;&#23481;&#26159;&#21035;&#21517;&#19982;&#34987;&#36873;&#25321;&#30340;&#20540;&#32452;&#25104;&#30340;&#21517;-&#20540;&#26144;&#23556;&#12290; </P></DIV>
<DIV lang=zh-cn class=sect1>
<DIV class=titlepage>
<DIV>
<DIV>
<H2 class=title style="CLEAR: both"><A 
name=queryhql-aggregation></A>14.6.&nbsp;&#32858;&#38598;&#20989;&#25968;</H2></DIV></DIV>
<DIV></DIV></DIV>
<P>HQL&#26597;&#35810;&#29978;&#33267;&#21487;&#20197;&#36820;&#22238;&#20316;&#29992;&#20110;&#23646;&#24615;&#20043;&#19978;&#30340;&#32858;&#38598;&#20989;&#25968;&#30340;&#35745;&#31639;&#32467;&#26524;: </P><PRE class=programlisting>select avg(cat.weight), sum(cat.weight), max(cat.weight), count(cat)
from Cat cat</PRE>
<P>&#21463;&#25903;&#25345;&#30340;&#32858;&#38598;&#20989;&#25968;&#22914;&#19979;&#65306; </P>
<DIV class=itemizedlist>
<UL type=disc compact>
  <LI>
  <P><TT class=literal>avg(...), sum(...), min(...), max(...)</TT> </P>
  <LI>
  <P><TT class=literal>count(*)</TT> </P>
  <LI>
  <P><TT class=literal>count(...), count(distinct ...), count(all...)</TT> 
  </P></LI></UL></DIV>
<P>&#20320;&#21487;&#20197;&#22312;&#36873;&#25321;&#23376;&#21477;&#20013;&#20351;&#29992;&#25968;&#23398;&#25805;&#20316;&#31526;&#12289;&#36830;&#25509;&#20197;&#21450;&#32463;&#36807;&#39564;&#35777;&#30340;SQL&#20989;&#25968;&#65306; </P><PRE class=programlisting>select cat.weight + sum(kitten.weight) 
from Cat cat 
    join cat.kittens kitten
group by cat.id, cat.weight</PRE><PRE class=programlisting>select firstName||' '||initial||' '||upper(lastName) from Person</PRE>
<P>&#20851;&#38190;&#23383;<TT class=literal>distinct</TT>&#19982;<TT class=literal>all</TT> 
&#20063;&#21487;&#20197;&#20351;&#29992;&#65292;&#23427;&#20204;&#20855;&#26377;&#19982;SQL&#30456;&#21516;&#30340;&#35821;&#20041;. </P><PRE class=programlisting>select distinct cat.name from Cat cat

select count(distinct cat.name), count(cat) from Cat cat</PRE></DIV>
<DIV lang=zh-cn class=sect1>
<DIV class=titlepage>
<DIV>
<DIV>
<H2 class=title style="CLEAR: both"><A 
name=queryhql-polymorphism></A>14.7.&nbsp;&#22810;&#24577;&#26597;&#35810;</H2></DIV></DIV>
<DIV></DIV></DIV>
<P>&#19968;&#20010;&#22914;&#19979;&#30340;&#26597;&#35810;&#35821;&#21477;: </P><PRE class=programlisting>from Cat as cat</PRE>
<P>&#19981;&#20165;&#36820;&#22238;<TT class=literal>Cat</TT>&#31867;&#30340;&#23454;&#20363;, &#20063;&#21516;&#26102;&#36820;&#22238;&#23376;&#31867; <TT 
class=literal>DomesticCat</TT>&#30340;&#23454;&#20363;. Hibernate &#21487;&#20197;&#22312;<TT 
class=literal>from</TT>&#23376;&#21477;&#20013;&#25351;&#23450;<SPAN class=emphasis><EM>&#20219;&#20309;</EM></SPAN> Java &#31867;&#25110;&#25509;&#21475;. 
&#26597;&#35810;&#20250;&#36820;&#22238;&#32487;&#25215;&#20102;&#35813;&#31867;&#30340;&#25152;&#26377;&#25345;&#20037;&#21270;&#23376;&#31867; &#30340;&#23454;&#20363;&#25110;&#36820;&#22238;&#22768;&#26126;&#20102;&#35813;&#25509;&#21475;&#30340;&#25152;&#26377;&#25345;&#20037;&#21270;&#31867;&#30340;&#23454;&#20363;&#12290;&#19979;&#38754;&#30340;&#26597;&#35810;&#35821;&#21477;&#36820;&#22238;&#25152;&#26377;&#30340;&#34987;&#25345;&#20037;&#21270;&#30340;&#23545;&#35937;&#65306; </P><PRE class=programlisting>from java.lang.Object o</PRE>
<P>&#25509;&#21475;<TT class=literal>Named</TT> &#21487;&#33021;&#34987;&#21508;&#31181;&#21508;&#26679;&#30340;&#25345;&#20037;&#21270;&#31867;&#22768;&#26126;&#65306; </P><PRE class=programlisting>from Named n, Named m where n.name = m.name</PRE>
<P>&#27880;&#24847;&#65292;&#26368;&#21518;&#30340;&#20004;&#20010;&#26597;&#35810;&#23558;&#38656;&#35201;&#36229;&#36807;&#19968;&#20010;&#30340;SQL <TT class=literal>SELECT</TT>.&#36825;&#34920;&#26126;<TT 
class=literal>order by</TT>&#23376;&#21477; &#27809;&#26377;&#23545;&#25972;&#20010;&#32467;&#26524;&#38598;&#36827;&#34892;&#27491;&#30830;&#30340;&#25490;&#24207;. (&#36825;&#20063;&#35828;&#26126;&#20320;&#19981;&#33021;&#23545;&#36825;&#26679;&#30340;&#26597;&#35810;&#20351;&#29992;<TT 
class=literal>Query.scroll()</TT>&#26041;&#27861;.) </P></DIV>
<DIV lang=zh-cn class=sect1>
<DIV class=titlepage>
<DIV>
<DIV>
<H2 class=title style="CLEAR: both"><A 
name=queryhql-where></A>14.8.&nbsp;where&#23376;&#21477;</H2></DIV></DIV>
<DIV></DIV></DIV>
<P><TT class=literal>where</TT>&#23376;&#21477;&#20801;&#35768;&#20320;&#23558;&#36820;&#22238;&#30340;&#23454;&#20363;&#21015;&#34920;&#30340;&#33539;&#22260;&#32553;&#23567;. &#22914;&#26524;&#27809;&#26377;&#25351;&#23450;&#21035;&#21517;&#65292;&#20320;&#21487;&#20197;&#20351;&#29992;&#23646;&#24615;&#21517;&#26469;&#30452;&#25509;&#24341;&#29992;&#23646;&#24615;: 
</P><PRE class=programlisting>from Cat where name='Fritz'</PRE>
<P>&#22914;&#26524;&#25351;&#27966;&#20102;&#21035;&#21517;&#65292;&#38656;&#35201;&#20351;&#29992;&#23436;&#25972;&#30340;&#23646;&#24615;&#21517;: </P><PRE class=programlisting>from Cat as cat where cat.name='Fritz'</PRE>
<P>&#36820;&#22238;&#21517;&#20026;&#65288;&#23646;&#24615;name&#31561;&#20110;&#65289;'Fritz'&#30340;<TT class=literal>Cat</TT>&#31867;&#30340;&#23454;&#20363;&#12290; </P><PRE class=programlisting>select foo 
from Foo foo, Bar bar
where foo.startDate = bar.date</PRE>
<P>&#23558;&#36820;&#22238;&#25152;&#26377;&#28385;&#36275;&#19979;&#38754;&#26465;&#20214;&#30340;<TT class=literal>Foo</TT>&#31867;&#30340;&#23454;&#20363;&#65306; &#23384;&#22312;&#22914;&#19979;&#30340;<TT 
class=literal>bar</TT>&#30340;&#19968;&#20010;&#23454;&#20363;&#65292;&#20854;<TT class=literal>date</TT>&#23646;&#24615;&#31561;&#20110; <TT 
class=literal>Foo</TT>&#30340;<TT class=literal>startDate</TT>&#23646;&#24615;&#12290; &#22797;&#21512;&#36335;&#24452;&#34920;&#36798;&#24335;&#20351;&#24471;<TT 
class=literal>where</TT>&#23376;&#21477;&#38750;&#24120;&#30340;&#24378;&#22823;&#65292;&#32771;&#34385;&#22914;&#19979;&#24773;&#20917;&#65306; </P><PRE class=programlisting>from Cat cat where cat.mate.name is not null</PRE>
<P>&#35813;&#26597;&#35810;&#23558;&#34987;&#32763;&#35793;&#25104;&#20026;&#19968;&#20010;&#21547;&#26377;&#34920;&#36830;&#25509;&#65288;&#20869;&#36830;&#25509;&#65289;&#30340;SQL&#26597;&#35810;&#12290;&#22914;&#26524;&#20320;&#25171;&#31639;&#20889;&#20687;&#36825;&#26679;&#30340;&#26597;&#35810;&#35821;&#21477; </P><PRE class=programlisting>from Foo foo  
where foo.bar.baz.customer.address.city is not null</PRE>
<P>&#22312;SQL&#20013;&#65292;&#20320;&#20026;&#36798;&#27492;&#30446;&#30340;&#23558;&#38656;&#35201;&#36827;&#34892;&#19968;&#20010;&#22235;&#34920;&#36830;&#25509;&#30340;&#26597;&#35810;&#12290; </P>
<P><TT class=literal>=</TT>&#36816;&#31639;&#31526;&#19981;&#20165;&#21487;&#20197;&#34987;&#29992;&#26469;&#27604;&#36739;&#23646;&#24615;&#30340;&#20540;&#65292;&#20063;&#21487;&#20197;&#29992;&#26469;&#27604;&#36739;&#23454;&#20363;&#65306; </P><PRE class=programlisting>from Cat cat, Cat rival where cat.mate = rival.mate</PRE><PRE class=programlisting>select cat, mate 
from Cat cat, Cat mate
where cat.mate = mate</PRE>
<P>&#29305;&#27530;&#23646;&#24615;&#65288;&#23567;&#20889;&#65289;<TT class=literal>id</TT>&#21487;&#20197;&#29992;&#26469;&#34920;&#31034;&#19968;&#20010;&#23545;&#35937;&#30340;&#21807;&#19968;&#30340;&#26631;&#35782;&#31526;&#12290;&#65288;&#20320;&#20063;&#21487;&#20197;&#20351;&#29992;&#35813;&#23545;&#35937;&#30340;&#23646;&#24615;&#21517;&#12290;&#65289; </P><PRE class=programlisting>from Cat as cat where cat.id = 123

from Cat as cat where cat.mate.id = 69</PRE>
<P>&#31532;&#20108;&#20010;&#26597;&#35810;&#26159;&#26377;&#25928;&#30340;&#12290;&#27492;&#26102;&#19981;&#38656;&#35201;&#36827;&#34892;&#34920;&#36830;&#25509;&#65281; </P>
<P>&#21516;&#26679;&#20063;&#21487;&#20197;&#20351;&#29992;&#22797;&#21512;&#26631;&#35782;&#31526;&#12290;&#27604;&#22914;<TT class=literal>Person</TT>&#31867;&#26377;&#19968;&#20010;&#22797;&#21512;&#26631;&#35782;&#31526;&#65292;&#23427;&#30001;<TT 
class=literal>country</TT>&#23646;&#24615; &#19982;<TT class=literal>medicareNumber</TT>&#23646;&#24615;&#32452;&#25104;&#12290; </P><PRE class=programlisting>from bank.Person person
where person.id.country = 'AU' 
    and person.id.medicareNumber = 123456</PRE><PRE class=programlisting>from bank.Account account
where account.owner.id.country = 'AU' 
    and account.owner.id.medicareNumber = 123456</PRE>
<P>&#31532;&#20108;&#20010;&#26597;&#35810;&#20063;&#19981;&#38656;&#35201;&#36827;&#34892;&#34920;&#36830;&#25509;&#12290; </P>
<P>&#21516;&#26679;&#30340;&#65292;&#29305;&#27530;&#23646;&#24615;<TT class=literal>class</TT>&#22312;&#36827;&#34892;&#22810;&#24577;&#25345;&#20037;&#21270;&#30340;&#24773;&#20917;&#19979;&#34987;&#29992;&#26469;&#23384;&#21462;&#19968;&#20010;&#23454;&#20363;&#30340;&#37492;&#21035;&#20540;&#65288;discriminator 
value&#65289;&#12290; &#19968;&#20010;&#23884;&#20837;&#21040;where&#23376;&#21477;&#20013;&#30340;Java&#31867;&#30340;&#21517;&#23383;&#23558;&#34987;&#36716;&#25442;&#20026;&#35813;&#31867;&#30340;&#37492;&#21035;&#20540;&#12290; </P><PRE class=programlisting>from Cat cat where cat.class = DomesticCat</PRE>
<P>&#20320;&#20063;&#21487;&#20197;&#22768;&#26126;&#19968;&#20010;&#23646;&#24615;&#30340;&#31867;&#22411;&#26159;&#32452;&#20214;&#25110;&#32773;&#22797;&#21512;&#29992;&#25143;&#31867;&#22411;&#65288;&#20197;&#21450;&#30001;&#32452;&#20214;&#26500;&#25104;&#30340;&#32452;&#20214;&#31561;&#31561;&#65289;&#12290;&#27704;&#36828;&#19981;&#35201;&#23581;&#35797;&#20351;&#29992;&#20197;&#32452;&#20214;&#31867;&#22411;&#26469;&#32467;&#23614;&#30340;&#36335;&#24452;&#34920;&#36798;&#24335;&#65288;path-expression&#65289; 
&#65288;&#19982;&#27492;&#30456;&#21453;&#65292;&#20320;&#24212;&#24403;&#20351;&#29992;&#32452;&#20214;&#30340;&#19968;&#20010;&#23646;&#24615;&#26469;&#32467;&#23614;&#65289;&#12290; &#20030;&#20363;&#26469;&#35828;&#65292;&#22914;&#26524;<TT class=literal>store.owner</TT>&#21547;&#26377;&#19968;&#20010;&#21253;&#21547;&#20102;&#32452;&#20214;&#30340;&#23454;&#20307;<TT 
class=literal>address</TT> </P><PRE class=programlisting>store.owner.address.city    // &#27491;&#30830;
store.owner.address         // &#38169;&#35823;!</PRE>
<P>&#19968;&#20010;“&#20219;&#24847;”&#31867;&#22411;&#26377;&#20004;&#20010;&#29305;&#27530;&#30340;&#23646;&#24615;<TT class=literal>id</TT>&#21644;<TT class=literal>class</TT>, 
&#26469;&#20801;&#35768;&#25105;&#20204;&#25353;&#29031;&#19979;&#38754;&#30340;&#26041;&#24335;&#34920;&#36798;&#19968;&#20010;&#36830;&#25509;&#65288;<TT class=literal>AuditLog.item</TT> &#26159;&#19968;&#20010;&#23646;&#24615;&#65292;&#35813;&#23646;&#24615;&#34987;&#26144;&#23556;&#20026;<TT 
class=literal>&lt;any&gt;</TT>&#65289;&#12290; </P><PRE class=programlisting>from AuditLog log, Payment payment 
where log.item.class = 'Payment' and log.item.id = payment.id</PRE>
<P>&#27880;&#24847;&#65292;&#22312;&#19978;&#38754;&#30340;&#26597;&#35810;&#19982;&#21477;&#20013;&#65292;<TT class=literal>log.item.class</TT> &#21644; <TT 
class=literal>payment.class</TT> &#23558;&#28041;&#21450;&#21040;&#23436;&#20840;&#19981;&#21516;&#30340;&#25968;&#25454;&#24211;&#20013;&#30340;&#21015;&#12290; </P></DIV>
<DIV lang=zh-cn class=sect1>
<DIV class=titlepage>
<DIV>
<DIV>
<H2 class=title style="CLEAR: both"><A 
name=queryhql-expressions></A>14.9.&nbsp;&#34920;&#36798;&#24335;</H2></DIV></DIV>
<DIV></DIV></DIV>
<P>&#22312;<TT class=literal>where</TT>&#23376;&#21477;&#20013;&#20801;&#35768;&#20351;&#29992;&#30340;&#34920;&#36798;&#24335;&#21253;&#25324; &#22823;&#22810;&#25968;&#20320;&#21487;&#20197;&#22312;SQL&#20351;&#29992;&#30340;&#34920;&#36798;&#24335;&#31181;&#31867;: </P>
<DIV class=itemizedlist>
<UL type=disc compact>
  <LI>
  <P>&#25968;&#23398;&#36816;&#31639;&#31526;<TT class=literal>+, -, *, /</TT> </P>
  <LI>
  <P>&#20108;&#36827;&#21046;&#27604;&#36739;&#36816;&#31639;&#31526;<TT class=literal>=, &gt;=, &lt;=, &lt;&gt;, !=, like</TT> </P>
  <LI>
  <P>&#36923;&#36753;&#36816;&#31639;&#31526;<TT class=literal>and, or, not</TT> </P>
  <LI>
  <P><TT class=literal>in</TT>, <TT class=literal>not in</TT>, <TT 
  class=literal>between</TT>, <TT class=literal>is null</TT>, <TT 
  class=literal>is not null</TT>, <TT class=literal>is empty</TT>, <TT 
  class=literal>is not empty</TT>, <TT class=literal>member of</TT> and <TT 
  class=literal>not member of</TT> </P>
  <LI>
  <P>"&#31616;&#21333;&#30340;" case, <TT class=literal>case ... when ... then ... else ... 
  end</TT>,&#21644; "&#25628;&#32034;" case, <TT class=literal>case when ... then ... else ... 
  end</TT> </P>
  <LI>
  <P>&#23383;&#31526;&#20018;&#36830;&#25509;&#31526;<TT class=literal>...||...</TT> or <TT 
  class=literal>concat(...,...)</TT> </P>
  <LI>
  <P><TT class=literal>current_date()</TT>, <TT 
  class=literal>current_time()</TT>, <TT class=literal>current_timestamp()</TT> 
  </P>
  <LI>
  <P><TT class=literal>second(...)</TT>, <TT class=literal>minute(...)</TT>, <TT 
  class=literal>hour(...)</TT>, <TT class=literal>day(...)</TT>, <TT 
  class=literal>month(...)</TT>, <TT class=literal>year(...)</TT>, </P>
  <LI>
  <P>EJB-QL 3.0&#23450;&#20041;&#30340;&#20219;&#20309;&#20989;&#25968;&#25110;&#25805;&#20316;&#65306;<TT class=literal>substring(), trim(), lower(), 
  upper(), length(), locate(), abs(), sqrt(), bit_length()&#65292; mod()</TT> </P>
  <LI>
  <P><TT class=literal>coalesce()</TT> &#21644; <TT class=literal>nullif()</TT> </P>
  <LI>
  <P><TT class=literal>str()</TT> &#25226;&#25968;&#23383;&#25110;&#32773;&#26102;&#38388;&#20540;&#36716;&#25442;&#20026;&#21487;&#35835;&#30340;&#23383;&#31526;&#20018; </P>
  <LI>
  <P><TT class=literal>cast(... as ...)</TT>, &#20854;&#31532;&#20108;&#20010;&#21442;&#25968;&#26159;&#26576;Hibernate&#31867;&#22411;&#30340;&#21517;&#23383;&#65292;&#20197;&#21450;<TT 
  class=literal>extract(... from ...)</TT>&#65292;&#21482;&#35201;ANSI <TT class=literal>cast()</TT> 
  &#21644; <TT class=literal>extract()</TT> &#34987;&#24213;&#23618;&#25968;&#25454;&#24211;&#25903;&#25345; </P>
  <LI>
  <P>HQL <TT class=literal>index()</TT> &#20989;&#25968;&#65292;&#20316;&#29992;&#20110;join&#30340;&#26377;&#24207;&#38598;&#21512;&#30340;&#21035;&#21517;&#12290; </P>
  <LI>
  <P>HQL&#20989;&#25968;&#65292;&#25226;&#38598;&#21512;&#20316;&#20026;&#21442;&#25968;:<TT class=literal>size(), minelement(), maxelement(), 
  minindex(), maxindex()</TT>,&#36824;&#26377;&#29305;&#21035;&#30340;<TT class=literal>elements()</TT> &#21644;<TT 
  class=literal>indices</TT>&#20989;&#25968;&#65292;&#21487;&#20197;&#19982;&#25968;&#37327;&#35789;&#21152;&#20197;&#38480;&#23450;&#65306;<TT class=literal>some, all, exists, 
  any, in</TT>&#12290; </P>
  <LI>
  <P>&#20219;&#20309;&#25968;&#25454;&#24211;&#25903;&#25345;&#30340;SQL&#26631;&#37327;&#20989;&#25968;&#65292;&#27604;&#22914;<TT class=literal>sign()</TT>, <TT 
  class=literal>trunc()</TT>, <TT class=literal>rtrim()</TT>, <TT 
  class=literal>sin()</TT> </P>
  <LI>
  <P>JDBC&#39118;&#26684;&#30340;&#21442;&#25968;&#20256;&#20837; <TT class=literal>?</TT> </P>
  <LI>
  <P>&#21629;&#21517;&#21442;&#25968;<TT class=literal>:name</TT>, <TT class=literal>:start_date</TT>, <TT 
  class=literal>:x1</TT> </P>
  <LI>
  <P>SQL &#30452;&#25509;&#24120;&#37327; <TT class=literal>'foo'</TT>, <TT class=literal>69</TT>, <TT 
  class=literal>6.66E+2</TT>, <TT class=literal>'1970-01-01 10:00:01.0'</TT> 
</P>
  <LI>
  <P>Java <TT class=literal>public static final</TT> &#31867;&#22411;&#30340;&#24120;&#37327; <TT 
  class=literal>eg.Color.TABBY</TT> </P></LI></UL></DIV>
<P>&#20851;&#38190;&#23383;<TT class=literal>in</TT>&#19982;<TT class=literal>between</TT>&#21487;&#25353;&#22914;&#19979;&#26041;&#27861;&#20351;&#29992;: </P><PRE class=programlisting>from DomesticCat cat where cat.name between 'A' and 'B'</PRE><PRE class=programlisting>from DomesticCat cat where cat.name in ( 'Foo', 'Bar', 'Baz' )</PRE>
<P>&#32780;&#19988;&#21542;&#23450;&#30340;&#26684;&#24335;&#20063;&#21487;&#20197;&#22914;&#19979;&#20070;&#20889;&#65306; </P><PRE class=programlisting>from DomesticCat cat where cat.name not between 'A' and 'B'</PRE><PRE class=programlisting>from DomesticCat cat where cat.name not in ( 'Foo', 'Bar', 'Baz' )</PRE>
<P>&#21516;&#26679;, &#23376;&#21477;<TT class=literal>is null</TT>&#19982;<TT class=literal>is not 
null</TT>&#21487;&#20197;&#34987;&#29992;&#26469;&#27979;&#35797;&#31354;&#20540;(null). </P>
<P>&#22312;Hibernate&#37197;&#32622;&#25991;&#20214;&#20013;&#22768;&#26126;HQL“&#26597;&#35810;&#26367;&#20195;&#65288;query substitutions&#65289;”&#20043;&#21518;&#65292; 
&#24067;&#23572;&#34920;&#36798;&#24335;&#65288;Booleans&#65289;&#21487;&#20197;&#22312;&#20854;&#20182;&#34920;&#36798;&#24335;&#20013;&#36731;&#26494;&#30340;&#20351;&#29992;: </P><PRE class=programlisting>&lt;property name="hibernate.query.substitutions"&gt;true 1, false 0&lt;/property&gt;</PRE>
<P>&#31995;&#32479;&#23558;&#35813;HQL&#36716;&#25442;&#20026;SQL&#35821;&#21477;&#26102;&#65292;&#35813;&#35774;&#32622;&#34920;&#26126;&#23558;&#29992;&#23383;&#31526; <TT class=literal>1</TT> &#21644; <TT 
class=literal>0</TT> &#26469; &#21462;&#20195;&#20851;&#38190;&#23383;<TT class=literal>true</TT> &#21644; <TT 
class=literal>false</TT>: </P><PRE class=programlisting>from Cat cat where cat.alive = true</PRE>
<P>&#20320;&#21487;&#20197;&#29992;&#29305;&#27530;&#23646;&#24615;<TT class=literal>size</TT>, &#25110;&#26159;&#29305;&#27530;&#20989;&#25968;<TT 
class=literal>size()</TT>&#27979;&#35797;&#19968;&#20010;&#38598;&#21512;&#30340;&#22823;&#23567;&#12290; </P><PRE class=programlisting>from Cat cat where cat.kittens.size &gt; 0</PRE><PRE class=programlisting>from Cat cat where size(cat.kittens) &gt; 0</PRE>
<P>&#23545;&#20110;&#32034;&#24341;&#20102;&#65288;&#26377;&#24207;&#65289;&#30340;&#38598;&#21512;&#65292;&#20320;&#21487;&#20197;&#20351;&#29992;<TT class=literal>minindex</TT> &#19982; <TT 
class=literal>maxindex</TT>&#20989;&#25968;&#26469;&#24341;&#29992;&#21040;&#26368;&#23567;&#19982;&#26368;&#22823;&#30340;&#32034;&#24341;&#24207;&#25968;&#12290; &#21516;&#29702;&#65292;&#20320;&#21487;&#20197;&#20351;&#29992;<TT 
class=literal>minelement</TT> &#19982; <TT class=literal>maxelement</TT>&#20989;&#25968;&#26469; 
&#24341;&#29992;&#21040;&#19968;&#20010;&#22522;&#26412;&#25968;&#25454;&#31867;&#22411;&#30340;&#38598;&#21512;&#20013;&#26368;&#23567;&#19982;&#26368;&#22823;&#30340;&#20803;&#32032;&#12290; </P><PRE class=programlisting>from Calendar cal where maxelement(cal.holidays) &gt; current_date</PRE><PRE class=programlisting>from Order order where maxindex(order.items) &gt; 100</PRE><PRE class=programlisting>from Order order where minelement(order.items) &gt; 10000</PRE>
<P>&#22312;&#20256;&#36882;&#19968;&#20010;&#38598;&#21512;&#30340;&#32034;&#24341;&#38598;&#25110;&#32773;&#26159;&#20803;&#32032;&#38598;(<TT class=literal>elements</TT>&#19982;<TT 
class=literal>indices</TT> &#20989;&#25968;) &#25110;&#32773;&#20256;&#36882;&#19968;&#20010;&#23376;&#26597;&#35810;&#30340;&#32467;&#26524;&#30340;&#26102;&#20505;&#65292;&#21487;&#20197;&#20351;&#29992;SQL&#20989;&#25968;<TT class=literal>any, 
some, all, exists, in</TT> </P><PRE class=programlisting>select mother from Cat as mother, Cat as kit
where kit in elements(foo.kittens)</PRE><PRE class=programlisting>select p from NameList list, Person p
where p.name = some elements(list.names)</PRE><PRE class=programlisting>from Cat cat where exists elements(cat.kittens)</PRE><PRE class=programlisting>from Player p where 3 &gt; all elements(p.scores)</PRE><PRE class=programlisting>from Show show where 'fizard' in indices(show.acts)</PRE>
<P>&#27880;&#24847;&#65292;&#22312;Hibernate3&#31181;&#65292;&#36825;&#20123;&#32467;&#26500;&#21464;&#37327;- <TT class=literal>size</TT>, <TT 
class=literal>elements</TT>, <TT class=literal>indices</TT>, <TT 
class=literal>minindex</TT>, <TT class=literal>maxindex</TT>, <TT 
class=literal>minelement</TT>, <TT class=literal>maxelement</TT> - 
&#21482;&#33021;&#22312;where&#23376;&#21477;&#20013;&#20351;&#29992;&#12290; </P>
<P>&#19968;&#20010;&#34987;&#32034;&#24341;&#36807;&#30340;&#65288;&#26377;&#24207;&#30340;&#65289;&#38598;&#21512;&#30340;&#20803;&#32032;(arrays, lists, maps)&#21487;&#20197;&#22312;&#20854;&#20182;&#32034;&#24341;&#20013;&#34987;&#24341;&#29992;&#65288;&#21482;&#33021;&#22312;where&#23376;&#21477;&#20013;&#65289;&#65306; </P><PRE class=programlisting>from Order order where order.items[0].id = 1234</PRE><PRE class=programlisting>select person from Person person, Calendar calendar
where calendar.holidays['national day'] = person.birthDay
    and person.nationality.calendar = calendar</PRE><PRE class=programlisting>select item from Item item, Order order
where order.items[ order.deliveredItemIndices[0] ] = item and order.id = 11</PRE><PRE class=programlisting>select item from Item item, Order order
where order.items[ maxindex(order.items) ] = item and order.id = 11</PRE>
<P>&#22312;<TT class=literal>[]</TT>&#20013;&#30340;&#34920;&#36798;&#24335;&#29978;&#33267;&#21487;&#20197;&#26159;&#19968;&#20010;&#31639;&#25968;&#34920;&#36798;&#24335;&#12290; </P><PRE class=programlisting>select item from Item item, Order order
where order.items[ size(order.items) - 1 ] = item</PRE>
<P>&#23545;&#20110;&#19968;&#20010;&#19968;&#23545;&#22810;&#30340;&#20851;&#32852;&#65288;one-to-many association&#65289;&#25110;&#26159;&#20540;&#30340;&#38598;&#21512;&#20013;&#30340;&#20803;&#32032;&#65292; HQL&#20063;&#25552;&#20379;&#20869;&#24314;&#30340;<TT 
class=literal>index()</TT>&#20989;&#25968;&#65292; </P><PRE class=programlisting>select item, index(item) from Order order 
    join order.items item
where index(item) &lt; 5</PRE>
<P>&#22914;&#26524;&#24213;&#23618;&#25968;&#25454;&#24211;&#25903;&#25345;&#26631;&#37327;&#30340;SQL&#20989;&#25968;&#65292;&#23427;&#20204;&#20063;&#21487;&#20197;&#34987;&#20351;&#29992; </P><PRE class=programlisting>from DomesticCat cat where upper(cat.name) like 'FRI%'</PRE>
<P>&#22914;&#26524;&#20320;&#36824;&#19981;&#33021;&#23545;&#25152;&#26377;&#30340;&#36825;&#20123;&#28145;&#20449;&#19981;&#30097;&#65292;&#24819;&#24819;&#19979;&#38754;&#30340;&#26597;&#35810;&#12290;&#22914;&#26524;&#20351;&#29992;SQL&#65292;&#35821;&#21477;&#38271;&#24230;&#20250;&#22686;&#38271;&#22810;&#23569;&#65292;&#21487;&#35835;&#24615;&#20250;&#19979;&#38477;&#22810;&#23569;&#65306; </P><PRE class=programlisting>select cust
from Product prod,
    Store store
    inner join store.customers cust
where prod.name = 'widget'
    and store.location.name in ( 'Melbourne', 'Sydney' )
    and prod = all elements(cust.currentOrder.lineItems)</PRE>
<P><SPAN class=emphasis><EM>&#25552;&#31034;:</EM></SPAN> &#20250;&#20687;&#22914;&#19979;&#30340;&#35821;&#21477; </P><PRE class=programlisting>SELECT cust.name, cust.address, cust.phone, cust.id, cust.current_order
FROM customers cust,
    stores store,
    locations loc,
    store_customers sc,
    product prod
WHERE prod.name = 'widget'
    AND store.loc_id = loc.id
    AND loc.name IN ( 'Melbourne', 'Sydney' )
    AND sc.store_id = store.id
    AND sc.cust_id = cust.id
    AND prod.id = ALL(
        SELECT item.prod_id
        FROM line_items item, orders o
        WHERE item.order_id = o.id
            AND cust.current_order = o.id
    )</PRE></DIV>
<DIV lang=zh-cn class=sect1>
<DIV class=titlepage>
<DIV>
<DIV>
<H2 class=title style="CLEAR: both"><A 
name=queryhql-ordering></A>14.10.&nbsp;order by&#23376;&#21477;</H2></DIV></DIV>
<DIV></DIV></DIV>
<P>&#26597;&#35810;&#36820;&#22238;&#30340;&#21015;&#34920;(list)&#21487;&#20197;&#25353;&#29031;&#19968;&#20010;&#36820;&#22238;&#30340;&#31867;&#25110;&#32452;&#20214;&#65288;components)&#20013;&#30340;&#20219;&#20309;&#23646;&#24615;&#65288;property&#65289;&#36827;&#34892;&#25490;&#24207;&#65306; </P><PRE class=programlisting>from DomesticCat cat
order by cat.name asc, cat.weight desc, cat.birthdate</PRE>
<P>&#21487;&#36873;&#30340;<TT class=literal>asc</TT>&#25110;<TT class=literal>desc</TT>&#20851;&#38190;&#23383;&#25351;&#26126;&#20102;&#25353;&#29031;&#21319;&#24207;&#25110;&#38477;&#24207;&#36827;&#34892;&#25490;&#24207;. 
</P></DIV>
<DIV lang=zh-cn class=sect1>
<DIV class=titlepage>
<DIV>
<DIV>
<H2 class=title style="CLEAR: both"><A 
name=queryhql-grouping></A>14.11.&nbsp;group by&#23376;&#21477;</H2></DIV></DIV>
<DIV></DIV></DIV>
<P>&#19968;&#20010;&#36820;&#22238;&#32858;&#38598;&#20540;(aggregate values)&#30340;&#26597;&#35810;&#21487;&#20197;&#25353;&#29031;&#19968;&#20010;&#36820;&#22238;&#30340;&#31867;&#25110;&#32452;&#20214;&#65288;components)&#20013;&#30340;&#20219;&#20309;&#23646;&#24615;&#65288;property&#65289;&#36827;&#34892;&#20998;&#32452;&#65306; 
</P><PRE class=programlisting>select cat.color, sum(cat.weight), count(cat) 
from Cat cat
group by cat.color</PRE><PRE class=programlisting>select foo.id, avg(name), max(name) 
from Foo foo join foo.names name
group by foo.id</PRE>
<P><TT class=literal>having</TT>&#23376;&#21477;&#22312;&#36825;&#37324;&#20063;&#20801;&#35768;&#20351;&#29992;. </P><PRE class=programlisting>select cat.color, sum(cat.weight), count(cat) 
from Cat cat
group by cat.color 
having cat.color in (eg.Color.TABBY, eg.Color.BLACK)</PRE>
<P>&#22914;&#26524;&#24213;&#23618;&#30340;&#25968;&#25454;&#24211;&#25903;&#25345;&#30340;&#35805;(&#20363;&#22914;&#19981;&#33021;&#22312;MySQL&#20013;&#20351;&#29992;)&#65292;SQL&#30340;&#19968;&#33324;&#20989;&#25968;&#19982;&#32858;&#38598;&#20989;&#25968;&#20063;&#21487;&#20197;&#20986;&#29616; &#22312;<TT 
class=literal>having</TT>&#19982;<TT class=literal>order by</TT> &#23376;&#21477;&#20013;&#12290; </P><PRE class=programlisting>select cat
from Cat cat
    join cat.kittens kitten
group by cat
having avg(kitten.weight) &gt; 100
order by count(kitten) asc, sum(kitten.weight) desc</PRE>
<P>&#27880;&#24847;<TT class=literal>group by</TT>&#23376;&#21477;&#19982; <TT class=literal>order 
by</TT>&#23376;&#21477;&#20013;&#37117;&#19981;&#33021;&#21253;&#21547;&#31639;&#26415;&#34920;&#36798;&#24335;&#65288;arithmetic expressions&#65289;. </P></DIV>
<DIV lang=zh-cn class=sect1>
<DIV class=titlepage>
<DIV>
<DIV>
<H2 class=title style="CLEAR: both"><A 
name=queryhql-subqueries></A>14.12.&nbsp;&#23376;&#26597;&#35810;</H2></DIV></DIV>
<DIV></DIV></DIV>
<P>&#23545;&#20110;&#25903;&#25345;&#23376;&#26597;&#35810;&#30340;&#25968;&#25454;&#24211;&#65292;Hibernate&#25903;&#25345;&#22312;&#26597;&#35810;&#20013;&#20351;&#29992;&#23376;&#26597;&#35810;&#12290;&#19968;&#20010;&#23376;&#26597;&#35810;&#24517;&#39035;&#34987;&#22278;&#25324;&#21495;&#21253;&#22260;&#36215;&#26469;&#65288;&#32463;&#24120;&#26159;SQL&#32858;&#38598;&#20989;&#25968;&#30340;&#22278;&#25324;&#21495;&#65289;&#12290; 
&#29978;&#33267;&#30456;&#20114;&#20851;&#32852;&#30340;&#23376;&#26597;&#35810;&#65288;&#24341;&#29992;&#21040;&#22806;&#37096;&#26597;&#35810;&#20013;&#30340;&#21035;&#21517;&#30340;&#23376;&#26597;&#35810;&#65289;&#20063;&#26159;&#20801;&#35768;&#30340;&#12290; </P><PRE class=programlisting>from Cat as fatcat 
where fatcat.weight &gt; ( 
    select avg(cat.weight) from DomesticCat cat 
)</PRE><PRE class=programlisting>from DomesticCat as cat 
where cat.name = some ( 
    select name.nickName from Name as name 
)</PRE><PRE class=programlisting>from Cat as cat 
where not exists ( 
    from Cat as mate where mate.mate = cat 
)</PRE><PRE class=programlisting>from DomesticCat as cat 
where cat.name not in ( 
    select name.nickName from Name as name 
)</PRE><PRE class=programlisting>select cat.id, (select max(kit.weight) from cat.kitten kit) 
from Cat as cat</PRE>
<P>&#27880;&#24847;&#65292;HQL&#33258;&#26597;&#35810;&#21482;&#21487;&#20197;&#22312;select&#25110;&#32773;where&#23376;&#21477;&#20013;&#20986;&#29616;&#12290; </P>
<P>&#22312;select&#21015;&#34920;&#20013;&#21253;&#21547;&#19968;&#20010;&#34920;&#36798;&#24335;&#20197;&#19978;&#30340;&#23376;&#26597;&#35810;&#65292;&#20320;&#21487;&#20197;&#20351;&#29992;&#19968;&#20010;&#20803;&#32452;&#26500;&#36896;&#31526;&#65288;tuple constructors&#65289;&#65306; </P><PRE class=programlisting>from Cat as cat 
where not ( cat.name, cat.color ) in ( 
    select cat.name, cat.color from DomesticCat cat 
)</PRE>
<P>&#27880;&#24847;&#22312;&#26576;&#20123;&#25968;&#25454;&#24211;&#20013;&#65288;&#19981;&#21253;&#25324;Oracle&#19982;HSQL&#65289;&#65292;&#20320;&#20063;&#21487;&#20197;&#22312;&#20854;&#20182;&#35821;&#22659;&#20013;&#20351;&#29992;&#20803;&#32452;&#26500;&#36896;&#31526;&#65292; &#27604;&#22914;&#26597;&#35810;&#29992;&#25143;&#31867;&#22411;&#30340;&#32452;&#20214;&#19982;&#32452;&#21512;&#65306; </P><PRE class=programlisting>from Person where name = ('Gavin', 'A', 'King')</PRE>
<P>&#35813;&#26597;&#35810;&#31561;&#20215;&#20110;&#26356;&#22797;&#26434;&#30340;&#65306; </P><PRE class=programlisting>from Person where name.first = 'Gavin' and name.initial = 'A' and name.last = 'King')</PRE>
<P>&#26377;&#20004;&#20010;&#24456;&#22909;&#30340;&#29702;&#30001;&#20351;&#20320;&#19981;&#24212;&#24403;&#20316;&#36825;&#26679;&#30340;&#20107;&#24773;&#65306;&#39318;&#20808;&#65292;&#23427;&#19981;&#23436;&#20840;&#36866;&#29992;&#20110;&#21508;&#20010;&#25968;&#25454;&#24211;&#24179;&#21488;&#65307;&#20854;&#27425;&#65292;&#26597;&#35810;&#29616;&#22312;&#20381;&#36182;&#20110;&#26144;&#23556;&#25991;&#20214;&#20013;&#23646;&#24615;&#30340;&#39034;&#24207;&#12290; </P></DIV>
<DIV lang=zh-cn class=sect1>
<DIV class=titlepage>
<DIV>
<DIV>
<H2 class=title style="CLEAR: both"><A 
name=queryhql-examples></A>14.13.&nbsp;HQL&#31034;&#20363;</H2></DIV></DIV>
<DIV></DIV></DIV>
<P>Hibernate&#26597;&#35810;&#21487;&#20197;&#38750;&#24120;&#30340;&#24378;&#22823;&#19982;&#22797;&#26434;&#12290;&#23454;&#38469;&#19978;&#65292;Hibernate&#30340;&#19968;&#20010;&#20027;&#35201;&#21334;&#28857;&#23601;&#26159;&#26597;&#35810;&#35821;&#21477;&#30340;&#23041;&#21147;&#12290;&#36825;&#37324;&#26377;&#19968;&#20123;&#20363;&#23376;&#65292;&#23427;&#20204;&#19982;&#25105;&#22312;&#26368;&#36817;&#30340; 
&#19968;&#20010;&#39033;&#30446;&#20013;&#20351;&#29992;&#30340;&#26597;&#35810;&#38750;&#24120;&#30456;&#20284;&#12290;&#27880;&#24847;&#20320;&#33021;&#29992;&#21040;&#30340;&#22823;&#22810;&#25968;&#26597;&#35810;&#27604;&#36825;&#20123;&#35201;&#31616;&#21333;&#30340;&#22810;&#65281; </P>
<P>&#19979;&#38754;&#30340;&#26597;&#35810;&#23545;&#20110;&#26576;&#20010;&#29305;&#23450;&#30340;&#23458;&#25143;&#30340;&#25152;&#26377;&#26410;&#25903;&#20184;&#30340;&#36134;&#21333;&#65292;&#22312;&#32473;&#23450;&#32473;&#26368;&#23567;&#24635;&#20215;&#20540;&#30340;&#24773;&#20917;&#19979;&#65292;&#36820;&#22238;&#35746;&#21333;&#30340;id&#65292;&#26465;&#30446;&#30340;&#25968;&#37327;&#21644;&#24635;&#20215;&#20540;&#65292; 
&#36820;&#22238;&#20540;&#25353;&#29031;&#24635;&#20215;&#20540;&#30340;&#32467;&#26524;&#36827;&#34892;&#25490;&#24207;&#12290;&#20026;&#20102;&#20915;&#23450;&#20215;&#26684;&#65292;&#26597;&#35810;&#20351;&#29992;&#20102;&#24403;&#21069;&#30446;&#24405;&#12290;&#20316;&#20026;&#36716;&#25442;&#32467;&#26524;&#30340;SQL&#26597;&#35810;&#65292;&#20351;&#29992;&#20102;<TT class=literal>ORDER</TT>, 
<TT class=literal>ORDER_LINE</TT>, <TT class=literal>PRODUCT</TT>, <TT 
class=literal>CATALOG</TT> &#21644;<TT class=literal>PRICE</TT> &#24211;&#34920;&#12290; </P><PRE class=programlisting>select order.id, sum(price.amount), count(item)
from Order as order
    join order.lineItems as item
    join item.product as product,
    Catalog as catalog
    join catalog.prices as price
where order.paid = false
    and order.customer = :customer
    and price.product = product
    and catalog.effectiveDate &lt; sysdate
    and catalog.effectiveDate &gt;= all (
        select cat.effectiveDate 
        from Catalog as cat
        where cat.effectiveDate &lt; sysdate
    )
group by order
having sum(price.amount) &gt; :minAmount
order by sum(price.amount) desc</PRE>
<P>&#36825;&#31616;&#30452;&#26159;&#19968;&#20010;&#24618;&#29289;&#65281;&#23454;&#38469;&#19978;&#65292;&#22312;&#29616;&#23454;&#29983;&#27963;&#20013;&#65292;&#25105;&#24182;&#19981;&#28909;&#34935;&#20110;&#23376;&#26597;&#35810;&#65292;&#25152;&#20197;&#25105;&#30340;&#26597;&#35810;&#35821;&#21477;&#30475;&#36215;&#26469;&#26356;&#20687;&#36825;&#20010;&#65306; </P><PRE class=programlisting>select order.id, sum(price.amount), count(item)
from Order as order
    join order.lineItems as item
    join item.product as product,
    Catalog as catalog
    join catalog.prices as price
where order.paid = false
    and order.customer = :customer
    and price.product = product
    and catalog = :currentCatalog
group by order
having sum(price.amount) &gt; :minAmount
order by sum(price.amount) desc</PRE>
<P>&#19979;&#38754;&#19968;&#20010;&#26597;&#35810;&#35745;&#31639;&#27599;&#19968;&#31181;&#29366;&#24577;&#19979;&#30340;&#25903;&#20184;&#30340;&#25968;&#30446;&#65292;&#38500;&#21435;&#25152;&#26377;&#22788;&#20110;<TT 
class=literal>AWAITING_APPROVAL</TT>&#29366;&#24577;&#30340;&#25903;&#20184;&#65292;&#22240;&#20026;&#22312;&#35813;&#29366;&#24577;&#19979; 
&#24403;&#21069;&#30340;&#29992;&#25143;&#20316;&#20986;&#20102;&#29366;&#24577;&#30340;&#26368;&#26032;&#25913;&#21464;&#12290;&#35813;&#26597;&#35810;&#34987;&#36716;&#25442;&#25104;&#21547;&#26377;&#20004;&#20010;&#20869;&#36830;&#25509;&#20197;&#21450;&#19968;&#20010;&#30456;&#20851;&#32852;&#30340;&#23376;&#36873;&#25321;&#30340;SQL&#26597;&#35810;&#65292;&#35813;&#26597;&#35810;&#20351;&#29992;&#20102;&#34920; <TT 
class=literal>PAYMENT</TT>, <TT class=literal>PAYMENT_STATUS</TT> &#20197;&#21450; <TT 
class=literal>PAYMENT_STATUS_CHANGE</TT>&#12290; </P><PRE class=programlisting>select count(payment), status.name 
from Payment as payment 
    join payment.currentStatus as status
    join payment.statusChanges as statusChange
where payment.status.name &lt;&gt; PaymentStatus.AWAITING_APPROVAL
    or (
        statusChange.timeStamp = ( 
            select max(change.timeStamp) 
            from PaymentStatusChange change 
            where change.payment = payment
        )
        and statusChange.user &lt;&gt; :currentUser
    )
group by status.name, status.sortOrder
order by status.sortOrder</PRE>
<P>&#22914;&#26524;&#25105;&#25226;<TT class=literal>statusChanges</TT>&#23454;&#20363;&#38598;&#26144;&#23556;&#20026;&#19968;&#20010;&#21015;&#34920;&#65288;list&#65289;&#32780;&#19981;&#26159;&#19968;&#20010;&#38598;&#21512;&#65288;set&#65289;, 
&#20070;&#20889;&#26597;&#35810;&#35821;&#21477;&#23558;&#26356;&#21152;&#31616;&#21333;. </P><PRE class=programlisting>select count(payment), status.name 
from Payment as payment
    join payment.currentStatus as status
where payment.status.name &lt;&gt; PaymentStatus.AWAITING_APPROVAL
    or payment.statusChanges[ maxIndex(payment.statusChanges) ].user &lt;&gt; :currentUser
group by status.name, status.sortOrder
order by status.sortOrder</PRE>
<P>&#19979;&#38754;&#19968;&#20010;&#26597;&#35810;&#20351;&#29992;&#20102;MS SQL Server&#30340; <TT 
class=literal>isNull()</TT>&#20989;&#25968;&#29992;&#20197;&#36820;&#22238;&#24403;&#21069;&#29992;&#25143;&#25152;&#23646;&#32452;&#32455;&#30340;&#32452;&#32455;&#24080;&#21495;&#21450;&#32452;&#32455;&#26410;&#25903;&#20184;&#30340;&#36134;&#12290; &#23427;&#34987;&#36716;&#25442;&#25104;&#19968;&#20010;&#23545;&#34920;<TT 
class=literal>ACCOUNT</TT>, <TT class=literal>PAYMENT</TT>, <TT 
class=literal>PAYMENT_STATUS</TT>, <TT class=literal>ACCOUNT_TYPE</TT>, <TT 
class=literal>ORGANIZATION</TT> &#20197;&#21450; <TT class=literal>ORG_USER</TT>&#36827;&#34892;&#30340;&#19977;&#20010;&#20869;&#36830;&#25509;&#65292; 
&#19968;&#20010;&#22806;&#36830;&#25509;&#21644;&#19968;&#20010;&#23376;&#36873;&#25321;&#30340;SQL&#26597;&#35810;&#12290; </P><PRE class=programlisting>select account, payment
from Account as account
    left outer join account.payments as payment
where :currentUser in elements(account.holder.users)
    and PaymentStatus.UNPAID = isNull(payment.currentStatus.name, PaymentStatus.UNPAID)
order by account.type.sortOrder, account.accountNumber, payment.dueDate</PRE>
<P>&#23545;&#20110;&#19968;&#20123;&#25968;&#25454;&#24211;&#65292;&#25105;&#20204;&#38656;&#35201;&#24323;&#29992;&#65288;&#30456;&#20851;&#30340;&#65289;&#23376;&#36873;&#25321;&#12290; </P><PRE class=programlisting>select account, payment
from Account as account
    join account.holder.users as user
    left outer join account.payments as payment
where :currentUser = user
    and PaymentStatus.UNPAID = isNull(payment.currentStatus.name, PaymentStatus.UNPAID)
order by account.type.sortOrder, account.accountNumber, payment.dueDate</PRE></DIV>
<DIV lang=zh-cn class=sect1>
<DIV class=titlepage>
<DIV>
<DIV>
<H2 class=title style="CLEAR: both"><A 
name=queryhql-bulk></A>14.14.&nbsp;&#25209;&#37327;&#30340;UPDATE&#21644;DELETE</H2></DIV></DIV>
<DIV></DIV></DIV>
<P>HQL&#29616;&#22312;&#25903;&#25345; <TT class=literal>update</TT>, <TT class=literal>delete</TT> &#21644; <TT 
class=literal>insert ... select ...</TT>&#35821;&#21477;. &#26597;&#38405; <A 
title="13.4.&nbsp;DML(&#25968;&#25454;&#25805;&#20316;&#35821;&#35328;)&#39118;&#26684;&#30340;&#25805;&#20316;(DML-style operations)" 
href="batch.html#batch-direct">&#31532;&nbsp;13.4&nbsp;&#33410; “DML(&#25968;&#25454;&#25805;&#20316;&#35821;&#35328;)&#39118;&#26684;&#30340;&#25805;&#20316;(DML-style 
operations)”</A> &#20197;&#33719;&#24471;&#26356;&#22810;&#20449;&#24687;&#12290; </P></DIV>
<DIV lang=zh-cn class=sect1>
<DIV class=titlepage>
<DIV>
<DIV>
<H2 class=title style="CLEAR: both"><A 
name=queryhql-tipstricks></A>14.15.&nbsp;&#23567;&#25216;&#24039; &amp; &#23567;&#31373;&#38376;</H2></DIV></DIV>
<DIV></DIV></DIV>
<P>&#20320;&#21487;&#20197;&#32479;&#35745;&#26597;&#35810;&#32467;&#26524;&#30340;&#25968;&#30446;&#32780;&#19981;&#24517;&#23454;&#38469;&#30340;&#36820;&#22238;&#20182;&#20204;&#65306; </P><PRE class=programlisting>( (Integer) session.iterate("select count(*) from ....").next() ).intValue()</PRE>
<P>&#33509;&#24819;&#26681;&#25454;&#19968;&#20010;&#38598;&#21512;&#30340;&#22823;&#23567;&#26469;&#36827;&#34892;&#25490;&#24207;&#65292;&#21487;&#20197;&#20351;&#29992;&#22914;&#19979;&#30340;&#35821;&#21477;&#65306; </P><PRE class=programlisting>select usr.id, usr.name
from User as usr 
    left join usr.messages as msg
group by usr.id, usr.name
order by count(msg)</PRE>
<P>&#22914;&#26524;&#20320;&#30340;&#25968;&#25454;&#24211;&#25903;&#25345;&#23376;&#36873;&#25321;&#65292;&#20320;&#21487;&#20197;&#22312;&#20320;&#30340;&#26597;&#35810;&#30340;where&#23376;&#21477;&#20013;&#20026;&#36873;&#25321;&#30340;&#22823;&#23567;&#65288;selection size&#65289;&#25351;&#23450;&#19968;&#20010;&#26465;&#20214;: </P><PRE class=programlisting>from User usr where size(usr.messages) &gt;= 1</PRE>
<P>&#22914;&#26524;&#20320;&#30340;&#25968;&#25454;&#24211;&#19981;&#25903;&#25345;&#23376;&#36873;&#25321;&#35821;&#21477;&#65292;&#20351;&#29992;&#19979;&#38754;&#30340;&#26597;&#35810;&#65306; </P><PRE class=programlisting>select usr.id, usr.name
from User usr.name
    join usr.messages msg
group by usr.id, usr.name
having count(msg) &gt;= 1</PRE>
<P>&#22240;&#20026;&#20869;&#36830;&#25509;&#65288;inner join&#65289;&#30340;&#21407;&#22240;&#65292;&#36825;&#20010;&#35299;&#20915;&#26041;&#26696;&#19981;&#33021;&#36820;&#22238;&#21547;&#26377;&#38646;&#20010;&#20449;&#24687;&#30340;<TT class=literal>User</TT> &#31867;&#30340;&#23454;&#20363;, 
&#25152;&#20197;&#36825;&#31181;&#24773;&#20917;&#19979;&#20351;&#29992;&#19979;&#38754;&#30340;&#26684;&#24335;&#23558;&#26159;&#26377;&#24110;&#21161;&#30340;: </P><PRE class=programlisting>select usr.id, usr.name
from User as usr
    left join usr.messages as msg
group by usr.id, usr.name
having count(msg) = 0</PRE>
<P>JavaBean&#30340;&#23646;&#24615;&#21487;&#20197;&#34987;&#32465;&#23450;&#21040;&#19968;&#20010;&#21629;&#21517;&#26597;&#35810;&#65288;named query&#65289;&#30340;&#21442;&#25968;&#19978;&#65306; </P><PRE class=programlisting>Query q = s.createQuery("from foo Foo as foo where foo.name=:name and foo.size=:size");
q.setProperties(fooBean); // fooBean&#21253;&#21547;&#26041;&#27861;getName()&#19982;getSize()
List foos = q.list();</PRE>
<P>&#36890;&#36807;&#23558;&#25509;&#21475;<TT class=literal>Query</TT>&#19982;&#19968;&#20010;&#36807;&#28388;&#22120;&#65288;filter&#65289;&#19968;&#36215;&#20351;&#29992;&#65292;&#38598;&#21512;&#65288;Collections&#65289;&#26159;&#21487;&#20197;&#20998;&#39029;&#30340;&#65306; 
</P><PRE class=programlisting>Query q = s.createFilter( collection, "" ); // &#19968;&#20010;&#31616;&#21333;&#30340;&#36807;&#28388;&#22120;
q.setMaxResults(PAGE_SIZE);
q.setFirstResult(PAGE_SIZE * pageNumber);
List page = q.list();</PRE>
<P>&#36890;&#36807;&#20351;&#29992;&#26597;&#35810;&#36807;&#28388;&#22120;&#65288;query filter&#65289;&#21487;&#20197;&#23558;&#38598;&#21512;&#65288;Collection&#65289;&#30340;&#21407;&#32032;&#20998;&#32452;&#25110;&#25490;&#24207;: </P><PRE class=programlisting>Collection orderedCollection = s.filter( collection, "order by this.amount" );
Collection counts = s.filter( collection, "select this.type, count(this) group by this.type" );</PRE>
<P>&#19981;&#29992;&#36890;&#36807;&#21021;&#22987;&#21270;&#65292;&#20320;&#23601;&#21487;&#20197;&#30693;&#36947;&#19968;&#20010;&#38598;&#21512;&#65288;Collection&#65289;&#30340;&#22823;&#23567;&#65306; </P><PRE class=programlisting>( (Integer) session.iterate("select count(*) from ....").next() ).intValue();</PRE></DIV></DIV>
<DIV class=navfooter>
<HR>

<TABLE width="100%" summary="Navigation footer">
  <TBODY>
  <TR>
    <TD width="40%" align=left><A accessKey=p 
    href="batch.html">&#19978;&#19968;&#39029;</A>&nbsp;</TD>
    <TD width="20%" align=center><A accessKey=u href="index.html">&#19978;&#19968;&#32423;</A></TD>
    <TD width="40%" align=right>&nbsp;<A accessKey=n 
      href="querycriteria.html">&#19979;&#19968;&#39029;</A></TD></TR>
  <TR>
    <TD vAlign=top width="40%" align=left>&#31532;&nbsp;13&nbsp;&#31456;&nbsp;&#25209;&#37327;&#22788;&#29702;&#65288;Batch 
      processing&#65289;&nbsp;</TD>
    <TD width="20%" align=center><A accessKey=h href="index.html">&#36215;&#22987;&#39029;</A></TD>
    <TD vAlign=top width="40%" align=right>&nbsp;&#31532;&nbsp;15&nbsp;&#31456;&nbsp; 
      &#26465;&#20214;&#26597;&#35810;(Criteria Queries) </TD></TR></TBODY></TABLE></DIV></BODY></HTML>
