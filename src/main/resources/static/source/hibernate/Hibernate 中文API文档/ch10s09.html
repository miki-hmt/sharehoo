<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=GBK">
<title>10.9.&#160;在两个不同数据库间复制对象</title>
<link rel="stylesheet" href="styles/html.css" type="text/css">
<meta name="generator" content="DocBook XSL Stylesheets V1.71.0">
<link rel="start" href="index.html" title="HIBERNATE - 符合Java习惯的关系数据库持久化">
<link rel="up" href="ch10.html" title="第&#160;10&#160;章&#160;与对象共事">
<link rel="prev" href="ch10s08.html" title="10.8.&#160;删除持久对象">
<link rel="next" href="ch10s10.html" title="10.10.&#160;Session刷出(flush)">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="sect1" lang="zh-cn">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="objectstate-replicating"></a>10.9.&#160;在两个不同数据库间复制对象</h2></div></div></div>
<p>
    		偶尔会用到不重新生成持久化标识(identifier)，将持久实例以及其关联的实例持久到不同的数据库中的操作。
    	</p>
<pre class="programlisting">//retrieve a cat from one database
Session session1 = factory1.openSession();
Transaction tx1 = session1.beginTransaction();
Cat cat = session1.get(Cat.class, catId);
tx1.commit();
session1.close();

//reconcile with a second database
Session session2 = factory2.openSession();
Transaction tx2 = session2.beginTransaction();
session2.replicate(cat, ReplicationMode.LATEST_VERSION);
tx2.commit();
session2.close();</pre>
<p>
            <code class="literal">ReplicationMode</code>决定在和数据库中已存在记录由冲突时，<code class="literal">replicate()</code>如何处理。
        </p>
<div class="itemizedlist"><ul type="disc" compact>
<li><p>
                    <code class="literal">ReplicationMode.IGNORE</code> - 忽略它
                </p></li>
<li><p>
                    <code class="literal">ReplicationMode.OVERWRITE</code> - 覆盖相同的行
                </p></li>
<li><p>
                    <code class="literal">ReplicationMode.EXCEPTION</code> - 抛出异常
                </p></li>
<li><p>
                    <code class="literal">ReplicationMode.LATEST_VERSION</code> - 如果当前的版本较新，则覆盖，否则忽略
                </p></li>
</ul></div>
<p>
        	这个功能的用途包括使录入的数据在不同数据库中一致，产品升级时升级系统配置信息，回滚non-ACID事务中的修改等等。
        	（译注，non-ACID，非ACID;ACID，Atomic，Consistent，Isolated and Durable的缩写）
        </p>
</div></body>
</html>
