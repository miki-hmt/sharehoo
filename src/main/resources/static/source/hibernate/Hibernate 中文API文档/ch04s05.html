<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=GBK">
<title>4.5.&#160;元组片断映射(Tuplizers)</title>
<link rel="stylesheet" href="styles/html.css" type="text/css">
<meta name="generator" content="DocBook XSL Stylesheets V1.71.0">
<link rel="start" href="index.html" title="HIBERNATE - 符合Java习惯的关系数据库持久化">
<link rel="up" href="ch04.html" title="第&#160;4&#160;章&#160;持久化类(Persistent Classes)">
<link rel="prev" href="ch04s04.html" title="4.4.&#160;动态模型(Dynamic models)">
<link rel="next" href="ch05.html" title="第&#160;5&#160;章&#160;对象/关系数据库映射基础(Basic O/R Mapping)">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="sect1" lang="zh-cn">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="persistent-classes-tuplizers"></a>4.5.&#160;元组片断映射(Tuplizers)</h2></div></div></div>
<p>
            <code class="literal">org.hibernate.tuple.Tuplizer</code>，以及其子接口，负责根据给定的<code class="literal">org.hibernate.EntityMode</code>，来复现片断数据。如果给定的片断数据被认为其是一种数据结构，"tuplizer"就是一个知道如何创建这样的数据结构，以及如何给这个数据结构赋值的东西。比如说，对于POJO这种Entity Mode，对应的tuplizer知道通过其构造方法来创建一个POJO，再通过其属性访问器来访问POJO属性。有两大类高层Tuplizer，分别是<code class="literal">org.hibernate.tuple.entity.EntityTuplizer</code> 和<code class="literal">org.hibernate.tuple.entity.ComponentTuplizer</code>接口。<code class="literal">EntityTuplizer</code>负责管理上面提到的实体的契约，而<code class="literal">ComponentTuplizer</code>则是针对组件的。
        </p>
<p>
            用户也可以插入其自定义的tuplizer。或许您需要一种不同于dynamic-map entity-mode中使用的<code class="literal">java.util.HashMap</code>的<code class="literal">java.util.Map</code>实现；或许您需要与默认策略不同的代理生成策略(proxy generation strategy)。通过自定义tuplizer实现，这两个目标您都可以达到。Tuplizer定义被附加到它们期望管理的entity或者component映射中。回到我们的customer entity例子：
        </p>
<pre class="programlisting">&lt;hibernate-mapping&gt;
    &lt;class entity-name="Customer"&gt;
        &lt;!--
            Override the dynamic-map entity-mode
            tuplizer for the customer entity
        --&gt;
        &lt;tuplizer entity-mode="dynamic-map"
                class="CustomMapTuplizerImpl"/&gt;

        &lt;id name="id" type="long" column="ID"&gt;
            &lt;generator class="sequence"/&gt;
        &lt;/id&gt;

        &lt;!-- other properties --&gt;
        ...
    &lt;/class&gt;
&lt;/hibernate-mapping&gt;


public class CustomMapTuplizerImpl
        extends org.hibernate.tuple.entity.DynamicMapEntityTuplizer {
    // override the buildInstantiator() method to plug in our custom map...
    protected final Instantiator buildInstantiator(
            org.hibernate.mapping.PersistentClass mappingInfo) {
        return new CustomMapInstantiator( mappingInfo );
    }

    private static final class CustomMapInstantiator
            extends org.hibernate.tuple.DynamicMapInstantitor {
        // override the generateMap() method to return our custom map...
	    protected final Map generateMap() {
		    return new CustomMap();
	    }
    }
}</pre>
</div></body>
</html>
