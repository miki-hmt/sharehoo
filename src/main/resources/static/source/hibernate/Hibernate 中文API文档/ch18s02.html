<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=GBK">
<title>18.2.&#160;XML映射元数据</title>
<link rel="stylesheet" href="styles/html.css" type="text/css">
<meta name="generator" content="DocBook XSL Stylesheets V1.71.0">
<link rel="start" href="index.html" title="HIBERNATE - 符合Java习惯的关系数据库持久化">
<link rel="up" href="ch18.html" title="第&#160;18&#160;章&#160;XML映射">
<link rel="prev" href="ch18.html" title="第&#160;18&#160;章&#160;XML映射">
<link rel="next" href="ch18s03.html" title="18.3.&#160;操作XML数据">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="sect1" lang="zh-cn">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="xml-mapping"></a>18.2.&#160;XML映射元数据</h2></div></div></div>
<p>
            许多Hibernate映射元素具有<code class="literal">node</code>属性。这使你可以指定用来保存
            属性或实体数据的XML属性或元素。<code class="literal">node</code>属性必须是下列格式之一：
        </p>
<div class="itemizedlist"><ul type="disc" compact>
<li><p><code class="literal">"element-name"</code> - 映射为指定的XML元素</p></li>
<li><p><code class="literal">"@attribute-name"</code> - 映射为指定的XML属性</p></li>
<li><p><code class="literal">"."</code> - 映射为父元素</p></li>
<li><p>
                <code class="literal">"element-name/@attribute-name"</code> - 
                映射为指定元素的指定属性
            </p></li>
</ul></div>
<p>
            对于集合和单值的关联，有一个额外的<code class="literal">embed-xml</code>属性可用。
            这个属性的缺省值是真(<code class="literal">embed-xml="true"</code>)。如果<code class="literal">embed-xml="true"</code>，
            则对应于被关联实体或值类型的集合的XML树将直接嵌入拥有这些关联的实体的XML树中。
            否则，如果<code class="literal">embed-xml="false"</code>，那么对于单值的关联，仅被引用的实体的标识符出现在
            XML树中(被引用实体本身不出现)，而集合则根本不出现。
        </p>
<p>
            你应该小心，不要让太多关联的embed-xml属性为真(<code class="literal">embed-xml="true"</code>)，因为XML不能很好地处理
            循环引用!
        </p>
<pre class="programlisting">&lt;class name="Customer" 
        table="CUSTOMER" 
        node="customer"&gt;
        
    &lt;id name="id" 
            column="CUST_ID" 
            node="@id"/&gt;
            
    &lt;map name="accounts" 
            node="." 
            embed-xml="true"&gt;
        &lt;key column="CUSTOMER_ID" 
                not-null="true"/&gt;
        &lt;map-key column="SHORT_DESC" 
                node="@short-desc" 
                type="string"/&gt;
        &lt;one-to-many entity-name="Account"
                embed-xml="false" 
                node="account"/&gt;
    &lt;/map&gt;
    
    &lt;component name="name" 
            node="name"&gt;
        &lt;property name="firstName" 
                node="first-name"/&gt;
        &lt;property name="initial" 
                node="initial"/&gt;
        &lt;property name="lastName" 
                node="last-name"/&gt;
    &lt;/component&gt;
    
    ...
    
&lt;/class&gt;</pre>
<p>
            在这个例子中，我们决定嵌入帐目号码(account id)的集合，但不嵌入实际的帐目数据。下面的HQL查询：
        </p>
<pre class="programlisting">from Customer c left join fetch c.accounts where c.lastName like :lastName</pre>
<p>
            返回的数据集将是这样：
        </p>
<pre class="programlisting">&lt;customer id="123456789"&gt;
    &lt;account id="987632567" short-desc="Savings"/&gt;
    &lt;account id="985612323" short-desc="Credit Card"/&gt;
    &lt;name&gt;
        &lt;first-name&gt;Gavin&lt;/first-name&gt;
        &lt;initial&gt;A&lt;/initial&gt;
        &lt;last-name&gt;King&lt;/last-name&gt;
    &lt;/name&gt;
    ...
&lt;/customer&gt;</pre>
<p>
            如果你把一对多映射<code class="literal">&lt;one-to-many&gt;</code>的embed-xml属性置为真(<code class="literal">embed-xml="true"</code>)，
            则数据看上去就像这样：
        </p>
<pre class="programlisting">&lt;customer id="123456789"&gt;
    &lt;account id="987632567" short-desc="Savings"&gt;
        &lt;customer id="123456789"/&gt;
        &lt;balance&gt;100.29&lt;/balance&gt;
    &lt;/account&gt;
    &lt;account id="985612323" short-desc="Credit Card"&gt;
        &lt;customer id="123456789"/&gt;
        &lt;balance&gt;-2370.34&lt;/balance&gt;
    &lt;/account&gt;
    &lt;name&gt;
        &lt;first-name&gt;Gavin&lt;/first-name&gt;
        &lt;initial&gt;A&lt;/initial&gt;
        &lt;last-name&gt;King&lt;/last-name&gt;
    &lt;/name&gt;
    ...
&lt;/customer&gt;</pre>
</div></body>
</html>
