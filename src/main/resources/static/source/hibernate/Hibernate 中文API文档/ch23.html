<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=GBK">
<title>第&#160;23&#160;章&#160;示例：复杂映射实例</title>
<link rel="stylesheet" href="styles/html.css" type="text/css">
<meta name="generator" content="DocBook XSL Stylesheets V1.71.0">
<link rel="start" href="index.html" title="HIBERNATE - 符合Java习惯的关系数据库持久化">
<link rel="up" href="index.html" title="HIBERNATE - 符合Java习惯的关系数据库持久化">
<link rel="prev" href="ch22s03.html" title="22.3.&#160;Hibernate 代码">
<link rel="next" href="ch23s02.html" title="23.2.&#160;Author(作家)/Work(作品)">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="chapter" lang="zh-cn">
<div class="titlepage"><div><div><h2 class="title">
<a name="example-mappings"></a>第&#160;23&#160;章&#160;示例：复杂映射实例</h2></div></div></div>
<div class="toc">
<p><b>目录</b></p>
<dl>
<dt><span class="sect1"><a href="ch23.html#example-mappings-emp">23.1. Employer（雇主)/Employee(雇员)</a></span></dt>
<dt><span class="sect1"><a href="ch23s02.html">23.2. Author(作家)/Work(作品)</a></span></dt>
<dt><span class="sect1"><a href="ch23s03.html">23.3. Customer(客户)/Order(订单)/Product(产品)</a></span></dt>
<dt><span class="sect1"><a href="ch23s04.html">23.4. 杂例</a></span></dt>
<dd><dl>
<dt><span class="sect2"><a href="ch23s04.html#example-mappings-typed-onetone">23.4.1. "Typed" one-to-one association</a></span></dt>
<dt><span class="sect2"><a href="ch23s04.html#example-mappings-composite-key">23.4.2. Composite key example</a></span></dt>
<dt><span class="sect2"><a href="ch23s04.html#example-mappings-composite-key-manytomany">23.4.3. 共有组合键属性的多对多(Many-to-many with shared composite key attribute)</a></span></dt>
<dt><span class="sect2"><a href="ch23s04.html#example-mappings-content-discrimination">23.4.4. Content based discrimination</a></span></dt>
<dt><span class="sect2"><a href="ch23s04.html#example-mappings-association-alternatekeys">23.4.5. Associations on alternate keys</a></span></dt>
</dl></dd>
</dl>
</div>
<p>
        本章展示了一些较为复杂的关系映射。
    </p>
<div class="sect1" lang="zh-cn">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="example-mappings-emp"></a>23.1.&#160;Employer（雇主)/Employee(雇员)</h2></div></div></div>
<p>
            下面关于<code class="literal">Employer</code> 和 <code class="literal">Employee</code>的关系模型使用了一个真实的实体类
            (<code class="literal">Employment</code>)来表述，这是因为对于相同的雇员和雇主可能会有多个雇佣时间段。
            对于金额和雇员姓名，用Components建模。
            
        </p>
<div class="mediaobject" align="center"><img src="images/EmployerEmployee.gif" align="middle"></div>
<p>
            映射文件可能是这样:
        </p>
<pre class="programlisting">&lt;hibernate-mapping&gt;
        
    &lt;class name="Employer" table="employers"&gt;
        &lt;id name="id"&gt;
            &lt;generator class="sequence"&gt;
                &lt;param name="sequence"&gt;employer_id_seq&lt;/param&gt;
            &lt;/generator&gt;
        &lt;/id&gt;
        &lt;property name="name"/&gt;
    &lt;/class&gt;

    &lt;class name="Employment" table="employment_periods"&gt;

        &lt;id name="id"&gt;
            &lt;generator class="sequence"&gt;
                &lt;param name="sequence"&gt;employment_id_seq&lt;/param&gt;
            &lt;/generator&gt;
        &lt;/id&gt;
        &lt;property name="startDate" column="start_date"/&gt;
        &lt;property name="endDate" column="end_date"/&gt;

        &lt;component name="hourlyRate" class="MonetaryAmount"&gt;
            &lt;property name="amount"&gt;
                &lt;column name="hourly_rate" sql-type="NUMERIC(12, 2)"/&gt;
            &lt;/property&gt;
            &lt;property name="currency" length="12"/&gt;
        &lt;/component&gt;

        &lt;many-to-one name="employer" column="employer_id" not-null="true"/&gt;
        &lt;many-to-one name="employee" column="employee_id" not-null="true"/&gt;

    &lt;/class&gt;

    &lt;class name="Employee" table="employees"&gt;
        &lt;id name="id"&gt;
            &lt;generator class="sequence"&gt;
                &lt;param name="sequence"&gt;employee_id_seq&lt;/param&gt;
            &lt;/generator&gt;
        &lt;/id&gt;
        &lt;property name="taxfileNumber"/&gt;
        &lt;component name="name" class="Name"&gt;
            &lt;property name="firstName"/&gt;
            &lt;property name="initial"/&gt;
            &lt;property name="lastName"/&gt;
        &lt;/component&gt;
    &lt;/class&gt;

&lt;/hibernate-mapping&gt;</pre>
<p>
        用<code class="literal">SchemaExport</code>生成表结构。
    </p>
<pre class="programlisting">create table employers (
    id BIGINT not null, 
    name VARCHAR(255), 
    primary key (id)
)

create table employment_periods (
    id BIGINT not null,
    hourly_rate NUMERIC(12, 2),
    currency VARCHAR(12), 
    employee_id BIGINT not null, 
    employer_id BIGINT not null, 
    end_date TIMESTAMP, 
    start_date TIMESTAMP, 
    primary key (id)
)

create table employees (
    id BIGINT not null, 
    firstName VARCHAR(255), 
    initial CHAR(1), 
    lastName VARCHAR(255), 
    taxfileNumber VARCHAR(255), 
    primary key (id)
)

alter table employment_periods 
    add constraint employment_periodsFK0 foreign key (employer_id) references employers
alter table employment_periods 
    add constraint employment_periodsFK1 foreign key (employee_id) references employees
create sequence employee_id_seq
create sequence employment_id_seq
create sequence employer_id_seq</pre>
</div>
</div></body>
</html>
